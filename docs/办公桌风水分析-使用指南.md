# 办公桌风水分析系统 - 使用指南

## 📖 系统简介

办公桌风水分析系统是基于传统风水理论和现代AI技术的智能分析工具，能够：

✅ 自动识别办公桌上的物品（使用YOLOv8）  
✅ 计算物品的相对位置和八卦方位  
✅ 匹配风水规则，分析布局合理性  
✅ 结合用户八字（喜神忌神）给出个性化建议  
✅ 提供位置调整、物品增减的具体建议

---

## 🚀 快速开始

### 1. 初始化系统

```bash
# 执行初始化脚本
./scripts/init_desk_fengshui.sh
```

**初始化脚本会自动完成：**
- 创建数据库表
- 插入示例风水规则
- 安装Python依赖
- 生成gRPC代码

### 2. 启动服务

```bash
# 启动办公桌风水微服务
./scripts/start_desk_fengshui_service.sh

# 启动主服务（如果未启动）
./restart_server.sh
```

### 3. 访问前端页面

打开浏览器访问：

```
http://localhost:8001/frontend/desk-fengshui.html
```

---

## 📱 使用步骤

### 步骤1：上传照片

1. 点击上传区域，选择您的办公桌照片
2. 或直接拖拽照片到上传区域
3. 支持 JPG、PNG、WEBP 格式

**拍照建议：**
- 📸 正对办公桌拍摄，保持水平
- 💡 光线充足，避免逆光
- 📏 尽量包含整个办公桌
- 🔍 物品清晰可见

### 步骤2：填写八字信息（可选）

如果您希望获得个性化建议，请填写：

- **出生日期**：阳历日期
- **出生时间**：具体时辰
- **性别**：男/女

**注意：** 关闭"使用八字分析"开关可以跳过此步骤，仅进行基础分析。

### 步骤3：开始分析

点击"开始分析"按钮，系统将：

1. ⏳ 上传照片到服务器
2. 🔍 AI识别物品和位置
3. 📊 匹配风水规则
4. 💡 生成分析报告

**分析时间：** 通常 2-5 秒

### 步骤4：查看结果

分析完成后，您将看到：

#### 📊 综合评分
- 圆形进度条显示风水评分（0-100分）
- 分数越高，布局越合理
- 90分以上：优秀
- 75-90分：良好
- 60-75分：一般
- 60分以下：待改善

#### 🔍 检测到的物品
- 显示所有识别到的物品
- 标注物品所在的方位
- 显示八卦对应位置

#### 🔄 位置调整建议
- 列出需要移动的物品
- 显示当前位置 → 理想位置
- 说明风水依据
- 标注优先级（高/中/低）

#### ➕ 物品增加建议
- 基于您的喜神推荐物品
- 建议摆放位置
- 说明风水作用
- 标注五行属性

#### 🗑️ 物品移除建议
- 列出不宜摆放的物品
- 说明禁忌原因
- 提供替代建议

---

## 🔧 API 接口说明

### 分析接口

**请求：**

```http
POST /api/v2/desk-fengshui/analyze
Content-Type: multipart/form-data

{
  "image": <file>,
  "solar_date": "1990-01-01",
  "solar_time": "12:00",
  "gender": "male",
  "use_bazi": true
}
```

**响应：**

```json
{
  "success": true,
  "data": {
    "items": [...],
    "adjustments": [...],
    "additions": [...],
    "removals": [...],
    "score": 75,
    "summary": "您的办公桌整体风水布局良好...",
    "xishen": "水",
    "jishen": "火",
    "duration": 2345
  }
}
```

### 规则查询接口

```http
GET /api/v2/desk-fengshui/rules?rule_type=basic&item_name=kettle
```

---

## 📋 风水规则说明

### 基础规则

#### 1. 烧水壶（五行属火）
- **理想位置**：左侧（青龙位）
- **原因**：青龙位宜动，火属阳，利于事业发展
- **忌讳**：右侧（白虎位）

#### 2. 绿植（五行属木）
- **理想位置**：东侧或东南侧
- **原因**：木旺东方，生机勃勃，利于健康和创意
- **建议**：选择圆叶植物，避免带刺植物

#### 3. 笔记本电脑
- **理想位置**：中央或偏左
- **原因**：工作核心工具，保持明堂开阔
- **注意**：屏幕应正对使用者

#### 4. 书籍文件（五行属木）
- **理想位置**：后方或左侧
- **原因**：形成"靠山"，利于工作稳定
- **建议**：整齐摆放，保持前方开阔

#### 5. 水杯（五行属水）
- **理想位置**：右前方
- **原因**：方便取用，避免泼洒损坏设备
- **建议**：使用带盖的杯子

### 忌讳规则

#### 1. 仙人掌/带刺植物
- **禁止位置**：前方（朱雀位）
- **原因**：带刺植物易招口舌是非，影响人际关系
- **建议**：如需摆放，放在角落或窗台

#### 2. 镜子
- **禁止位置**：正对办公桌
- **原因**：形成反煞，影响精神集中和情绪稳定
- **建议**：调整角度，不要直接照射座位

### 五行个性化规则

基于您的喜神，系统会推荐相应的物品：

- **喜神为木**：绿植、木质摆件（东方）
- **喜神为火**：红色物品、暖色调装饰（南方）
- **喜神为土**：陶瓷摆件、黄色物品（中央）
- **喜神为金**：金属摆件、白色物品（西方）
- **喜神为水**：水养植物、蓝色物品（北方）

---

## 🛠️ 故障排查

### 问题1：照片上传失败

**可能原因：**
- 文件过大（超过10MB）
- 文件格式不支持
- 网络连接问题

**解决方案：**
- 压缩图片后重试
- 确保文件格式为 JPG/PNG/WEBP
- 检查网络连接

### 问题2：未检测到物品

**可能原因：**
- 照片模糊或光线不足
- 物品被遮挡
- 物品类型不在识别范围

**解决方案：**
- 重新拍摄清晰照片
- 确保物品可见
- 参考"支持的物品类型"列表

### 问题3：分析超时

**可能原因：**
- 服务器繁忙
- 微服务未启动
- 图片过大

**解决方案：**
```bash
# 检查微服务状态
ps aux | grep desk_fengshui

# 查看日志
tail -f logs/desk_fengshui_9010.log

# 重启服务
./scripts/stop_desk_fengshui_service.sh
./scripts/start_desk_fengshui_service.sh
```

### 问题4：八字信息无效

**可能原因：**
- 日期格式错误
- 时间格式错误
- 八字服务未启动

**解决方案：**
- 确保日期格式：YYYY-MM-DD
- 确保时间格式：HH:MM
- 检查旺衰分析服务状态

---

## 🎯 支持的物品类型

### 已支持（YOLO自带）
- 笔记本电脑 (laptop)
- 鼠标 (mouse)
- 键盘 (keyboard)
- 杯子 (cup)
- 水瓶 (bottle)
- 书籍 (book)
- 绿植 (potted plant)
- 手机 (cell phone)
- 时钟 (clock)
- 花瓶 (vase)
- 剪刀 (scissors)

### 扩展支持（需要自定义训练）
- 烧水壶 (kettle)
- 笔筒 (pen_holder)
- 日历 (calendar)
- 相框 (photo_frame)
- 仙人掌 (cactus)
- 招财猫 (lucky_cat)
- 鱼缸 (fish_tank)
- 镜子 (mirror)

**注意：** 扩展物品需要使用自定义训练的YOLO模型。

---

## 📊 服务管理

### 启动服务
```bash
./scripts/start_desk_fengshui_service.sh
```

### 停止服务
```bash
./scripts/stop_desk_fengshui_service.sh
```

### 查看日志
```bash
tail -f logs/desk_fengshui_9010.log
```

### 检查服务状态
```bash
ps aux | grep desk_fengshui
```

### 测试API
```bash
curl -X GET http://localhost:8001/api/v2/desk-fengshui/health
```

---

## 🔄 更新规则

### 方式1：直接修改数据库

```sql
-- 查看规则
SELECT * FROM desk_fengshui_rules WHERE item_name='kettle';

-- 更新规则
UPDATE desk_fengshui_rules 
SET reason='新的风水依据', priority=9 
WHERE rule_code='DESK_KETTLE_001';

-- 插入新规则
INSERT INTO desk_fengshui_rules 
(rule_code, rule_type, item_name, item_label, ideal_position, reason, priority, related_element)
VALUES 
('DESK_CUSTOM_001', 'basic', 'new_item', '新物品', '{"direction": "left"}', '风水依据', 8, '木');
```

### 方式2：使用API（TODO）

未来版本将提供规则管理API。

---

## 📞 技术支持

如有问题，请参考：

- 📁 技术方案：`docs/员工工位风水分析-技术方案.md`
- 📝 开发规范：项目根目录的开发规范文档
- 🐛 错误日志：`logs/desk_fengshui_9010.log`
- 📧 联系开发者：提交Issue到GitHub仓库

---

## 🎉 总结

办公桌风水分析系统是一个完整的端到端解决方案，包括：

- ✅ 图像识别（YOLO）
- ✅ 方位计算
- ✅ 规则匹配
- ✅ 八字融合
- ✅ 建议生成
- ✅ 美观的前端界面

祝您使用愉快，办公室风水旺旺旺！🌟

