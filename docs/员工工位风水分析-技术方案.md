# å‘˜å·¥å·¥ä½é£æ°´åˆ†æç³»ç»Ÿ - æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

### åŠŸèƒ½éœ€æ±‚
1. ç”¨æˆ·ä¸Šä¼ åŠå…¬æ¡Œç…§ç‰‡
2. AIè¯†åˆ«ç…§ç‰‡ä¸­çš„ç‰©å“å’Œæ–¹ä½ï¼ˆä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼‰
3. åŒ¹é…é£æ°´è§„åˆ™ï¼Œåˆ†æç‰©å“æ‘†æ”¾æ˜¯å¦åˆç†
4. ç»“åˆç”¨æˆ·å…«å­—ï¼ˆå–œç¥ã€å¿Œç¥ï¼‰ï¼Œç»™å‡ºä¸ªæ€§åŒ–å»ºè®®
5. æä¾›è°ƒæ•´å»ºè®®å’Œå¢å‡å»ºè®®

### ç¤ºä¾‹åœºæ™¯
- **åœºæ™¯1**ï¼šçƒ§æ°´å£¶åº”è¯¥åœ¨åŠå…¬æ¡Œå·¦é¢ï¼Œä½†ç…§ç‰‡é‡Œæ”¾åœ¨äº†å³é¢ â†’ å»ºè®®æ”¾åœ¨å·¦é¢
- **åœºæ™¯2**ï¼šç”¨æˆ·å–œç¥ä¸ºæ°´ï¼Œåº”åœ¨è¥¿åŒ—æ–¹æ”¾ç½®æ°´ç›¸å…³æ‘†ä»¶ â†’ å»ºè®®å¢åŠ æ°´å…»æ¤ç‰©æˆ–é±¼ç¼¸

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„
```
å‰ç«¯ (HTML/JS)
    â†“ ä¸Šä¼ ç…§ç‰‡ + å…«å­—ä¿¡æ¯
APIå±‚ (FastAPI)
    â†“ gRPCè°ƒç”¨
å¾®æœåŠ¡å±‚
    â”œâ”€ Desk Fengshui Service (å·¥ä½é£æ°´åˆ†æ)
    â”‚   â”œâ”€ å›¾åƒè¯†åˆ«å¼•æ“ (ç‰©å“æ£€æµ‹ + æ–¹ä½è¯†åˆ«)
    â”‚   â”œâ”€ è§„åˆ™åŒ¹é…å¼•æ“
    â”‚   â””â”€ å»ºè®®ç”Ÿæˆå™¨
    â”œâ”€ Bazi Core Service (å…«å­—æ ¸å¿ƒæœåŠ¡ - å·²æœ‰)
    â””â”€ Rule Service (è§„åˆ™æœåŠ¡ - å¤ç”¨)
```

### æŠ€æœ¯é€‰å‹

#### å›¾åƒè¯†åˆ«æ–¹æ¡ˆ
**æ–¹æ¡ˆAï¼šYOLO + æ–¹ä½ä¼°è®¡** â­æ¨è
- æ¨¡å‹ï¼šYOLOv8 æˆ– YOLOv5
- ä¼˜ç‚¹ï¼š
  - å®æ—¶æ£€æµ‹ï¼Œé€Ÿåº¦å¿«ï¼ˆCPU: ~100ms, GPU: ~20msï¼‰
  - å¯è¯†åˆ«80+å¸¸è§ç‰©å“
  - å¯è®­ç»ƒè‡ªå®šä¹‰ç‰©å“
- ç‰©å“ç±»åˆ«ï¼š
  - åŸºç¡€ç±»åˆ«ï¼šlaptop, mouse, keyboard, cup, bottle, book, plant, phone
  - æ‰©å±•ç±»åˆ«ï¼ˆå¯è®­ç»ƒï¼‰ï¼škettle, notebook, pen_holder, calendar, photo_frame

**æ–¹æ¡ˆBï¼šOpenCV + ä¼ ç»Ÿè§†è§‰**
- ä¼˜ç‚¹ï¼šè½»é‡çº§ï¼Œæ— éœ€GPU
- ç¼ºç‚¹ï¼šå‡†ç¡®ç‡è¾ƒä½ï¼Œéš¾ä»¥è¯†åˆ«å¤æ‚åœºæ™¯

**æ–¹æ¡ˆCï¼šAzure Computer Vision / Google Vision API**
- ä¼˜ç‚¹ï¼šå‡†ç¡®ç‡é«˜ï¼Œå¼€ç®±å³ç”¨
- ç¼ºç‚¹ï¼šéœ€è¦ä»˜è´¹ï¼Œç½‘ç»œå»¶è¿Ÿ

#### æ–¹ä½è¯†åˆ«æ–¹æ¡ˆ
1. **ç½‘æ ¼åˆ†å‰²æ³•**ï¼š
   - å°†åŠå…¬æ¡Œåˆ†ä¸º9å®«æ ¼
   - æ˜ å°„åˆ°å…«å¦æ–¹ä½ï¼ˆä¸œã€è¥¿ã€å—ã€åŒ—ã€ä¸œå—ã€è¥¿å—ã€ä¸œåŒ—ã€è¥¿åŒ—ï¼‰
   
2. **ç›¸å¯¹ä½ç½®æ³•**ï¼š
   - ä»¥ç”¨æˆ·ä½ç½®ä¸ºä¸­å¿ƒï¼ˆç…§ç‰‡æ‹æ‘„è§†è§’ï¼‰
   - å·¦ï¼ˆé’é¾™ä½ï¼‰ã€å³ï¼ˆç™½è™ä½ï¼‰ã€å‰ï¼ˆæœ±é›€ä½ï¼‰ã€åï¼ˆç„æ­¦ä½ï¼‰

#### æ•°æ®å­˜å‚¨
- **é£æ°´è§„åˆ™**ï¼šMySQLæ•°æ®åº“ï¼ˆtable: `desk_fengshui_rules`ï¼‰
- **ç¼“å­˜**ï¼šRedisï¼ˆè§„åˆ™ç¼“å­˜ï¼‰
- **åˆ†æè®°å½•**ï¼šMySQLï¼ˆtable: `desk_analysis_records`ï¼‰

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### 1. é£æ°´è§„åˆ™è¡¨ `desk_fengshui_rules`

```sql
CREATE TABLE `desk_fengshui_rules` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `rule_code` VARCHAR(50) UNIQUE COMMENT 'è§„åˆ™ç¼–ç ï¼Œå¦‚ DESK_KETTLE_001',
  `rule_type` VARCHAR(30) COMMENT 'è§„åˆ™ç±»å‹ï¼šbasic/element_based/career',
  `item_name` VARCHAR(50) COMMENT 'ç‰©å“åç§°ï¼Œå¦‚ kettle, plant',
  `ideal_position` JSON COMMENT 'ç†æƒ³ä½ç½®ï¼Œå¦‚ {"direction": "left", "bagua": "east"}',
  `reason` TEXT COMMENT 'é£æ°´ä¾æ®',
  `priority` INT DEFAULT 1 COMMENT 'ä¼˜å…ˆçº§ 1-10',
  `related_element` VARCHAR(10) COMMENT 'å…³è”äº”è¡Œï¼šæœ¨ç«åœŸé‡‘æ°´',
  `conditions` JSON COMMENT 'åŒ¹é…æ¡ä»¶ï¼Œå¦‚æ€§åˆ«ã€èŒä¸šç­‰',
  `suggestion` TEXT COMMENT 'æ‘†æ”¾å»ºè®®',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_rule_type` (`rule_type`),
  INDEX `idx_item_name` (`item_name`),
  INDEX `idx_related_element` (`related_element`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åŠå…¬æ¡Œé£æ°´è§„åˆ™è¡¨';
```

### 2. åˆ†æè®°å½•è¡¨ `desk_analysis_records`

```sql
CREATE TABLE `desk_analysis_records` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `user_id` VARCHAR(100) COMMENT 'ç”¨æˆ·ID',
  `image_url` VARCHAR(500) COMMENT 'ç…§ç‰‡URL',
  `detected_items` JSON COMMENT 'æ£€æµ‹åˆ°çš„ç‰©å“åˆ—è¡¨',
  `bazi_info` JSON COMMENT 'ç”¨æˆ·å…«å­—ä¿¡æ¯',
  `matched_rules` JSON COMMENT 'åŒ¹é…çš„è§„åˆ™',
  `suggestions` JSON COMMENT 'å»ºè®®åˆ—è¡¨',
  `score` INT COMMENT 'ç»¼åˆè¯„åˆ† 0-100',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å·¥ä½é£æ°´åˆ†æè®°å½•';
```

### 3. æ•°æ®ç»“æ„ç¤ºä¾‹

#### æ£€æµ‹åˆ°çš„ç‰©å“
```json
{
  "items": [
    {
      "name": "kettle",
      "label": "çƒ§æ°´å£¶",
      "confidence": 0.92,
      "position": {
        "bbox": [100, 200, 150, 280],
        "relative": "right",
        "bagua_direction": "west"
      }
    },
    {
      "name": "plant",
      "label": "ç»¿æ¤",
      "confidence": 0.88,
      "position": {
        "bbox": [500, 150, 600, 300],
        "relative": "left",
        "bagua_direction": "east"
      }
    }
  ],
  "desk_layout": {
    "grid": "3x3",
    "user_position": "center_bottom"
  }
}
```

#### å»ºè®®ç»“æ„
```json
{
  "adjustments": [
    {
      "item": "kettle",
      "current_position": "right",
      "ideal_position": "left",
      "reason": "çƒ§æ°´å£¶äº”è¡Œå±ç«ï¼Œåº”æ”¾åœ¨é’é¾™ä½ï¼ˆå·¦ä¾§ï¼‰ï¼Œåˆ©äºäº‹ä¸šå‘å±•",
      "priority": "high",
      "action": "move"
    }
  ],
  "additions": [
    {
      "item": "water_feature",
      "item_label": "æ°´å…»æ¤ç‰©æˆ–å°é±¼ç¼¸",
      "position": "northwest",
      "reason": "æ‚¨çš„å–œç¥ä¸ºæ°´ï¼Œè¥¿åŒ—æ–¹ä¸ºè´¢ä½ï¼Œå»ºè®®æ”¾ç½®æ°´ç›¸å…³æ‘†ä»¶",
      "priority": "medium",
      "action": "add",
      "element": "æ°´"
    }
  ],
  "removals": [
    {
      "item": "cactus",
      "position": "front",
      "reason": "ä»™äººæŒå¸¦åˆºï¼Œä¸å®œæ”¾åœ¨æœ±é›€ä½ï¼ˆå‰æ–¹ï¼‰ï¼Œå½±å“äººé™…å…³ç³»",
      "priority": "medium",
      "action": "remove"
    }
  ],
  "score": 68,
  "summary": "æ‚¨çš„åŠå…¬æ¡Œæ•´ä½“å¸ƒå±€è‰¯å¥½ï¼Œä½†æœ‰3å¤„å¯ä»¥ä¼˜åŒ–ã€‚"
}
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. å›¾åƒè¯†åˆ«æ¨¡å— `DeskItemDetector`

```python
# services/desk_fengshui/item_detector.py
import cv2
import numpy as np
from ultralytics import YOLO

class DeskItemDetector:
    """åŠå…¬æ¡Œç‰©å“æ£€æµ‹å™¨"""
    
    def __init__(self):
        # ä½¿ç”¨ YOLOv8
        self.model = YOLO('yolov8n.pt')  # nanoç‰ˆæœ¬ï¼Œé€Ÿåº¦å¿«
        
        # åŠå…¬æ¡Œç›¸å…³ç‰©å“æ˜ å°„
        self.item_map = {
            'laptop': 'ç¬”è®°æœ¬ç”µè„‘',
            'mouse': 'é¼ æ ‡',
            'keyboard': 'é”®ç›˜',
            'cup': 'æ¯å­',
            'bottle': 'æ°´ç“¶',
            'book': 'ä¹¦ç±',
            'potted plant': 'ç»¿æ¤',
            'cell phone': 'æ‰‹æœº',
            'clock': 'æ—¶é’Ÿ'
        }
    
    def detect(self, image_bytes: bytes) -> dict:
        """æ£€æµ‹åŠå…¬æ¡Œç‰©å“"""
        # 1. è§£ç å›¾åƒ
        img_array = np.frombuffer(image_bytes, dtype=np.uint8)
        img = cv2.imdecode(img_array, cv2.IMREAD_COLOR)
        
        # 2. YOLOæ£€æµ‹
        results = self.model(img, verbose=False)
        
        # 3. æå–ç»“æœ
        items = []
        for result in results:
            for box in result.boxes:
                class_id = int(box.cls[0])
                class_name = result.names[class_id]
                confidence = float(box.conf[0])
                bbox = box.xyxy[0].cpu().numpy().tolist()
                
                if class_name in self.item_map and confidence > 0.5:
                    items.append({
                        'name': class_name,
                        'label': self.item_map[class_name],
                        'confidence': confidence,
                        'bbox': bbox
                    })
        
        return {'items': items, 'image_shape': img.shape}
```

### 2. æ–¹ä½è®¡ç®—æ¨¡å— `PositionCalculator`

```python
# services/desk_fengshui/position_calculator.py

class PositionCalculator:
    """æ–¹ä½è®¡ç®—å™¨"""
    
    @staticmethod
    def calculate_relative_position(bbox: list, img_shape: tuple) -> dict:
        """è®¡ç®—ç‰©å“ç›¸å¯¹ä½ç½®"""
        height, width = img_shape[:2]
        x_center = (bbox[0] + bbox[2]) / 2
        y_center = (bbox[1] + bbox[3]) / 2
        
        # ç›¸å¯¹ä½ç½®ï¼ˆä»¥ç”¨æˆ·è§†è§’ï¼‰
        if x_center < width * 0.4:
            horizontal = 'left'  # é’é¾™ä½
        elif x_center > width * 0.6:
            horizontal = 'right'  # ç™½è™ä½
        else:
            horizontal = 'center'
        
        if y_center < height * 0.4:
            vertical = 'front'  # æœ±é›€ä½
        elif y_center > height * 0.6:
            vertical = 'back'  # ç„æ­¦ä½
        else:
            vertical = 'center'
        
        # å…«å¦æ–¹ä½æ˜ å°„
        bagua_map = {
            ('left', 'front'): 'east',
            ('center', 'front'): 'south',
            ('right', 'front'): 'west',
            ('left', 'center'): 'east',
            ('center', 'center'): 'center',
            ('right', 'center'): 'west',
            ('left', 'back'): 'northeast',
            ('center', 'back'): 'north',
            ('right', 'back'): 'northwest'
        }
        
        return {
            'relative': horizontal,
            'vertical': vertical,
            'bagua_direction': bagua_map.get((horizontal, vertical), 'unknown')
        }
```

### 3. è§„åˆ™å¼•æ“ `DeskFengshuiEngine`

```python
# services/desk_fengshui/rule_engine.py

class DeskFengshuiEngine:
    """åŠå…¬æ¡Œé£æ°´è§„åˆ™å¼•æ“"""
    
    def match_rules(self, detected_items: list, bazi_info: dict) -> dict:
        """
        åŒ¹é…è§„åˆ™å¹¶ç”Ÿæˆå»ºè®®
        
        Args:
            detected_items: æ£€æµ‹åˆ°çš„ç‰©å“åˆ—è¡¨
            bazi_info: å…«å­—ä¿¡æ¯ï¼ˆåŒ…å«å–œç¥ã€å¿Œç¥ï¼‰
        
        Returns:
            åŒ¹é…ç»“æœå’Œå»ºè®®
        """
        # 1. åŠ è½½è§„åˆ™ï¼ˆä»æ•°æ®åº“æˆ–ç¼“å­˜ï¼‰
        rules = self._load_rules()
        
        # 2. åŒ¹é…åŸºç¡€è§„åˆ™
        adjustments = []
        for item in detected_items:
            for rule in rules:
                if rule['item_name'] == item['name']:
                    if not self._check_position(item, rule):
                        adjustments.append({
                            'item': item['label'],
                            'current_position': item['position']['relative'],
                            'ideal_position': rule['ideal_position']['direction'],
                            'reason': rule['reason'],
                            'priority': 'high'
                        })
        
        # 3. åŸºäºå–œç¥ç”Ÿæˆå¢åŠ å»ºè®®
        additions = self._generate_additions(
            detected_items, 
            bazi_info.get('xishen', [])
        )
        
        # 4. è®¡ç®—è¯„åˆ†
        score = self._calculate_score(detected_items, adjustments, additions)
        
        return {
            'adjustments': adjustments,
            'additions': additions,
            'score': score
        }
```

---

## ğŸš€ æœåŠ¡å®ç°

### ç›®å½•ç»“æ„
```
services/desk_fengshui/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ grpc_server.py              # gRPCæœåŠ¡å™¨
â”œâ”€â”€ item_detector.py            # ç‰©å“æ£€æµ‹å™¨
â”œâ”€â”€ position_calculator.py      # æ–¹ä½è®¡ç®—å™¨
â”œâ”€â”€ rule_engine.py              # è§„åˆ™å¼•æ“
â”œâ”€â”€ bazi_client.py              # å…«å­—æœåŠ¡å®¢æˆ·ç«¯
â”œâ”€â”€ suggestion_generator.py     # å»ºè®®ç”Ÿæˆå™¨
â””â”€â”€ requirements.txt
```

### gRPCæœåŠ¡å®šä¹‰
```protobuf
// proto/desk_fengshui.proto

syntax = "proto3";

package desk.fengshui;

service DeskFengshuiService {
  rpc AnalyzeDesk(DeskAnalysisRequest) returns (DeskAnalysisResponse);
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
}

message DeskAnalysisRequest {
  bytes image_data = 1;
  string solar_date = 2;
  string solar_time = 3;
  string gender = 4;
  bool use_bazi = 5;
}

message DetectedItem {
  string name = 1;
  string label = 2;
  double confidence = 3;
  repeated double bbox = 4;
  string relative_position = 5;
  string bagua_direction = 6;
}

message Suggestion {
  string item = 1;
  string current_position = 2;
  string ideal_position = 3;
  string reason = 4;
  string priority = 5;
  string action = 6;
}

message DeskAnalysisResponse {
  bool success = 1;
  repeated DetectedItem items = 2;
  repeated Suggestion adjustments = 3;
  repeated Suggestion additions = 4;
  repeated Suggestion removals = 5;
  int32 score = 6;
  string summary = 7;
  string error = 8;
}

message HealthCheckRequest {}

message HealthCheckResponse {
  string status = 1;
}
```

---

## ğŸ“ é£æ°´è§„åˆ™ç¤ºä¾‹

åŸºäºä¼ ç»Ÿé£æ°´ç†è®ºå’ŒåŠå…¬æ¡Œå¸ƒå±€åŸåˆ™ï¼š

### åŸºç¡€è§„åˆ™
1. **çƒ§æ°´å£¶**ï¼ˆäº”è¡Œå±ç«ï¼‰
   - ç†æƒ³ä½ç½®ï¼šå·¦ä¾§ï¼ˆé’é¾™ä½ï¼‰
   - åŸå› ï¼šé’é¾™ä½å®œåŠ¨ï¼Œç«å±é˜³ï¼Œåˆ©äºäº‹ä¸šå‘å±•
   
2. **ç»¿æ¤**ï¼ˆäº”è¡Œå±æœ¨ï¼‰
   - ç†æƒ³ä½ç½®ï¼šä¸œä¾§æˆ–ä¸œå—ä¾§
   - åŸå› ï¼šæœ¨æ—ºä¸œæ–¹ï¼Œç”Ÿæœºå‹ƒå‹ƒï¼Œåˆ©äºå¥åº·å’Œåˆ›æ„

3. **é‡‘å±ç¬”ç­’**ï¼ˆäº”è¡Œå±é‡‘ï¼‰
   - ç†æƒ³ä½ç½®ï¼šè¥¿ä¾§æˆ–è¥¿åŒ—ä¾§
   - åŸå› ï¼šé‡‘æ—ºè¥¿æ–¹ï¼Œåˆ©äºæƒå¨å’Œé¢†å¯¼åŠ›

4. **æ°´å…»æ¤ç‰©/é±¼ç¼¸**ï¼ˆäº”è¡Œå±æ°´ï¼‰
   - ç†æƒ³ä½ç½®ï¼šåŒ—ä¾§
   - åŸå› ï¼šæ°´æ—ºåŒ—æ–¹ï¼Œåˆ©äºè´¢è¿å’Œæ™ºæ…§

5. **æ–‡ä»¶å¤¹/ä¹¦ç±**ï¼ˆäº”è¡Œå±æœ¨ï¼‰
   - ç†æƒ³ä½ç½®ï¼šå·¦ä¾§æˆ–åæ–¹
   - åŸå› ï¼šå·¦ä¾§ä¸ºè´µäººä½ï¼Œåæ–¹ä¸ºé å±±

### å¿Œè®³è§„åˆ™
1. **ä»™äººæŒ/å¸¦åˆºæ¤ç‰©**
   - ä¸å®œï¼šå‰æ–¹ï¼ˆæœ±é›€ä½ï¼‰
   - åŸå› ï¼šå¸¦åˆºæ¤ç‰©æ˜“æ‹›å£èˆŒæ˜¯éï¼Œå½±å“äººé™…å…³ç³»

2. **å°–é”ç‰©å“**
   - ä¸å®œï¼šç›´å†²åº§ä½
   - åŸå› ï¼šå½¢æˆ"ç…æ°”"ï¼Œå½±å“å¥åº·å’Œè¿åŠ¿

3. **æ‚ä¹±ç‰©å“**
   - ä¸å®œï¼šåŠå…¬æ¡Œä¸­å¤®
   - åŸå› ï¼šä¸­å¤®ä¸ºæ˜å ‚ï¼Œå®œä¿æŒæ•´æ´

### ä¸ªæ€§åŒ–è§„åˆ™ï¼ˆç»“åˆå…«å­—ï¼‰
- **å–œç¥ä¸ºæ°´**ï¼šå¢åŠ æ°´å…»æ¤ç‰©ã€è“è‰²ç‰©å“
- **å–œç¥ä¸ºæœ¨**ï¼šå¢åŠ ç»¿æ¤ã€æœ¨è´¨æ‘†ä»¶
- **å–œç¥ä¸ºç«**ï¼šå¢åŠ çº¢è‰²ç‰©å“ã€æš–è‰²è°ƒè£…é¥°
- **å–œç¥ä¸ºé‡‘**ï¼šå¢åŠ é‡‘å±æ‘†ä»¶ã€ç™½è‰²æˆ–é‡‘è‰²ç‰©å“
- **å–œç¥ä¸ºåœŸ**ï¼šå¢åŠ é™¶ç“·æ‘†ä»¶ã€é»„è‰²æˆ–æ£•è‰²ç‰©å“

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### æ¥å£è·¯å¾„
```
POST /api/v2/desk-fengshui/analyze
```

### è¯·æ±‚å‚æ•°
```json
{
  "image": "æ–‡ä»¶ä¸Šä¼ ",
  "solar_date": "1990-01-01",
  "solar_time": "12:00",
  "gender": "male",
  "use_bazi": true
}
```

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "detected_items": [
      {
        "name": "kettle",
        "label": "çƒ§æ°´å£¶",
        "confidence": 0.92,
        "position": {
          "relative": "right",
          "bagua_direction": "west"
        }
      }
    ],
    "suggestions": {
      "adjustments": [
        {
          "item": "çƒ§æ°´å£¶",
          "current_position": "right",
          "ideal_position": "left",
          "reason": "çƒ§æ°´å£¶äº”è¡Œå±ç«ï¼Œåº”æ”¾åœ¨é’é¾™ä½ï¼ˆå·¦ä¾§ï¼‰ï¼Œåˆ©äºäº‹ä¸šå‘å±•",
          "priority": "high",
          "action": "move"
        }
      ],
      "additions": [
        {
          "item": "water_feature",
          "item_label": "æ°´å…»æ¤ç‰©æˆ–å°é±¼ç¼¸",
          "position": "northwest",
          "reason": "æ‚¨çš„å–œç¥ä¸ºæ°´ï¼Œè¥¿åŒ—æ–¹ä¸ºè´¢ä½ï¼Œå»ºè®®æ”¾ç½®æ°´ç›¸å…³æ‘†ä»¶",
          "priority": "medium",
          "action": "add",
          "element": "æ°´"
        }
      ],
      "removals": []
    },
    "score": 68,
    "summary": "æ‚¨çš„åŠå…¬æ¡Œæ•´ä½“å¸ƒå±€è‰¯å¥½ï¼Œä½†æœ‰1å¤„éœ€è¦è°ƒæ•´ï¼Œå»ºè®®å¢åŠ 1é¡¹æ‘†ä»¶ã€‚"
  }
}
```

---

## ğŸ“± å‰ç«¯é¡µé¢è®¾è®¡

### é¡µé¢æ–‡ä»¶
```
frontend/desk-fengshui.html
frontend/js/desk-fengshui.js
frontend/css/desk-fengshui.css
```

### äº¤äº’æµç¨‹
1. ç”¨æˆ·è¾“å…¥å…«å­—ä¿¡æ¯ï¼ˆæˆ–ç™»å½•åè‡ªåŠ¨å¡«å……ï¼‰
2. ä¸Šä¼ åŠå…¬æ¡Œç…§ç‰‡
3. æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆåˆ†æä¸­...ï¼‰
4. å±•ç¤ºåˆ†æç»“æœï¼š
   - æ£€æµ‹åˆ°çš„ç‰©å“ï¼ˆå¸¦æ ‡æ³¨çš„å›¾ç‰‡ï¼‰
   - è¯„åˆ†ï¼ˆåœ†å½¢è¿›åº¦æ¡ï¼‰
   - è°ƒæ•´å»ºè®®ï¼ˆåˆ—è¡¨ï¼‰
   - å¢åŠ å»ºè®®ï¼ˆå¡ç‰‡ï¼‰
   - åˆ é™¤å»ºè®®ï¼ˆåˆ—è¡¨ï¼‰

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- ç‰©å“æ£€æµ‹å‡†ç¡®ç‡æµ‹è¯•
- æ–¹ä½è®¡ç®—æµ‹è¯•
- è§„åˆ™åŒ¹é…æµ‹è¯•

### é›†æˆæµ‹è¯•
- APIæ¥å£æµ‹è¯•
- gRPCæœåŠ¡æµ‹è¯•
- å‰åç«¯è”è°ƒæµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- å›¾åƒå¤„ç†é€Ÿåº¦ï¼ˆç›®æ ‡ <2sï¼‰
- å¹¶å‘è¯·æ±‚ï¼ˆç›®æ ‡ >10 QPSï¼‰

---

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

1. å®‰è£…ä¾èµ–
```bash
pip install ultralytics opencv-python grpcio
```

2. ç”Ÿæˆ gRPC ä»£ç 
```bash
python -m grpc_tools.protoc -I=proto --python_out=proto/generated --grpc_python_out=proto/generated proto/desk_fengshui.proto
```

3. å¯¼å…¥é£æ°´è§„åˆ™åˆ°æ•°æ®åº“
```bash
python scripts/import_desk_fengshui_rules.py
```

4. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨å¾®æœåŠ¡
python services/desk_fengshui/grpc_server.py

# å¯åŠ¨ä¸»æœåŠ¡
./restart_server.sh
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼€å‘è§„èŒƒ
âœ… æŒ‰ç…§ HiFate-bazi å¼€å‘è§„èŒƒæ‰§è¡Œ
âœ… æ–°æœåŠ¡ç‹¬ç«‹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
âœ… ä½¿ç”¨ gRPC å¾®æœåŠ¡æ¶æ„
âœ… éµå¾ªå‘½åè§„èŒƒå’Œä»£ç è§„èŒƒ

### å½±å“è¯„ä¼°
- **å½±å“èŒƒå›´**ï¼šä½ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰
- **æ¶‰åŠæ–‡ä»¶**ï¼šæ–°å¢æœåŠ¡å’Œæ¥å£
- **ä¾èµ–å…³ç³»**ï¼šè°ƒç”¨å·²æœ‰çš„å…«å­—æœåŠ¡ï¼Œæ— ä¿®æ”¹

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å®Œå–„é£æ°´è§„åˆ™ï¼ˆéœ€è¦æ–‡æ¡£å†…å®¹ï¼‰
2. â³ å®ç°å›¾åƒæ£€æµ‹æ¨¡å—
3. â³ å®ç°è§„åˆ™å¼•æ“
4. â³ å¼€å‘ gRPC æœåŠ¡
5. â³ å¼€å‘ API æ¥å£
6. â³ å¼€å‘å‰ç«¯é¡µé¢
7. â³ ç«¯åˆ°ç«¯æµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-11-26  
**ä½œè€…**: AI Assistant

