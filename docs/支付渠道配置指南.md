# æ”¯ä»˜æ¸ é“é…ç½®å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [Stripeï¼ˆå›½é™…ä¿¡ç”¨å¡ï¼‰](#stripeå›½é™…ä¿¡ç”¨å¡)
2. [PayPalï¼ˆå…¨çƒæ”¯ä»˜ï¼‰](#paypalå…¨çƒæ”¯ä»˜)
3. [æ”¯ä»˜å®å›½é™…ç‰ˆ](#æ”¯ä»˜å®å›½é™…ç‰ˆ)
4. [å¾®ä¿¡æ”¯ä»˜](#å¾®ä¿¡æ”¯ä»˜)
5. [æµ‹è¯•æ€»ç»“](#æµ‹è¯•æ€»ç»“)

---

## ä¸€ã€Stripeï¼ˆå›½é™…ä¿¡ç”¨å¡ï¼‰

### ğŸ’³ é€‚ç”¨åœºæ™¯
- å…¨çƒä¿¡ç”¨å¡æ”¯ä»˜
- æ”¯æŒApple Payã€Google Pay
- é€‚åˆé¢å‘æµ·å¤–ç”¨æˆ·çš„äº§å“
- è´¹ç‡ï¼š2.9% + $0.30/ç¬”

### ğŸ“ æ³¨å†Œæ­¥éª¤

#### æ­¥éª¤1ï¼šé€‰æ‹©æ³¨å†Œåœ°åŒº

æ ¹æ®æ‚¨çš„ä¸šåŠ¡é€‰æ‹©åˆé€‚çš„åœ°åŒºï¼š

| åœ°åŒº | æ³¨å†Œé“¾æ¥ | ä¼˜åŠ¿ | å¼€é€šæ—¶é—´ |
|------|---------|------|---------|
| **ç¾å›½** | https://stripe.com | åŠŸèƒ½æœ€å…¨ | 2-7å¤© |
| **é¦™æ¸¯** | https://stripe.com/hk | ä¸­æ–‡æ”¯æŒ | 2-7å¤© |
| **æ–°åŠ å¡** | https://stripe.com/sg | ä¸œå—äºšä¼˜åŠ¿ | 2-7å¤© |

#### æ­¥éª¤2ï¼šæ³¨å†Œè´¦å·

1. **è®¿é—®æ³¨å†Œé¡µé¢**
   ```bash
   # åœ¨æµè§ˆå™¨æ‰“å¼€
   open https://stripe.com
   ```

2. **å¡«å†™åŸºæœ¬ä¿¡æ¯**
   - ç”µå­é‚®ç®±
   - å…¬å¸åç§°ï¼ˆæˆ–ä¸ªäººåç§°ï¼‰
   - å›½å®¶/åœ°åŒº
   - è®¾ç½®å¯†ç 

3. **éªŒè¯é‚®ç®±**
   - æŸ¥æ”¶éªŒè¯é‚®ä»¶
   - ç‚¹å‡»éªŒè¯é“¾æ¥
   - å®Œæˆé‚®ç®±éªŒè¯

#### æ­¥éª¤3ï¼šè·å–æµ‹è¯•å¯†é’¥ï¼ˆç«‹å³å¯ç”¨ï¼‰

1. **ç™»å½•Stripe Dashboard**
   ```
   https://dashboard.stripe.com
   ```

2. **åˆ‡æ¢åˆ°æµ‹è¯•æ¨¡å¼**
   - åœ¨å·¦ä¸Šè§’æ‰¾åˆ°"æŸ¥çœ‹æµ‹è¯•æ•°æ®"å¼€å…³
   - ç¡®ä¿å¤„äº"æµ‹è¯•æ¨¡å¼"

3. **è·å–APIå¯†é’¥**
   ```
   å¯¼èˆªè·¯å¾„ï¼šDevelopersï¼ˆå¼€å‘è€…ï¼‰ -> API keysï¼ˆAPIå¯†é’¥ï¼‰
   ```

4. **å¤åˆ¶æµ‹è¯•å¯†é’¥**
   ```
   å¯å‘å¸ƒå¯†é’¥ï¼ˆPublishable keyï¼‰: pk_test_...
   å¯†é’¥ï¼ˆSecret keyï¼‰:             sk_test_...
   ```
   
   **âš ï¸ é‡è¦ï¼šåªå¤åˆ¶ sk_test_ å¼€å¤´çš„å¯†é’¥**

#### æ­¥éª¤4ï¼šé…ç½®åˆ°ç³»ç»Ÿ

```bash
# æ–¹æ³•1ï¼šå†™å…¥ç¯å¢ƒæ–‡ä»¶ï¼ˆæ¨èï¼‰
echo 'export STRIPE_SECRET_KEY="sk_test_ä½ çš„å¯†é’¥"' >> config/services.env

# æ–¹æ³•2ï¼šä¸´æ—¶è®¾ç½®
export STRIPE_SECRET_KEY="sk_test_ä½ çš„å¯†é’¥"
```

#### æ­¥éª¤5ï¼šæµ‹è¯•æ”¯ä»˜æµç¨‹

```bash
# 1. å¯åŠ¨æœåŠ¡
./start_all_services.sh

# 2. åˆ›å»ºæ”¯ä»˜ä¼šè¯
curl -X POST http://127.0.0.1:8001/api/v1/payment/create-session \
  -H "Content-Type: application/json" \
  -d '{
    "amount": "19.90",
    "currency": "USD",
    "product_name": "æµ‹è¯•äº§å“",
    "customer_email": "test@example.com"
  }' | python3 -m json.tool

# 3. å¤åˆ¶è¿”å›çš„ checkout_url åœ¨æµè§ˆå™¨æ‰“å¼€
# 4. ä½¿ç”¨æµ‹è¯•å¡å·å®Œæˆæ”¯ä»˜
```

#### æ­¥éª¤6ï¼šæµ‹è¯•å¡å·

| å¡å· | ç”¨é€” | ç»“æœ |
|------|------|------|
| `4242 4242 4242 4242` | åŸºç¡€æµ‹è¯• | âœ… æ”¯ä»˜æˆåŠŸ |
| `4000 0000 0000 0002` | å¤±è´¥æµ‹è¯• | âŒ å¡ç‰‡è¢«æ‹’ç» |
| `4000 0000 0000 9995` | ä½™é¢ä¸è¶³ | âŒ ä½™é¢ä¸è¶³ |
| `4000 0027 6000 3184` | 3DéªŒè¯ | ğŸ” éœ€è¦é¢å¤–éªŒè¯ |

**é€šç”¨ä¿¡æ¯ï¼š**
- è¿‡æœŸæ—¥æœŸï¼šä»»æ„æœªæ¥æ—¥æœŸï¼ˆå¦‚ 12/34ï¼‰
- CVCï¼šä»»æ„3ä½æ•°å­—ï¼ˆå¦‚ 123ï¼‰
- é‚®ç¼–ï¼šä»»æ„5ä½æ•°å­—ï¼ˆå¦‚ 12345ï¼‰

#### æ­¥éª¤7ï¼šè·å–ç”Ÿäº§å¯†é’¥ï¼ˆå¯é€‰ï¼‰

1. **å®Œå–„è´¦æˆ·ä¿¡æ¯**
   ```
   Settingsï¼ˆè®¾ç½®ï¼‰ -> Account detailsï¼ˆè´¦æˆ·è¯¦æƒ…ï¼‰
   ```
   
   éœ€è¦æä¾›ï¼š
   - å…¬å¸ä¿¡æ¯æˆ–ä¸ªäººèº«ä»½è¯æ˜
   - é“¶è¡Œè´¦æˆ·ä¿¡æ¯
   - ä¸šåŠ¡æè¿°
   - ç½‘ç«™URL

2. **æäº¤å®¡æ ¸**
   - ä¸Šä¼ èº«ä»½è¯æ˜æ–‡ä»¶
   - ç­‰å¾…2-7å¤©å®¡æ ¸

3. **å®¡æ ¸é€šè¿‡åè·å–ç”Ÿäº§å¯†é’¥**
   ```
   Developers -> API keys -> åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼
   å¤åˆ¶ï¼šsk_live_...
   ```

4. **åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ**
   ```bash
   # ä¿®æ”¹ config/services.env
   export STRIPE_SECRET_KEY="sk_live_ä½ çš„ç”Ÿäº§å¯†é’¥"
   
   # é‡å¯æœåŠ¡
   ./stop_all_services.sh
   ./start_all_services.sh
   ```

### âš ï¸ æ³¨æ„äº‹é¡¹

- âœ… æµ‹è¯•ç¯å¢ƒä¸ä¼šå®é™…æ‰£æ¬¾
- âœ… ç”Ÿäº§ç¯å¢ƒä¼šçœŸå®æ‰£æ¬¾
- âš ï¸ å¦¥å–„ä¿ç®¡å¯†é’¥ï¼Œä¸è¦æ³„éœ²
- âš ï¸ ä¸è¦å°†å¯†é’¥æäº¤åˆ°Gitä»“åº“

---

## äºŒã€PayPalï¼ˆå…¨çƒæ”¯ä»˜ï¼‰

### ğŸ’° é€‚ç”¨åœºæ™¯
- å…¨çƒ200+å›½å®¶æ”¯æŒ
- ä¹°å®¶ä¿æŠ¤æœºåˆ¶
- é€‚åˆè·¨å¢ƒç”µå•†
- è´¹ç‡ï¼š4.4% + å›ºå®šè´¹ç”¨

### ğŸ“ æ³¨å†Œæ­¥éª¤

#### æ­¥éª¤1ï¼šæ³¨å†ŒPayPalè´¦å·

1. **è®¿é—®PayPalå®˜ç½‘**
   ```bash
   # ä¸­å›½å¤§é™†å¯ç›´æ¥è®¿é—®
   open https://www.paypal.com/cn/home
   ```

2. **é€‰æ‹©è´¦æˆ·ç±»å‹**
   - ä¸ªäººè´¦æˆ·ï¼šé€‚åˆä¸ªäººæ¥æ”¶ä»˜æ¬¾
   - ä¼ä¸šè´¦æˆ·ï¼šé€‚åˆå…¬å¸ä¸šåŠ¡ï¼ˆæ¨èï¼‰

3. **å¡«å†™æ³¨å†Œä¿¡æ¯**
   - ç”µå­é‚®ç®±
   - è®¾ç½®å¯†ç 
   - æ‰‹æœºå·ç 
   - ä¸ªäºº/å…¬å¸ä¿¡æ¯

4. **éªŒè¯é‚®ç®±å’Œæ‰‹æœº**
   - æŸ¥æ”¶éªŒè¯é‚®ä»¶
   - è¾“å…¥çŸ­ä¿¡éªŒè¯ç 

#### æ­¥éª¤2ï¼šæ³¨å†Œå¼€å‘è€…è´¦å·

1. **è®¿é—®PayPal Developer**
   ```bash
   open https://developer.paypal.com
   ```

2. **ä½¿ç”¨PayPalè´¦å·ç™»å½•**
   - ä½¿ç”¨åˆšæ³¨å†Œçš„PayPalè´¦å·ç™»å½•
   - é¦–æ¬¡ç™»å½•ä¼šè¦æ±‚åŒæ„å¼€å‘è€…åè®®

3. **è¿›å…¥Dashboard**
   ```
   å¯¼èˆªï¼šDashboardï¼ˆæ§åˆ¶é¢æ¿ï¼‰
   ```

#### æ­¥éª¤3ï¼šåˆ›å»ºSandboxæµ‹è¯•è´¦å·

1. **åˆ›å»ºSandboxåº”ç”¨**
   ```
   å¯¼èˆªï¼šApps & Credentials -> Sandbox
   ```

2. **åˆ›å»ºæµ‹è¯•å•†å®¶è´¦å·**
   ```
   å¯¼èˆªï¼šSandbox -> Accounts -> Create Account
   
   ç±»å‹é€‰æ‹©ï¼šBusinessï¼ˆå•†å®¶ï¼‰
   å›½å®¶ï¼šé€‰æ‹©æ‚¨çš„ç›®æ ‡å¸‚åœº
   ```

3. **åˆ›å»ºæµ‹è¯•ä¹°å®¶è´¦å·**
   ```
   å†æ¬¡ç‚¹å‡» Create Account
   
   ç±»å‹é€‰æ‹©ï¼šPersonalï¼ˆä¸ªäººï¼‰
   å›½å®¶ï¼šé€‰æ‹©æ‚¨çš„ç›®æ ‡å¸‚åœº
   ```

4. **è®°å½•æµ‹è¯•è´¦å·ä¿¡æ¯**
   - ç‚¹å‡»è´¦å·æŸ¥çœ‹è¯¦æƒ…
   - è®°å½•é‚®ç®±å’Œå¯†ç ï¼ˆç”¨äºæµ‹è¯•æ”¯ä»˜ï¼‰

#### æ­¥éª¤4ï¼šè·å–APIå‡­è¯

1. **åˆ›å»ºåº”ç”¨**
   ```
   å¯¼èˆªï¼šApps & Credentials -> Sandbox -> Create App
   
   App Name: HiFate-bazi-payment
   App Type: Merchant
   ```

2. **è·å–å‡­è¯**
   ```
   åˆ›å»ºåä¼šæ˜¾ç¤ºï¼š
   
   Client ID:     AxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxA
   Secret:        ExxxxxxxxxxxxxxxxxxxxxxxxxxxxxxE
   ```

3. **å¤åˆ¶å‡­è¯**
   ```bash
   # Client IDï¼ˆå®¢æˆ·ç«¯IDï¼‰
   # Secretï¼ˆå¯†é’¥ï¼‰
   # éƒ½éœ€è¦ä¿å­˜
   ```

#### æ­¥éª¤5ï¼šé…ç½®åˆ°ç³»ç»Ÿ

```bash
# å†™å…¥ç¯å¢ƒæ–‡ä»¶
cat >> config/services.env << 'EOF'

# PayPal é…ç½®
export PAYPAL_CLIENT_ID="ä½ çš„Client_ID"
export PAYPAL_CLIENT_SECRET="ä½ çš„Secret"
export PAYPAL_MODE="sandbox"  # æµ‹è¯•ç¯å¢ƒ
EOF
```

#### æ­¥éª¤6ï¼šå®‰è£…ä¾èµ–

```bash
# å®‰è£…PayPal SDK
.venv/bin/pip install paypalcheckoutsdk
```

#### æ­¥éª¤7ï¼šæµ‹è¯•æ”¯ä»˜æµç¨‹

```bash
# 1. é‡å¯æœåŠ¡åŠ è½½é…ç½®
./stop_all_services.sh
./start_all_services.sh

# 2. åˆ›å»ºPayPalè®¢å•
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "paypal",
    "amount": "19.90",
    "currency": "USD",
    "product_name": "æµ‹è¯•äº§å“"
  }' | python3 -m json.tool

# 3. å¤åˆ¶è¿”å›çš„ approval_url
# 4. åœ¨æµè§ˆå™¨æ‰“å¼€
# 5. ä½¿ç”¨Sandboxæµ‹è¯•è´¦å·ç™»å½•
# 6. å®Œæˆæ”¯ä»˜
```

#### æ­¥éª¤8ï¼šæµ‹è¯•è´¦å·ç™»å½•

åœ¨æ”¯ä»˜é¡µé¢ä½¿ç”¨Sandboxæµ‹è¯•ä¹°å®¶è´¦å·ï¼š
```
é‚®ç®±ï¼šåœ¨Developer Dashboard -> Sandbox -> Accounts ä¸­æŸ¥çœ‹
å¯†ç ï¼šç‚¹å‡»è´¦å·æŸ¥çœ‹å¯†ç 
```

#### æ­¥éª¤9ï¼šåˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

1. **åˆ›å»ºç”Ÿäº§åº”ç”¨**
   ```
   Apps & Credentials -> Live -> Create App
   ```

2. **è·å–ç”Ÿäº§å‡­è¯**
   ```
   å¤åˆ¶ Client ID å’Œ Secret
   ```

3. **ä¿®æ”¹é…ç½®**
   ```bash
   # ä¿®æ”¹ config/services.env
   export PAYPAL_CLIENT_ID="ä½ çš„ç”Ÿäº§Client_ID"
   export PAYPAL_CLIENT_SECRET="ä½ çš„ç”Ÿäº§Secret"
   export PAYPAL_MODE="live"  # ç”Ÿäº§ç¯å¢ƒ
   ```

### ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] PayPalè´¦å·å·²æ³¨å†Œ
- [ ] å¼€å‘è€…è´¦å·å·²åˆ›å»º
- [ ] Sandboxæµ‹è¯•è´¦å·å·²åˆ›å»ºï¼ˆå•†å®¶+ä¹°å®¶ï¼‰
- [ ] åº”ç”¨å·²åˆ›å»ºï¼Œå‡­è¯å·²è·å–
- [ ] å‡­è¯å·²é…ç½®åˆ°ç³»ç»Ÿ
- [ ] èƒ½åˆ›å»ºæ”¯ä»˜è®¢å•
- [ ] èƒ½ä½¿ç”¨æµ‹è¯•è´¦å·å®Œæˆæ”¯ä»˜
- [ ] æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢æ­£å¸¸

---

## ä¸‰ã€æ”¯ä»˜å®å›½é™…ç‰ˆ

### ğŸ¦ é€‚ç”¨åœºæ™¯
- é¢å‘ä¸­å›½ç”¨æˆ·
- æ”¯ä»˜å®ç”¨æˆ·åŸºæ•°å¤§
- é€‚åˆè·¨å¢ƒæ”¯ä»˜
- è´¹ç‡ï¼šçº¦0.6%èµ·

### ğŸ“ æ³¨å†Œæ­¥éª¤

#### æ­¥éª¤1ï¼šå‡†å¤‡ææ–™

**ä¼ä¸šè´¦å·æ‰€éœ€ææ–™ï¼š**
- è¥ä¸šæ‰§ç…§
- æ³•äººèº«ä»½è¯
- å¯¹å…¬é“¶è¡Œè´¦æˆ·
- å…¬å¸å…¬ç« 
- ç½‘ç«™å¤‡æ¡ˆä¿¡æ¯

**ä¸ªäººè´¦å·é™åˆ¶ï¼š**
- âš ï¸ æ”¯ä»˜å®å›½é™…ç‰ˆé€šå¸¸è¦æ±‚ä¼ä¸šèµ„è´¨
- ä¸ªäººéš¾ä»¥ç”³è¯·å•†å®¶è´¦å·

#### æ­¥éª¤2ï¼šæ³¨å†Œä¼ä¸šæ”¯ä»˜å®

1. **è®¿é—®æ”¯ä»˜å®å¼€æ”¾å¹³å°**
   ```bash
   open https://open.alipay.com
   ```

2. **æ³¨å†Œè´¦å·**
   ```
   å³ä¸Šè§’ -> ç«‹å³æ³¨å†Œ -> ä¼ä¸šè´¦å·
   ```

3. **å¡«å†™ä¼ä¸šä¿¡æ¯**
   - ä¼ä¸šåç§°
   - ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
   - æ³•äººä¿¡æ¯
   - è”ç³»æ–¹å¼

4. **ä¸Šä¼ èµ„è´¨æ–‡ä»¶**
   - è¥ä¸šæ‰§ç…§æ‰«æä»¶
   - æ³•äººèº«ä»½è¯
   - é“¶è¡Œå¼€æˆ·è®¸å¯è¯

5. **ç­‰å¾…å®¡æ ¸**
   - é€šå¸¸éœ€è¦1-3ä¸ªå·¥ä½œæ—¥
   - å®¡æ ¸é€šè¿‡åä¼šçŸ­ä¿¡é€šçŸ¥

#### æ­¥éª¤3ï¼šåˆ›å»ºåº”ç”¨

1. **ç™»å½•å¼€æ”¾å¹³å°**
   ```
   https://open.alipay.com
   ```

2. **åˆ›å»ºåº”ç”¨**
   ```
   æ§åˆ¶å° -> ç½‘é¡µ&ç§»åŠ¨åº”ç”¨ -> åˆ›å»ºåº”ç”¨
   
   åº”ç”¨åç§°ï¼šHiFateæ”¯ä»˜
   åº”ç”¨ç±»å‹ï¼šç½‘é¡µåº”ç”¨
   åº”ç”¨å›¾æ ‡ï¼šä¸Šä¼ Logo
   ```

3. **å¡«å†™åº”ç”¨ä¿¡æ¯**
   - åº”ç”¨ç½‘å€
   - åº”ç”¨ç®€ä»‹
   - æˆæƒå›è°ƒåœ°å€ï¼šhttp://æ‚¨çš„åŸŸå/callback/alipay

#### æ­¥éª¤4ï¼šé…ç½®å¯†é’¥

1. **ç”ŸæˆRSAå¯†é’¥**
   ```bash
   # ä¸‹è½½æ”¯ä»˜å®å¯†é’¥ç”Ÿæˆå·¥å…·
   # æˆ–ä½¿ç”¨OpenSSLç”Ÿæˆ
   
   # ç”Ÿæˆç§é’¥
   openssl genrsa -out alipay_private_key.pem 2048
   
   # ç”Ÿæˆå…¬é’¥
   openssl rsa -in alipay_private_key.pem -pubout -out alipay_public_key.pem
   ```

2. **ä¸Šä¼ å…¬é’¥åˆ°æ”¯ä»˜å®**
   ```
   åº”ç”¨è¯¦æƒ… -> å¼€å‘ä¿¡æ¯ -> æ¥å£åŠ ç­¾æ–¹å¼ -> è®¾ç½®
   
   é€‰æ‹©ï¼šRSA2(SHA256)å¯†é’¥
   ä¸Šä¼ ï¼šalipay_public_key.pem çš„å†…å®¹
   ```

3. **è·å–æ”¯ä»˜å®å…¬é’¥**
   ```
   è®¾ç½®å®Œæˆåï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºæ”¯ä»˜å®å…¬é’¥
   å¤åˆ¶ä¿å­˜ä¸ºï¼šalipay_platform_public_key.pem
   ```

4. **è·å–APPID**
   ```
   åº”ç”¨è¯¦æƒ…é¡µé¡¶éƒ¨æ˜¾ç¤ºï¼šAPPID
   ```

#### æ­¥éª¤5ï¼šå¼€é€šæ”¯ä»˜åŠŸèƒ½

1. **ç”³è¯·æ”¯ä»˜äº§å“**
   ```
   åº”ç”¨è¯¦æƒ… -> äº§å“ç»‘å®š -> æ·»åŠ äº§å“
   
   é€‰æ‹©ï¼šæ‰‹æœºç½‘ç«™æ”¯ä»˜ æˆ– ç”µè„‘ç½‘ç«™æ”¯ä»˜
   ```

2. **ç­¾çº¦**
   - é˜…è¯»å¹¶ç­¾ç½²åè®®
   - æä¾›è¡¥å……ææ–™ï¼ˆå¦‚éœ€è¦ï¼‰
   - ç­‰å¾…å®¡æ ¸ï¼ˆ1-3å·¥ä½œæ—¥ï¼‰

#### æ­¥éª¤6ï¼šé…ç½®åˆ°ç³»ç»Ÿ

```bash
# 1. å°†å¯†é’¥æ–‡ä»¶æ”¾åˆ°å®‰å…¨ä½ç½®
mkdir -p config/alipay_keys
cp alipay_private_key.pem config/alipay_keys/
cp alipay_platform_public_key.pem config/alipay_keys/

# 2. é…ç½®ç¯å¢ƒå˜é‡
cat >> config/services.env << 'EOF'

# æ”¯ä»˜å®é…ç½®
export ALIPAY_APP_ID="ä½ çš„APPID"
export ALIPAY_PRIVATE_KEY_PATH="config/alipay_keys/alipay_private_key.pem"
export ALIPAY_PUBLIC_KEY_PATH="config/alipay_keys/alipay_platform_public_key.pem"
export ALIPAY_GATEWAY="https://openapi.alipay.com/gateway.do"  # ç”Ÿäº§ç¯å¢ƒ
# export ALIPAY_GATEWAY="https://openapi.alipaydev.com/gateway.do"  # æ²™ç®±ç¯å¢ƒ
export ALIPAY_DEBUG="false"
EOF
```

#### æ­¥éª¤7ï¼šä½¿ç”¨æ²™ç®±ç¯å¢ƒæµ‹è¯•

1. **è¿›å…¥æ²™ç®±ç¯å¢ƒ**
   ```
   å¼€æ”¾å¹³å° -> å¼€å‘è€…ä¸­å¿ƒ -> ç ”å‘æœåŠ¡ -> æ²™ç®±
   ```

2. **è·å–æ²™ç®±å‚æ•°**
   ```
   æ²™ç®±APPID
   æ²™ç®±ç½‘å…³åœ°å€
   æ²™ç®±è´¦å·ï¼ˆä¹°å®¶/å–å®¶ï¼‰
   ```

3. **é…ç½®æ²™ç®±ç¯å¢ƒ**
   ```bash
   export ALIPAY_APP_ID="æ²™ç®±APPID"
   export ALIPAY_GATEWAY="https://openapi.alipaydev.com/gateway.do"
   export ALIPAY_DEBUG="true"
   ```

4. **å®‰è£…ä¾èµ–**
   ```bash
   .venv/bin/pip install alipay-sdk-python
   ```

5. **æµ‹è¯•æ”¯ä»˜**
   ```bash
   curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
     -H "Content-Type: application/json" \
     -d '{
       "provider": "alipay",
       "amount": "19.90",
       "currency": "CNY",
       "product_name": "æµ‹è¯•äº§å“"
     }' | python3 -m json.tool
   ```

### â±ï¸ æ—¶é—´çº¿

- æ³¨å†Œè´¦å·ï¼šå³æ—¶
- ä¼ä¸šè®¤è¯ï¼š1-3å·¥ä½œæ—¥
- åº”ç”¨å®¡æ ¸ï¼š1-3å·¥ä½œæ—¥
- äº§å“ç­¾çº¦ï¼š1-3å·¥ä½œæ—¥
- **æ€»è®¡ï¼š3-9å·¥ä½œæ—¥**

---

## å››ã€å¾®ä¿¡æ”¯ä»˜

### ğŸ’š é€‚ç”¨åœºæ™¯
- ä¸­å›½å¸‚åœºä¸»æµæ”¯ä»˜æ–¹å¼
- å¾®ä¿¡ç”Ÿæ€å†…æ”¯ä»˜
- æ‰«ç æ”¯ä»˜ã€H5æ”¯ä»˜
- è´¹ç‡ï¼š0.6%

### ğŸ“ æ³¨å†Œæ­¥éª¤

#### æ­¥éª¤1ï¼šå‡†å¤‡ææ–™

**ä¼ä¸šæ‰€éœ€ææ–™ï¼š**
- è¥ä¸šæ‰§ç…§
- ç»„ç»‡æœºæ„ä»£ç è¯
- æ³•äººèº«ä»½è¯
- é“¶è¡Œå¼€æˆ·è®¸å¯è¯
- ç»“ç®—é“¶è¡Œè´¦æˆ·ä¿¡æ¯

#### æ­¥éª¤2ï¼šæ³¨å†Œå¾®ä¿¡æ”¯ä»˜å•†æˆ·å·

1. **è®¿é—®å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°**
   ```bash
   open https://pay.weixin.qq.com
   ```

2. **æ³¨å†Œè´¦å·**
   ```
   é¡µé¢å³ä¸Šè§’ -> æ³¨å†Œ -> å•†æˆ·å·
   ```

3. **é€‰æ‹©ä¸»ä½“ç±»å‹**
   - ä¼ä¸š
   - ä¸ªä½“å·¥å•†æˆ·
   - æ”¿åºœ/äº‹ä¸šå•ä½

4. **å¡«å†™å•†æˆ·ä¿¡æ¯**
   - å•†æˆ·åç§°
   - å•†æˆ·ç®€ç§°
   - å®¢æœç”µè¯
   - ç»è¥ç±»ç›®
   - è¥ä¸šæ‰§ç…§å·ç 

5. **ä¸Šä¼ èµ„è´¨**
   - è¥ä¸šæ‰§ç…§ç…§ç‰‡
   - æ³•äººèº«ä»½è¯ï¼ˆæ­£åé¢ï¼‰
   - é“¶è¡Œå¼€æˆ·è®¸å¯è¯
   - é—¨åº—ç…§ç‰‡ï¼ˆå¦‚é€‚ç”¨ï¼‰

6. **å¡«å†™ç»“ç®—ä¿¡æ¯**
   - å¼€æˆ·é“¶è¡Œ
   - é“¶è¡Œè´¦å·
   - å¼€æˆ·åç§°

7. **æ³•äººéªŒè¯**
   - å°é¢æ‰“æ¬¾éªŒè¯
   - æˆ–æ³•äººå¾®ä¿¡æ‰«ç éªŒè¯

8. **ç­¾ç½²åè®®**
   - é˜…è¯»å¹¶ç­¾ç½²ã€Šå¾®ä¿¡æ”¯ä»˜æœåŠ¡åè®®ã€‹
   - ç­‰å¾…å®¡æ ¸ï¼ˆ1-5å·¥ä½œæ—¥ï¼‰

#### æ­¥éª¤3ï¼šè·å–APIå‡­è¯

1. **å®¡æ ¸é€šè¿‡åç™»å½•å•†æˆ·å¹³å°**
   ```
   https://pay.weixin.qq.com
   ```

2. **è·å–å•†æˆ·å·**
   ```
   é¡µé¢å³ä¸Šè§’ä¼šæ˜¾ç¤ºï¼šå•†æˆ·å·ï¼ˆmch_idï¼‰
   ```

3. **è®¾ç½®APIå¯†é’¥**
   ```
   å¯¼èˆªï¼šè´¦æˆ·ä¸­å¿ƒ -> APIå®‰å…¨ -> è®¾ç½®APIå¯†é’¥
   
   è¦æ±‚ï¼š
   - 32ä½å­—ç¬¦
   - åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—
   - å»ºè®®ä½¿ç”¨éšæœºç”Ÿæˆå™¨
   ```

4. **ä¸‹è½½APIè¯ä¹¦**
   ```
   è´¦æˆ·ä¸­å¿ƒ -> APIå®‰å…¨ -> ä¸‹è½½è¯ä¹¦
   
   è¯ä¹¦ç”¨äºï¼šé€€æ¬¾ã€ä¼ä¸šä»˜æ¬¾ç­‰æ“ä½œ
   æ–‡ä»¶ï¼šapiclient_cert.pem, apiclient_key.pem
   ```

#### æ­¥éª¤4ï¼šè·å–AppID

**æ–¹å¼1ï¼šä½¿ç”¨å…¬ä¼—å·/å°ç¨‹åº**
```
å¦‚æœæ‚¨æœ‰å¾®ä¿¡å…¬ä¼—å·æˆ–å°ç¨‹åºï¼š
å…¬ä¼—å¹³å° -> å¼€å‘ -> åŸºæœ¬é…ç½® -> AppID
```

**æ–¹å¼2ï¼šæ³¨å†Œæ–°åº”ç”¨**
```
å¾®ä¿¡å¼€æ”¾å¹³å° -> ç®¡ç†ä¸­å¿ƒ -> åˆ›å»ºç§»åŠ¨åº”ç”¨/ç½‘ç«™åº”ç”¨
è·å– AppID
```

#### æ­¥éª¤5ï¼šå…³è”AppIDå’Œå•†æˆ·å·

```
å¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å° -> äº§å“ä¸­å¿ƒ -> å¼€å‘é…ç½®
å…³è”æ‚¨çš„AppID
```

#### æ­¥éª¤6ï¼šé…ç½®åˆ°ç³»ç»Ÿ

```bash
# 1. ä¿å­˜è¯ä¹¦æ–‡ä»¶
mkdir -p config/wechat_certs
cp apiclient_cert.pem config/wechat_certs/
cp apiclient_key.pem config/wechat_certs/

# 2. é…ç½®ç¯å¢ƒå˜é‡
cat >> config/services.env << 'EOF'

# å¾®ä¿¡æ”¯ä»˜é…ç½®
export WECHAT_APP_ID="ä½ çš„AppID"
export WECHAT_MCH_ID="ä½ çš„å•†æˆ·å·"
export WECHAT_API_KEY="ä½ çš„APIå¯†é’¥"
export WECHAT_CERT_PATH="config/wechat_certs/apiclient_cert.pem"
export WECHAT_KEY_PATH="config/wechat_certs/apiclient_key.pem"
EOF
```

#### æ­¥éª¤7ï¼šä½¿ç”¨æ²™ç®±ç¯å¢ƒæµ‹è¯•

âš ï¸ **å¾®ä¿¡æ”¯ä»˜æ²™ç®±ç¯å¢ƒè¯´æ˜ï¼š**
- å¾®ä¿¡æ”¯ä»˜æ²™ç®±åŠŸèƒ½è¾ƒä¸ºæœ‰é™
- å»ºè®®ä½¿ç”¨0.01å…ƒå°é¢æµ‹è¯•
- æµ‹è¯•å®Œæˆåå¯ä»¥ç”³è¯·é€€æ¬¾

#### æ­¥éª¤8ï¼šå®‰è£…ä¾èµ–

```bash
.venv/bin/pip install wechatpy
```

#### æ­¥éª¤9ï¼šæµ‹è¯•æ”¯ä»˜æµç¨‹

```bash
# 1. é‡å¯æœåŠ¡
./stop_all_services.sh
./start_all_services.sh

# 2. åˆ›å»ºNativeæ‰«ç æ”¯ä»˜
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "wechat",
    "amount": "0.01",
    "currency": "CNY",
    "product_name": "æµ‹è¯•äº§å“"
  }' | python3 -m json.tool

# 3. è¿”å›çš„ code_url ç”ŸæˆäºŒç»´ç 
# 4. ä½¿ç”¨å¾®ä¿¡æ‰«ç æ”¯ä»˜
```

### â±ï¸ æ—¶é—´çº¿

- æäº¤ç”³è¯·ï¼šå³æ—¶
- èµ„è´¨å®¡æ ¸ï¼š1-5å·¥ä½œæ—¥
- **æ€»è®¡ï¼š1-5å·¥ä½œæ—¥**

---

## äº”ã€æµ‹è¯•æ€»ç»“

### ğŸ“Š å„æ¸ é“å¯¹æ¯”

| æ”¯ä»˜æ¸ é“ | å¼€é€šéš¾åº¦ | å®¡æ ¸æ—¶é—´ | ä¸ªäººå¯ç”¨ | æµ‹è¯•ç¯å¢ƒ | è´¹ç‡ | æ¨èåº¦ |
|---------|---------|---------|---------|---------|------|--------|
| **Stripe** | â­â­ | 2-7å¤© | âœ… | âœ…å®Œå–„ | 2.9%+$0.3 | â­â­â­â­â­ |
| **PayPal** | â­â­ | å³æ—¶ | âœ… | âœ…å®Œå–„ | 4.4%+ | â­â­â­â­â­ |
| **æ”¯ä»˜å®** | â­â­â­â­ | 3-9å¤© | âŒ | âœ…æœ‰ | 0.6%+ | â­â­â­ |
| **å¾®ä¿¡æ”¯ä»˜** | â­â­â­â­ | 1-5å¤© | âŒ | âš ï¸æœ‰é™ | 0.6% | â­â­â­ |

### ğŸ¯ é€‰æ‹©å»ºè®®

**é¢å‘æµ·å¤–ç”¨æˆ·ï¼š**
1. Stripeï¼ˆé¦–é€‰ï¼‰- æ”¯æŒå…¨çƒä¿¡ç”¨å¡
2. PayPalï¼ˆå¤‡é€‰ï¼‰- å…¨çƒè¦†ç›–

**é¢å‘ä¸­å›½ç”¨æˆ·ï¼š**
1. å¾®ä¿¡æ”¯ä»˜ï¼ˆé¦–é€‰ï¼‰- ç”¨æˆ·åŸºæ•°æœ€å¤§
2. æ”¯ä»˜å®ï¼ˆå¤‡é€‰ï¼‰- è¦†ç›–å¹¿æ³›

**è·¨å¢ƒä¸šåŠ¡ï¼š**
1. Stripe + æ”¯ä»˜å®å›½é™…ç‰ˆ
2. PayPal + å¾®ä¿¡æ”¯ä»˜

### ğŸ”„ å®Œæ•´æµ‹è¯•æµç¨‹

```bash
# 1. é…ç½®æ‰€æœ‰å¯†é’¥åˆ° config/services.env

# 2. å®‰è£…æ‰€æœ‰ä¾èµ–
.venv/bin/pip install stripe paypalcheckoutsdk alipay-sdk-python wechatpy

# 3. å¯åŠ¨æœåŠ¡
./start_all_services.sh

# 4. æµ‹è¯•å„æ¸ é“
./test_stripe_complete.sh  # Stripeæµ‹è¯•è„šæœ¬
# å…¶ä»–æ¸ é“ç±»ä¼¼

# 5. æŸ¥çœ‹APIæ–‡æ¡£
open http://127.0.0.1:8001/docs
```

### ğŸ“ ç¯å¢ƒå˜é‡å®Œæ•´ç¤ºä¾‹

```bash
# config/services.env

# ========== Stripe ==========
export STRIPE_SECRET_KEY="sk_test_..."
export FRONTEND_BASE_URL="http://localhost:8080"

# ========== PayPal ==========
export PAYPAL_CLIENT_ID="AxxxxxxxxA"
export PAYPAL_CLIENT_SECRET="ExxxxxxxxE"
export PAYPAL_MODE="sandbox"

# ========== æ”¯ä»˜å® ==========
export ALIPAY_APP_ID="2021..."
export ALIPAY_PRIVATE_KEY_PATH="config/alipay_keys/private.pem"
export ALIPAY_PUBLIC_KEY_PATH="config/alipay_keys/public.pem"
export ALIPAY_GATEWAY="https://openapi.alipaydev.com/gateway.do"

# ========== å¾®ä¿¡æ”¯ä»˜ ==========
export WECHAT_APP_ID="wx..."
export WECHAT_MCH_ID="1234567890"
export WECHAT_API_KEY="32ä½å¯†é’¥..."
export WECHAT_CERT_PATH="config/wechat_certs/cert.pem"
export WECHAT_KEY_PATH="config/wechat_certs/key.pem"
```

### ğŸš¨ å®‰å…¨æé†’

1. **å¯†é’¥å®‰å…¨**
   - âœ… å®šæœŸæ›´æ¢APIå¯†é’¥
   - âœ… ä¸è¦å°†å¯†é’¥æäº¤åˆ°ä»£ç ä»“åº“
   - âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
   - âœ… é™åˆ¶APIå¯†é’¥æƒé™

2. **æµ‹è¯•ç¯å¢ƒ**
   - âœ… å¼€å‘é˜¶æ®µä½¿ç”¨æµ‹è¯•å¯†é’¥
   - âœ… å……åˆ†æµ‹è¯•åå†åˆ‡æ¢ç”Ÿäº§
   - âœ… ç”Ÿäº§ç¯å¢ƒå¯†é’¥å•ç‹¬ç®¡ç†

3. **Gité…ç½®**
   ```bash
   # ç¡®ä¿æ•æ„Ÿæ–‡ä»¶ä¸è¢«æäº¤
   echo "config/services.env" >> .gitignore
   echo "config/*_keys/" >> .gitignore
   echo "config/*_certs/" >> .gitignore
   ```

---

## é™„å½•ï¼šå¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åˆ‡æ¢æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒï¼Ÿ

**ç­”ï¼š** ä¿®æ”¹ç¯å¢ƒå˜é‡ä¸­çš„å¯†é’¥å’Œæ¨¡å¼ï¼š

```bash
# æµ‹è¯•ç¯å¢ƒ
export STRIPE_SECRET_KEY="sk_test_..."
export PAYPAL_MODE="sandbox"

# ç”Ÿäº§ç¯å¢ƒ
export STRIPE_SECRET_KEY="sk_live_..."
export PAYPAL_MODE="live"
```

### Q2: å¤šä¸ªæ”¯ä»˜æ¸ é“å¦‚ä½•é€‰æ‹©ï¼Ÿ

**ç­”ï¼š** ç³»ç»Ÿæ”¯æŒç»Ÿä¸€æ¥å£ï¼Œå‰ç«¯ä¼ é€’ `provider` å‚æ•°ï¼š

```bash
curl -X POST .../payment/unified/create \
  -d '{"provider": "stripe", ...}'  # stripe/paypal/alipay/wechat
```

### Q3: å¦‚ä½•æŸ¥çœ‹æ”¯ä»˜è®°å½•ï¼Ÿ

**ç­”ï¼š** å„å¹³å°éƒ½æœ‰ç®¡ç†åå°ï¼š

- Stripe: https://dashboard.stripe.com/payments
- PayPal: https://www.paypal.com/myaccount/transactions
- æ”¯ä»˜å®: https://open.alipay.com
- å¾®ä¿¡: https://pay.weixin.qq.com

### Q4: é‡åˆ°é—®é¢˜å¦‚ä½•è°ƒè¯•ï¼Ÿ

**ç­”ï¼š** 
1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`tail -f logs/server_8001.log`
2. æ£€æŸ¥APIæ–‡æ¡£ï¼š`http://127.0.0.1:8001/docs`
3. æŸ¥çœ‹å¹³å°æ–‡æ¡£ï¼šå„æ”¯ä»˜å¹³å°éƒ½æœ‰è¯¦ç»†çš„å¼€å‘æ–‡æ¡£

---

**æœ€åæ›´æ–°æ—¶é—´ï¼š2025-11-20**

**æ–‡æ¡£ç»´æŠ¤ï¼š** è¯·å®šæœŸæ£€æŸ¥å„æ”¯ä»˜å¹³å°æ”¿ç­–å˜åŒ–

