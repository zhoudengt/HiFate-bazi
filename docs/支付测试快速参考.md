# æ”¯ä»˜æµ‹è¯•å¿«é€Ÿå‚è€ƒ

> æœ¬æ–‡æ¡£æä¾›å„æ”¯ä»˜æ¸ é“çš„å¿«é€Ÿæµ‹è¯•æ–¹æ³•ï¼Œè¯¦ç»†é…ç½®è¯·å‚è€ƒã€Šæ”¯ä»˜æ¸ é“é…ç½®æŒ‡å—.mdã€‹

---

## ðŸš€ ä¸€ã€Stripe å¿«é€Ÿæµ‹è¯•

### 1åˆ†é’Ÿé…ç½®

```bash
# 1. æ³¨å†Œå¹¶èŽ·å–å¯†é’¥
open https://stripe.com
# ç™»å½•åŽï¼šDevelopers -> API keys -> å¤åˆ¶ sk_test_...

# 2. é…ç½®å¯†é’¥ï¼ˆå·²å®Œæˆâœ…ï¼‰
# config/services.env ä¸­å·²é…ç½®

# 3. æµ‹è¯•
./test_stripe_complete.sh
```

### æµ‹è¯•å¡å·

| åœºæ™¯ | å¡å· | ç»“æžœ |
|------|------|------|
| âœ… æˆåŠŸ | `4242 4242 4242 4242` | æ”¯ä»˜æˆåŠŸ |
| âŒ å¤±è´¥ | `4000 0000 0000 0002` | å¡ç‰‡è¢«æ‹’ |
| ðŸ’° ä½™é¢ä¸è¶³ | `4000 0000 0000 9995` | ä½™é¢ä¸è¶³ |
| ðŸ” éœ€éªŒè¯ | `4000 0027 6000 3184` | éœ€è¦3DéªŒè¯ |

**é€šç”¨ä¿¡æ¯ï¼š** è¿‡æœŸæ—¥æœŸ=12/34, CVC=123, é‚®ç¼–=12345

---

## ðŸ’° äºŒã€PayPal å¿«é€Ÿæµ‹è¯•

### 5åˆ†é’Ÿé…ç½®

```bash
# 1. æ³¨å†Œå¼€å‘è€…è´¦å·
open https://developer.paypal.com

# 2. åˆ›å»ºSandboxåº”ç”¨
Dashboard -> Apps & Credentials -> Sandbox -> Create App

# 3. èŽ·å–å‡­è¯
Client ID:     AxxxxxxA
Secret:        ExxxxxxE

# 4. é…ç½®
cat >> config/services.env << 'EOF'
export PAYPAL_CLIENT_ID="ä½ çš„ClientID"
export PAYPAL_CLIENT_SECRET="ä½ çš„Secret"
export PAYPAL_MODE="sandbox"
EOF

# 5. å®‰è£…ä¾èµ–
.venv/bin/pip install paypalcheckoutsdk

# 6. é‡å¯æœåŠ¡
./stop_all_services.sh && ./start_all_services.sh

# 7. æµ‹è¯•
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "paypal",
    "amount": "19.90",
    "currency": "USD",
    "product_name": "æµ‹è¯•äº§å“"
  }' | python3 -m json.tool
```

### æµ‹è¯•è´¦å·

åœ¨ PayPal Developer -> Sandbox -> Accounts ä¸­ï¼š
- æŸ¥çœ‹æµ‹è¯•ä¹°å®¶è´¦å·
- ä½¿ç”¨è¯¥è´¦å·ç™»å½•æ”¯ä»˜é¡µé¢

---

## ðŸ¦ ä¸‰ã€æ”¯ä»˜å® å¿«é€Ÿå‚è€ƒ

### å‰ç½®è¦æ±‚

- âŒ éœ€è¦ä¼ä¸šèµ„è´¨
- â±ï¸ å®¡æ ¸æ—¶é—´ï¼š3-9å·¥ä½œæ—¥
- ðŸ“„ è¥ä¸šæ‰§ç…§ã€å¯¹å…¬è´¦æˆ·å¿…éœ€

### é…ç½®æ­¥éª¤

```bash
# 1. æ³¨å†Œä¼ä¸šæ”¯ä»˜å®
open https://open.alipay.com

# 2. ç”ŸæˆRSAå¯†é’¥
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -pubout -out public.pem

# 3. ä¸Šä¼ å…¬é’¥åˆ°æ”¯ä»˜å®ï¼ŒèŽ·å–APPID

# 4. é…ç½®
mkdir -p config/alipay_keys
mv private.pem config/alipay_keys/
# ä¸‹è½½æ”¯ä»˜å®å…¬é’¥ä¿å­˜ä¸º config/alipay_keys/alipay_public.pem

cat >> config/services.env << 'EOF'
export ALIPAY_APP_ID="ä½ çš„APPID"
export ALIPAY_PRIVATE_KEY_PATH="config/alipay_keys/private.pem"
export ALIPAY_PUBLIC_KEY_PATH="config/alipay_keys/alipay_public.pem"
export ALIPAY_GATEWAY="https://openapi.alipaydev.com/gateway.do"
EOF

# 5. å®‰è£…ä¾èµ–
.venv/bin/pip install alipay-sdk-python

# 6. æµ‹è¯•
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "alipay",
    "amount": "19.90",
    "currency": "CNY",
    "product_name": "æµ‹è¯•äº§å“"
  }'
```

---

## ðŸ’š å››ã€å¾®ä¿¡æ”¯ä»˜ å¿«é€Ÿå‚è€ƒ

### å‰ç½®è¦æ±‚

- âŒ éœ€è¦ä¼ä¸šèµ„è´¨
- â±ï¸ å®¡æ ¸æ—¶é—´ï¼š1-5å·¥ä½œæ—¥
- ðŸ“„ è¥ä¸šæ‰§ç…§ã€é“¶è¡Œå¼€æˆ·è®¸å¯è¯å¿…éœ€

### é…ç½®æ­¥éª¤

```bash
# 1. æ³¨å†Œå•†æˆ·å·
open https://pay.weixin.qq.com

# 2. å®¡æ ¸é€šè¿‡åŽèŽ·å–ï¼š
å•†æˆ·å·ï¼ˆmch_idï¼‰
AppID
APIå¯†é’¥ï¼ˆ32ä½ï¼‰
APIè¯ä¹¦ï¼ˆcert.pem, key.pemï¼‰

# 3. é…ç½®
mkdir -p config/wechat_certs
# å°†è¯ä¹¦æ–‡ä»¶æ”¾å…¥ä¸Šè¿°ç›®å½•

cat >> config/services.env << 'EOF'
export WECHAT_APP_ID="ä½ çš„AppID"
export WECHAT_MCH_ID="ä½ çš„å•†æˆ·å·"
export WECHAT_API_KEY="ä½ çš„APIå¯†é’¥"
export WECHAT_CERT_PATH="config/wechat_certs/cert.pem"
export WECHAT_KEY_PATH="config/wechat_certs/key.pem"
EOF

# 4. å®‰è£…ä¾èµ–
.venv/bin/pip install wechatpy

# 5. æµ‹è¯•ï¼ˆå»ºè®®ä½¿ç”¨0.01å…ƒå°é¢æµ‹è¯•ï¼‰
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "wechat",
    "amount": "0.01",
    "currency": "CNY",
    "product_name": "æµ‹è¯•äº§å“"
  }'
```

---

## ðŸ“Š äº”ã€å¿«é€Ÿå¯¹æ¯”è¡¨

| æ¸ é“ | ä¸ªäººå¯ç”¨ | æµ‹è¯•çŽ¯å¢ƒ | å¼€é€šæ—¶é—´ | æŽ¨èç”¨é€” |
|------|---------|---------|---------|---------|
| **Stripe** | âœ… | âœ…å®Œå–„ | 2-7å¤© | æµ·å¤–ç”¨æˆ· |
| **PayPal** | âœ… | âœ…å®Œå–„ | å³æ—¶ | å…¨çƒç”¨æˆ· |
| **æ”¯ä»˜å®** | âŒ | âœ…æœ‰ | 3-9å¤© | ä¸­å›½ç”¨æˆ· |
| **å¾®ä¿¡** | âŒ | âš ï¸æœ‰é™ | 1-5å¤© | ä¸­å›½ç”¨æˆ· |

---

## ðŸ”§ å…­ã€ç»Ÿä¸€æµ‹è¯•æŽ¥å£

ç³»ç»Ÿæä¾›ç»Ÿä¸€çš„æ”¯ä»˜æŽ¥å£ï¼Œé€šè¿‡ `provider` å‚æ•°é€‰æ‹©æ¸ é“ï¼š

```bash
# åˆ›å»ºæ”¯ä»˜
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/create \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "stripe",      # stripe/paypal/alipay/wechat
    "amount": "19.90",
    "currency": "USD",         # USD/CNY/HKDç­‰
    "product_name": "æµ‹è¯•äº§å“"
  }'

# éªŒè¯æ”¯ä»˜
curl -X POST http://127.0.0.1:8001/api/v1/payment/unified/verify \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "stripe",
    "order_id": "è®¢å•ID"
  }'

# æŸ¥çœ‹å¯ç”¨æ¸ é“
curl http://127.0.0.1:8001/api/v1/payment/providers
```

---

## ðŸ“š ä¸ƒã€ç›¸å…³æ–‡æ¡£

- è¯¦ç»†é…ç½®æŒ‡å—ï¼š`docs/æ”¯ä»˜æ¸ é“é…ç½®æŒ‡å—.md`
- APIæ–‡æ¡£ï¼šhttp://127.0.0.1:8001/docs
- æµ‹è¯•è„šæœ¬ï¼š`./test_stripe_complete.sh`

---

## âš¡ å…«ã€å¿«é€Ÿå‘½ä»¤

```bash
# æŸ¥çœ‹é…ç½®
cat config/services.env | grep -E "STRIPE|PAYPAL|ALIPAY|WECHAT"

# å¯åŠ¨æœåŠ¡
./start_all_services.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/server_8001.log

# æµ‹è¯•Stripe
./test_stripe_complete.sh

# æŸ¥çœ‹APIæ–‡æ¡£
open http://127.0.0.1:8001/docs
```

---

**æ›´æ–°æ—¶é—´ï¼š2025-11-20**

