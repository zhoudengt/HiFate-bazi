# Coze Bot 提示词优化说明

## 🔴 问题诊断

**问题现象**：Bot 输出包含占位符（如 `{liunian.stem}`）和模板符号（如 `→`），输出过于机械、不自然。

**根本原因**：
1. 提示词中使用了 `{字段名}` 作为占位符，Bot 可能误以为这是输出格式
2. 提示词过于详细和模板化，Bot 机械套用
3. 缺少明确的"禁止占位符"指令

## ✅ 优化方案

### 1. 在提示词开头添加明确的格式要求

```markdown
## ⚠️ 输出格式要求（最重要）

**禁止以下行为**：
- ❌ 禁止输出 `{字段名}` 这样的占位符
- ❌ 禁止输出 `→` 这样的符号（除非在必要的地方）
- ❌ 禁止机械套用模板格式
- ❌ 禁止用列表堆砌内容

**必须做到**：
- ✅ 用自然流畅的语言表达，像资深命理师在说话
- ✅ 用段落和自然过渡，不要硬套格式
- ✅ 所有数据都要自然地融入分析中，不要显式标注字段名
- ✅ 用"您"、"您的"等人称，让分析更亲切
```

### 2. 将占位符改为自然语言说明

**修改前**（❌ 错误）：
```
- 流年干支：{liunian.stem}{liunian.branch}（{liunian.stem_element}{liunian.branch_element}）
```

**修改后**（✅ 正确）：
```
自然地介绍流年干支和五行（从输入数据的 liunian.stem、liunian.branch、liunian.stem_element、liunian.branch_element 获取）

示例（自然表达）：
"2025年为乙巳年（木火），天干正官，地支七杀。"

禁止这样写：
"流年干支：{liunian.stem}{liunian.branch}（{liunian.stem_element}{liunian.branch_element}）" ❌
```

### 3. 强调自然流畅原则

在"输出要求"部分开头添加：

```markdown
## ⚠️ 重要：自然流畅原则

**禁止机械套用模板！** 以下结构只是内容组织建议，不是固定格式。你必须：
- ✅ 用自然语言表达，像资深命理师在说话
- ✅ 根据实际数据灵活组织内容，不要硬套格式
- ✅ 避免出现 `{字段名}` 这样的占位符
- ✅ 避免出现 `→` 这样的符号（除非必要）
- ✅ 用流畅的段落表达，不要用列表堆砌
```

## 📝 更新步骤

1. **复制优化后的提示词**：
   - 打开 `docs/智能运势分析Bot提示词-知识库优先版.md`
   - 复制完整内容

2. **更新 Coze Bot 配置**：
   - 访问：https://www.coze.cn
   - 登录账号
   - 找到 Bot ID: `7576211240901509174`
   - 进入"提示词"或"系统提示"设置
   - 粘贴优化后的提示词
   - 保存

3. **测试验证**：
   - 运行测试脚本：`python3 scripts/tools/test_smart_fortune_api.py`
   - 检查输出是否还有占位符
   - 检查输出是否自然流畅

## 🎯 预期效果

**优化前**（❌ 错误输出）：
```
流年干支：{liunian.stem}{liunian.branch}（{liunian.stem_element}{liunian.branch_element}）
规则提到"身旺" → 说明对应wangshuai字段
```

**优化后**（✅ 正确输出）：
```
2025年为乙巳年（木火），天干正官，地支七杀。您当前大运为甲申，日主为戊土，身旺。

根据知识库匹配，共找到财运相关规则5条。其中一条规则提到"身旺财弱，求财困难"，这与您当前身旺（偏旺）的状态相符。您的喜神为金水，但被忌神火土严重克制，财源受阻。
```

## ⚠️ 注意事项

1. **占位符是给 Bot 的指令，不是输出格式**：
   - `{liunian.stem}` 是告诉 Bot 从哪里获取数据
   - Bot 应该输出实际值（如"乙"），而不是占位符

2. **结构是建议，不是模板**：
   - 十个部分只是内容组织建议
   - Bot 应该根据实际数据灵活组织，不要硬套

3. **自然语言优先**：
   - 用段落和自然过渡
   - 避免列表堆砌
   - 像资深命理师在说话

---

**更新完成后，请重新测试智能运势分析功能，确认输出自然流畅。**

