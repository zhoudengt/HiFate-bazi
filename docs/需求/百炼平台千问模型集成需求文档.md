# 百炼平台千问模型集成需求文档

> 创建时间：2026-01-07
> 状态：**已完成开发，可投入使用**

---

## 一、需求背景

当前系统使用 Coze 平台的大模型进行八字分析，为了进行模型对比评测，需要引入阿里云百炼平台的通义千问模型，实现两个平台的并行对比评测。

## 二、目标

1. 在百炼平台创建各分析场景的智能体应用
2. 在现有评测系统中集成百炼平台调用
3. 实现 Coze 与百炼的并行评测对比
4. 不影响现有生产环境功能

---

## 三、整体工作分工

### 3.1 用户需完成的工作（百炼平台配置）

#### 第一步：获取百炼平台访问权限

1. 登录阿里云百炼控制台：https://bailian.console.aliyun.com/
2. 获取 **API Key**（DASHSCOPE_API_KEY）
   - 在控制台右上角 → API-KEY 管理 → 创建 API Key

#### 第二步：创建智能体应用

需要为每个分析场景创建一个智能体，共 **8 个智能体**：

| 序号 | 场景名称 | 说明 | app_id（待填写） |
|-----|---------|-----|-----------------|
| 1 | 五行占比分析 | 分析八字五行分布 | |
| 2 | 喜神忌神分析 | 分析喜用神和忌神 | |
| 3 | 事业财富分析 | 事业和财运分析 | |
| 4 | 感情婚姻分析 | 婚姻感情分析 | |
| 5 | 身体健康分析 | 健康运势分析 | |
| 6 | 子女学习分析 | 子女运和学业分析 | |
| 7 | 总评分析 | 八字综合总评 | |
| 8 | 每日运势分析 | 每日运势预测 | |

**每个智能体创建步骤：**
1. 百炼控制台 → 应用管理 → 创建应用 → 选择"智能体应用"
2. 选择基础模型（如 通义千问-Plus 或 通义千问-Max）
3. 配置 System Prompt（可参考现有 Coze Bot 的 Prompt，见下方参考位置）
4. 发布应用，获取 **app_id**

#### 第三步：记录配置信息（已完成）

配置信息：

```
API Key: sk-91ad3ec784b64fe78c4015827dfd982d

App ID 列表：
- 五行解析: d326e553a5764d9bac629e87019ac380
- 喜神与忌神: b9188eacd5bc4e1d8b91bd66ef8671df
- 事业财富: 0f97307f05d041d2b643c967f98f4cbb
- 感情婚姻: 4bf72d82f83d439cb575856e5bcb8502
- 身体健康: 1e9186468bf743a0be8748e0cddd5f44
- 子女学习: a7d2174380be49508ecb5e014c54fc3a
- 总评分析: 75d9a46f55374ea2be1ea28db10c8d03
- 每日运势: df11520293eb479a985916d977904a8a
- QA-问题生成: 835867a183cd4a0db861c61f632bbaa6
- QA-命理分析: b9188eacd5bc4e1d8b91bd66ef8671df
```

### 3.2 开发需完成的工作（代码开发）

在百炼平台配置完成后，开发以下内容：

1. **创建百炼模块** (`scripts/evaluation/bailian/`)
   - `__init__.py` - 模块初始化
   - `bailian_client.py` - 百炼平台 API 客户端（流式调用）
   - `config.py` - 配置管理（存放 app_id 映射）

2. **修改评测系统**
   - `api_client.py` - 支持双平台调用
   - `bazi_evaluator.py` - 支持并行评测
   - `excel_handler.py` - 增加百炼结果列

3. **添加依赖**
   - 在 `requirements.txt` 添加 `dashscope>=1.14.0`

---

## 四、技术方案

### 4.1 目录结构

```
scripts/evaluation/
├── bailian/                    # 新增: 百炼平台独立模块
│   ├── __init__.py
│   ├── bailian_client.py       # 百炼平台 API 客户端
│   └── config.py               # 百炼平台配置（app_id 映射）
├── api_client.py               # 修改: 增加双平台支持
├── bazi_evaluator.py           # 修改: 支持并行评测
├── config.py                   # 修改: 增加平台配置
├── excel_handler.py            # 修改: 增加对比结果列
└── ...
```

### 4.2 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      评测系统 (BaziEvaluator)                │
├─────────────────────────────────────────────────────────────┤
│                         ApiClient                           │
│                    ┌──────────┬──────────┐                  │
│                    │          │          │                  │
│                    ▼          │          ▼                  │
│             ┌──────────┐      │    ┌──────────────┐         │
│             │  Coze    │      │    │  Bailian     │         │
│             │  平台    │      │    │  平台        │         │
│             └──────────┘      │    └──────────────┘         │
│                               │                             │
│                    ┌──────────┴──────────┐                  │
│                    │                     │                  │
│                    ▼                     ▼                  │
│             ┌──────────────────────────────────┐            │
│             │   Excel 输出（并排对比结果）      │            │
│             └──────────────────────────────────┘            │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 使用方式

```bash
# 仅使用 Coze（现有行为）
python bazi_evaluator.py --input test.xlsx --platform coze

# 仅使用百炼
python bazi_evaluator.py --input test.xlsx --platform bailian

# 并行对比评测（默认）
python bazi_evaluator.py --input test.xlsx --platform both
```

---

## 五、参考资料

### 5.1 现有 Coze Bot Prompt 参考位置

- 事业财富分析：`docs/需求/Coze_Bot_System_Prompt_事业财富分析.md`
- 感情婚姻分析：`docs/需求/Coze_Bot_System_Prompt_感情婚姻分析.md`
- 身体健康分析：`docs/需求/Coze_Bot_System_Prompt_身体健康分析.md`
- 子女学习分析：`docs/需求/Coze_Bot_System_Prompt_子女学习分析.md`
- 总评分析：`docs/需求/Coze_Bot_System_Prompt_总评分析.md`
- 通用总评：`docs/coze_bot_prompt_general_review.md`
- Bot 配置说明：`docs/coze_bot_configuration.md`

### 5.2 百炼平台文档

- 百炼控制台：https://bailian.console.aliyun.com/
- DashScope API 文档：https://help.aliyun.com/zh/dashscope/
- 智能体应用开发：https://help.aliyun.com/zh/model-studio/

### 5.3 现有评测系统位置

- 评测脚本：`scripts/evaluation/bazi_evaluator.py`
- API 客户端：`scripts/evaluation/api_client.py`
- 配置文件：`scripts/evaluation/config.py`
- 使用说明：`scripts/evaluation/README.md`

---

## 六、工作流程

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   用户工作       │     │   开发工作       │     │   评测使用       │
├─────────────────┤     ├─────────────────┤     ├─────────────────┤
│ 1. 获取 API Key │ ──► │ 1. 开发百炼模块  │ ──► │ 运行评测脚本     │
│ 2. 创建8个智能体│     │ 2. 修改评测系统  │     │ 得到对比结果     │
│ 3. 记录 app_id  │     │ 3. 测试验证      │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

---

## 七、待办事项

- [x] 用户：获取百炼平台 API Key（已完成）
- [x] 用户：创建 10 个智能体应用（已完成，含 QA 相关）
- [x] 用户：记录 app_id 到本文档（已完成）
- [x] 开发：创建百炼模块（已完成：`scripts/evaluation/bailian/`）
- [x] 开发：修改评测系统支持双平台（已完成）
- [x] 开发：测试验证（已完成：API 调用测试通过）
- [ ] 完成对比评测（待执行）

---

## 八、备注

- 百炼平台智能体创建完成后，请在本文档第三节填写 app_id
- 如有问题，可随时沟通调整方案

