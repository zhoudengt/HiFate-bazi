# éƒ¨ç½²é…ç½®æ­¥éª¤ - ç«‹å³æ‰§è¡Œ

> æ‰€æœ‰é…ç½®æ–‡ä»¶å·²æäº¤åˆ° GitHubï¼Œç°åœ¨éœ€è¦é…ç½®æœåŠ¡å™¨å’Œ GitHub Actions

## âœ… å·²å®Œæˆ

- âœ… ä»£ç å·²æ¨é€åˆ° GitHub
- âœ… master åˆ†æ”¯å·²æ›´æ–°
- âœ… develop åˆ†æ”¯å·²åˆ›å»º
- âœ… Git Flow å·¥ä½œæµå·²é…ç½®
- âœ… Docker é…ç½®æ–‡ä»¶å·²åˆ›å»º
- âœ… GitHub Actions é…ç½®æ–‡ä»¶å·²åˆ›å»º

**GitHub ä»“åº“**ï¼šhttps://github.com/zhoudengt/HiFate-bazi

---

## ğŸ“‹ åç»­æ­¥éª¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰

### æ­¥éª¤ 1ï¼šæµ‹è¯•æœ¬åœ° Docker å¼€å‘ç¯å¢ƒï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/zhoudt/Downloads/project/HiFate-bazi

# 2. å¯åŠ¨ Docker å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# 3. è®¿é—®æµ‹è¯•ï¼ˆåœ¨æ–°ç»ˆç«¯ï¼‰
open http://localhost:8001/frontend/formula-analysis.html

# 4. æµ‹è¯•çƒ­æ›´æ–°
# ä¿®æ”¹ä»»æ„ Python æ–‡ä»¶ï¼Œè§‚å¯Ÿå®¹å™¨æ—¥å¿—è‡ªåŠ¨é‡è½½

# 5. åœæ­¢ï¼ˆCtrl+C æˆ–æ–°ç»ˆç«¯æ‰§è¡Œï¼‰
docker-compose -f docker-compose.yml -f docker-compose.dev.yml down
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… æ‰€æœ‰å®¹å™¨å¯åŠ¨æˆåŠŸ
- âœ… å‰ç«¯é¡µé¢å¯ä»¥è®¿é—®
- âœ… ä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡è½½

---

### æ­¥éª¤ 2ï¼šé…ç½® GitHub Secretsï¼ˆç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼Œ10åˆ†é’Ÿï¼‰

#### 2.1 è®¿é—® GitHub Secrets é¡µé¢

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
https://github.com/zhoudengt/HiFate-bazi/settings/secrets/actions
```

#### 2.2 æ·»åŠ å¼€å‘æœåŠ¡å™¨é…ç½®ï¼ˆå¦‚æœæœ‰å¼€å‘æœåŠ¡å™¨ï¼‰

ç‚¹å‡» **New repository secret**ï¼Œä¾æ¬¡æ·»åŠ ï¼š

| Name | Value | è¯´æ˜ |
|------|-------|------|
| `DEV_SERVER_HOST` | `dev.hifate.com` æˆ– IP | å¼€å‘æœåŠ¡å™¨åœ°å€ |
| `DEV_SERVER_USER` | `deploy` | å¼€å‘æœåŠ¡å™¨ç”¨æˆ·å |
| `DEV_SSH_PRIVATE_KEY` | å®Œæ•´çš„ç§é’¥å†…å®¹ | SSH ç§é’¥ï¼ˆè§ä¸‹æ–‡ï¼‰ |

**å¦‚ä½•è·å– SSH ç§é’¥**ï¼š
```bash
# åœ¨å¼€å‘æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cat ~/.ssh/id_ed25519

# æˆ–è€…
cat ~/.ssh/id_rsa

# å¤åˆ¶å®Œæ•´è¾“å‡ºï¼ˆåŒ…æ‹¬ BEGIN å’Œ END è¡Œï¼‰
```

#### 2.3 æ·»åŠ ç”Ÿäº§æœåŠ¡å™¨é…ç½®ï¼ˆå¦‚æœæœ‰ç”Ÿäº§æœåŠ¡å™¨ï¼‰

| Name | Value | è¯´æ˜ |
|------|-------|------|
| `PROD_SERVER_HOST` | `hifate.com` æˆ– IP | ç”Ÿäº§æœåŠ¡å™¨åœ°å€ |
| `PROD_SERVER_USER` | `deploy` | ç”Ÿäº§æœåŠ¡å™¨ç”¨æˆ·å |
| `PROD_SSH_PRIVATE_KEY` | å®Œæ•´çš„ç§é’¥å†…å®¹ | SSH ç§é’¥ |

#### 2.4 éªŒè¯é…ç½®

é…ç½®å®Œæˆåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š
- âœ… DEV_SERVER_HOST
- âœ… DEV_SERVER_USER
- âœ… DEV_SSH_PRIVATE_KEY
- âœ… PROD_SERVER_HOST
- âœ… PROD_SERVER_USER
- âœ… PROD_SSH_PRIVATE_KEY

**æ³¨æ„**ï¼šå¦‚æœæš‚æ—¶åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œå¯ä»¥å…ˆé…ç½®å¼€å‘æˆ–ç”Ÿäº§å…¶ä¸­ä¸€ä¸ªã€‚

---

### æ­¥éª¤ 3ï¼šæœåŠ¡å™¨å‡†å¤‡ï¼ˆå¦‚æœè¿˜æ²¡æœ‰æœåŠ¡å™¨ï¼Œè·³è¿‡æ­¤æ­¥éª¤ï¼‰

#### 3.1 å®‰è£… Dockerï¼ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh root@your-server-ip

# å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# å¯åŠ¨ Docker
systemctl start docker
systemctl enable docker

# éªŒè¯
docker --version
docker-compose --version
```

#### 3.2 åˆ›å»ºéƒ¨ç½²ç”¨æˆ·

```bash
# åˆ›å»ºéƒ¨ç½²ç”¨æˆ·
useradd -m -s /bin/bash deploy
usermod -aG docker deploy

# è®¾ç½®å¯†ç ï¼ˆå¯é€‰ï¼‰
passwd deploy

# åˆ‡æ¢åˆ°éƒ¨ç½²ç”¨æˆ·
su - deploy
```

#### 3.3 é…ç½® SSH å¯†é’¥

```bash
# ç”Ÿæˆ SSH å¯†é’¥
ssh-keygen -t ed25519 -C "deploy@your-server"

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519.pub

# å°†å…¬é’¥æ·»åŠ åˆ° GitHub
# è®¿é—® https://github.com/settings/keys
# ç‚¹å‡» "New SSH key"ï¼Œç²˜è´´å…¬é’¥

# æµ‹è¯•è¿æ¥
ssh -T git@github.com
```

#### 3.4 å…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /opt
sudo chown deploy:deploy /opt

# å…‹éš†é¡¹ç›®
cd /opt
git clone git@github.com:zhoudengt/HiFate-bazi.git
cd HiFate-bazi
```

#### 3.5 é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®
vim .env

# ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
# MYSQL_ROOT_PASSWORD=ç”Ÿäº§ç¯å¢ƒå¼ºå¯†ç 
# REDIS_PASSWORD=ç”Ÿäº§ç¯å¢ƒå¯†ç 
# SECRET_KEY=ç”Ÿäº§ç¯å¢ƒå¯†é’¥

# ç”Ÿæˆå¼ºå¯†ç ï¼ˆå¯é€‰ï¼‰
openssl rand -base64 32
```

#### 3.6 é¦–æ¬¡éƒ¨ç½²

**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```bash
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

#### 3.7 éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æµ‹è¯• API
curl http://localhost:8001/api/health
```

---

### æ­¥éª¤ 4ï¼šæµ‹è¯•è‡ªåŠ¨éƒ¨ç½²ï¼ˆ5åˆ†é’Ÿï¼‰

#### 4.1 æµ‹è¯• develop åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²

```bash
# æœ¬åœ°åˆ‡æ¢åˆ° develop åˆ†æ”¯
cd /Users/zhoudt/Downloads/project/HiFate-bazi
git checkout develop

# åˆ›å»ºæµ‹è¯•æäº¤
echo "# æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²" >> README.md
git add README.md
git commit -m "[æµ‹è¯•] æµ‹è¯• develop è‡ªåŠ¨éƒ¨ç½²"
git push origin develop
```

#### 4.2 æŸ¥çœ‹éƒ¨ç½²è¿›åº¦

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
https://github.com/zhoudengt/HiFate-bazi/actions
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š
- âœ… "ğŸš€ Deploy to Development" å·¥ä½œæµæ­£åœ¨è¿è¡Œ
- âœ… éƒ¨ç½²æ­¥éª¤é€æ­¥æ‰§è¡Œ
- âœ… æœ€ç»ˆæ˜¾ç¤º "âœ… éƒ¨ç½²æˆåŠŸ"

#### 4.3 æµ‹è¯• master åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²

```bash
# åˆ‡æ¢åˆ° master
git checkout master

# åˆå¹¶ develop
git merge develop
git push origin master
```

å†æ¬¡è®¿é—®ï¼š
```
https://github.com/zhoudengt/HiFate-bazi/actions
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š
- âœ… "ğŸš€ Deploy to Production" å·¥ä½œæµæ­£åœ¨è¿è¡Œ

---

## ğŸ¯ æ—¥å¸¸å¼€å‘æµç¨‹ï¼ˆé‡è¦ï¼ï¼‰

### åœºæ™¯ 1ï¼šå¼€å‘æ–°åŠŸèƒ½

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b feature/æˆ‘çš„æ–°åŠŸèƒ½

# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# 3. å¼€å‘ä»£ç ...
vim server/api/v1/my_feature.py

# 4. æœ¬åœ°æµ‹è¯•
open http://localhost:8001

# 5. æäº¤ä»£ç ï¼ˆä½¿ç”¨æäº¤åŠ©æ‰‹ï¼‰
./scripts/commit-helper.sh

# æˆ–æ‰‹åŠ¨æäº¤
git add .
git commit -m "[æ–°å¢] åŠŸèƒ½æè¿°"
git push origin feature/æˆ‘çš„æ–°åŠŸèƒ½

# 6. åˆå¹¶åˆ° developï¼ˆè§¦å‘å¼€å‘ç¯å¢ƒéƒ¨ç½²ï¼‰
git checkout develop
git merge feature/æˆ‘çš„æ–°åŠŸèƒ½
git push origin develop
# ğŸš€ è‡ªåŠ¨éƒ¨ç½²åˆ°å¼€å‘æœåŠ¡å™¨ï¼

# 7. æµ‹è¯•é€šè¿‡åå‘å¸ƒåˆ°ç”Ÿäº§
git checkout master
git merge develop
git push origin master
# ğŸš€ è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨ï¼
```

### åœºæ™¯ 2ï¼šå¿«é€Ÿä¿®å¤

```bash
# 1. ä» master åˆ›å»º hotfix åˆ†æ”¯
git checkout master
git pull origin master
git checkout -b hotfix/ä¿®å¤é—®é¢˜

# 2. ä¿®å¤é—®é¢˜...
vim server/api/v1/some_file.py

# 3. æœ¬åœ°æµ‹è¯•
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# 4. æäº¤å¹¶åˆå¹¶åˆ° master
git add .
git commit -m "[ä¿®å¤] é—®é¢˜æè¿°"
git checkout master
git merge hotfix/ä¿®å¤é—®é¢˜
git push origin master
# ğŸš€ è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ï¼

# 5. åŒæ—¶åˆå¹¶åˆ° developï¼ˆä¿æŒåŒæ­¥ï¼‰
git checkout develop
git merge hotfix/ä¿®å¤é—®é¢˜
git push origin develop
```

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### Docker å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# åå°å¯åŠ¨
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d

# åœæ­¢
docker-compose -f docker-compose.yml -f docker-compose.dev.yml down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f web

# é‡å¯æœåŠ¡
docker-compose restart web

# è¿›å…¥å®¹å™¨
docker-compose exec web bash

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune -a
```

### Git å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
git status

# æŸ¥çœ‹åˆ†æ”¯
git branch -a

# åˆ‡æ¢åˆ†æ”¯
git checkout develop

# åˆ›å»ºåˆ†æ”¯
git checkout -b feature/new-feature

# åˆå¹¶åˆ†æ”¯
git merge feature/branch-name

# æŸ¥çœ‹æäº¤å†å²
git log --oneline -10
```

### æäº¤åŠ©æ‰‹

```bash
# æäº¤å‰æ£€æŸ¥
./scripts/pre-commit-check.sh

# ä½¿ç”¨æäº¤åŠ©æ‰‹ï¼ˆæ¨èï¼‰
./scripts/commit-helper.sh
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šDocker å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs

# æ¸…ç†å¹¶é‡å¯
docker-compose down
docker system prune -a
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

### é—®é¢˜ 2ï¼šGitHub Actions éƒ¨ç½²å¤±è´¥

1. è®¿é—®ï¼šhttps://github.com/zhoudengt/HiFate-bazi/actions
2. ç‚¹å‡»å¤±è´¥çš„å·¥ä½œæµæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
3. æ£€æŸ¥ GitHub Secrets é…ç½®æ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥æœåŠ¡å™¨ SSH è¿æ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜ 3ï¼šæ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

```bash
# æµ‹è¯• SSH è¿æ¥
ssh deploy@your-server-host

# æµ‹è¯• GitHub SSH
ssh -T git@github.com
```

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `.cursorrules` | AI å¼€å‘è§„èŒƒ |
| `docs/Git-Flowå·¥ä½œæµç¨‹.md` | åˆ†æ”¯ç®¡ç†è¯¦ç»†è¯´æ˜ |
| `docs/éƒ¨ç½²æ–¹æ¡ˆ5-Dockerè‡ªåŠ¨åŒ–éƒ¨ç½².md` | å®Œæ•´éƒ¨ç½²æ¶æ„ |
| `docs/å¿«é€Ÿå¼€å§‹-å¼€å‘è€…å¿…è¯».md` | å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ |
| `docs/éƒ¨ç½²é…ç½®æ­¥éª¤.md` | æœ¬æ–‡æ¡£ |

---

## âœ… æ£€æŸ¥æ¸…å•

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

- [ ] Docker Desktop å·²å®‰è£…
- [ ] æœ¬åœ°å¼€å‘ç¯å¢ƒæµ‹è¯•é€šè¿‡
- [ ] çƒ­æ›´æ–°åŠŸèƒ½æ­£å¸¸

### GitHub é…ç½®

- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] develop åˆ†æ”¯å·²åˆ›å»º
- [ ] GitHub Secrets å·²é…ç½®

### æœåŠ¡å™¨é…ç½®ï¼ˆå¦‚æœ‰ï¼‰

- [ ] Docker å·²å®‰è£…
- [ ] éƒ¨ç½²ç”¨æˆ·å·²åˆ›å»º
- [ ] SSH å¯†é’¥å·²é…ç½®
- [ ] é¡¹ç›®å·²å…‹éš†
- [ ] é¦–æ¬¡éƒ¨ç½²æˆåŠŸ

### è‡ªåŠ¨éƒ¨ç½²æµ‹è¯•

- [ ] develop åˆ†æ”¯æ¨é€è§¦å‘éƒ¨ç½²
- [ ] master åˆ†æ”¯æ¨é€è§¦å‘éƒ¨ç½²
- [ ] GitHub Actions è¿è¡Œæ­£å¸¸

---

## ğŸ‰ å®Œæˆï¼

ä¸€åˆ‡é…ç½®å®Œæˆåï¼Œä½ å°†æ‹¥æœ‰ï¼š

âœ… **æœ¬åœ°å¼€å‘**ï¼šDocker çƒ­æ›´æ–°ï¼Œä¿®æ”¹å³ç”Ÿæ•ˆ  
âœ… **è‡ªåŠ¨éƒ¨ç½²**ï¼šæ¨é€ä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨  
âœ… **è§„èŒƒæµç¨‹**ï¼šGit Flow ä¸‰ç¯å¢ƒç®¡ç†  
âœ… **æ™ºèƒ½æé†’**ï¼šAI åŠ©æ‰‹æé†’æäº¤ä»£ç   
âœ… **è´¨é‡ä¿è¯**ï¼šæäº¤å‰è‡ªåŠ¨æ£€æŸ¥  

---

**å¼€å§‹ä½ çš„é«˜æ•ˆå¼€å‘ä¹‹æ—…å§ï¼** ğŸš€

















