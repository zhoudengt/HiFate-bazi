# å¾®æœåŠ¡ç®¡ç†å¿«é€Ÿå‚è€ƒ

## ğŸš€ æ—¥å¸¸æ“ä½œ

### å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
./start_all_services.sh
```

### åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
./stop_all_services.sh
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
./check_services.sh
```

### é‡å¯æ‰€æœ‰æœåŠ¡

```bash
./stop_all_services.sh && ./start_all_services.sh
```

## ğŸ” é—®é¢˜æ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i:9001  # æ›¿æ¢ä¸ºå®é™…ç«¯å£

# 2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
tail -f logs/bazi_core_9001.log

# 3. æŸ¥çœ‹æœ€å10è¡Œæ—¥å¿—
tail -n 10 logs/bazi_core_9001.log

# 4. æœç´¢é”™è¯¯ä¿¡æ¯
grep -i error logs/*.log
```

### æœåŠ¡æ— æ³•åœæ­¢

```bash
# 1. æŸ¥æ‰¾è¿›ç¨‹ PID
lsof -ti:9001

# 2. å¼ºåˆ¶æ€æ­»è¿›ç¨‹
kill -9 <PID>

# 3. æ¸…ç†æ®‹ç•™æ–‡ä»¶
rm -f logs/bazi_core_9001.pid
```

### æ•°æ®ç±»å‹é”™è¯¯

å¦‚æœé‡åˆ° `'str' object has no attribute 'get'` é”™è¯¯ï¼š

1. **æ£€æŸ¥æ‰€æœ‰å¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ**
   ```bash
   ./check_services.sh
   ```

2. **é‡å¯æ‰€æœ‰æœåŠ¡**
   ```bash
   ./stop_all_services.sh && ./start_all_services.sh
   ```

3. **æŸ¥çœ‹å…·ä½“é”™è¯¯æ—¥å¿—**
   ```bash
   tail -f logs/web_app_8001.log
   ```

## ğŸ“‹ æ·»åŠ æ–°å¾®æœåŠ¡æ¸…å•

æ¯æ¬¡æ·»åŠ æ–°å¾®æœåŠ¡æ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ“ä½œï¼š

- [ ] 1. åˆ›å»ºæœåŠ¡ç›®å½• `services/new_service/`
- [ ] 2. åˆ›å»º `grpc_server.py`ï¼ˆå¿…é¡»æ”¯æŒ `--port` å‚æ•°ï¼‰
- [ ] 3. åˆ›å»ºä¸šåŠ¡é€»è¾‘æ–‡ä»¶ `main.py`
- [ ] 4. **å¿…é¡»ï¼šæ›´æ–° `start_all_services.sh`**
- [ ] 5. **å¿…é¡»ï¼šæ›´æ–° `stop_all_services.sh`**
- [ ] 6. æ›´æ–° `config/services.env`ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] 7. æµ‹è¯•ç‹¬ç«‹å¯åŠ¨ï¼š`python services/new_service/grpc_server.py --port 9008`
- [ ] 8. æµ‹è¯•é›†æˆå¯åŠ¨ï¼š`./start_all_services.sh`
- [ ] 9. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š`./check_services.sh`
- [ ] 10. æµ‹è¯•æœåŠ¡åœæ­¢ï¼š`./stop_all_services.sh`
- [ ] 11. æ›´æ–°æ–‡æ¡£
- [ ] 12. Git æäº¤ï¼ˆæ³¨æ˜ä¿®æ”¹äº†å¯åŠ¨/åœæ­¢è„šæœ¬ï¼‰

## ğŸ¯ æœåŠ¡ç«¯å£ä¸€è§ˆ

| æœåŠ¡å | ç«¯å£ | ç”¨é€” |
|--------|------|------|
| `bazi_core` | 9001 | å…«å­—æ ¸å¿ƒè®¡ç®— |
| `bazi_fortune` | 9002 | å¤§è¿æµå¹´è®¡ç®— |
| `bazi_analyzer` | 9003 | å…«å­—åˆ†æ |
| `bazi_rule` | 9004 | è§„åˆ™åŒ¹é… |
| `fortune_analysis` | 9005 | é¢ç›¸/æ‰‹ç›¸åˆ†æ |
| `payment_service` | 9006 | æ”¯ä»˜æœåŠ¡ |
| `fortune_rule` | 9007 | è¿åŠ¿è§„åˆ™å¼•æ“ |
| `web_app` | 8001 | Web åº”ç”¨ä¸»å…¥å£ |

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯ 1: `'str' object has no attribute 'get'`

**åŸå› ï¼š** æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œé€šå¸¸æ˜¯å¾®æœåŠ¡æœªæ­£ç¡®å¯åŠ¨å¯¼è‡´

**è§£å†³ï¼š**
```bash
./check_services.sh  # æ£€æŸ¥æœåŠ¡çŠ¶æ€
./start_all_services.sh  # å¯åŠ¨æ‰€æœ‰æœåŠ¡
```

### é”™è¯¯ 2: `ç«¯å£å·²è¢«å ç”¨`

**åŸå› ï¼š** æœåŠ¡å·²ç»åœ¨è¿è¡Œæˆ–ç«¯å£è¢«å…¶ä»–ç¨‹åºå ç”¨

**è§£å†³ï¼š**
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i:9001

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# é‡æ–°å¯åŠ¨
./start_all_services.sh
```

### é”™è¯¯ 3: `æœåŠ¡æ— æ³•è¿æ¥`

**åŸå› ï¼š** æœåŠ¡æœªå¯åŠ¨æˆ–ç½‘ç»œé…ç½®é—®é¢˜

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
./check_services.sh

# æµ‹è¯•æœ¬åœ°è¿æ¥
curl http://127.0.0.1:9001/health

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/bazi_core_9001.log
```

## ğŸ› ï¸ è°ƒè¯•å‘½ä»¤

### æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„æœåŠ¡

```bash
ps aux | grep "grpc_server.py\|server/start.py" | grep -v grep
```

### æŸ¥çœ‹æ‰€æœ‰ç›‘å¬çš„ç«¯å£

```bash
lsof -iTCP -sTCP:LISTEN | grep -E "9001|9002|9003|9004|9005|9006|9007|8001"
```

### æ¸…ç†æ‰€æœ‰æ®‹ç•™æ–‡ä»¶

```bash
# æ¸…ç† PID æ–‡ä»¶
rm -f logs/*.pid

# æ¸…ç†æ—§æ—¥å¿—ï¼ˆæ…ç”¨ï¼ï¼‰
# rm -f logs/*.log
```

### æµ‹è¯•æœåŠ¡å“åº”

```bash
# æµ‹è¯•å…«å­—è®¡ç®—æœåŠ¡
curl -X POST http://127.0.0.1:8001/api/v1/bazi/calculate \
  -H "Content-Type: application/json" \
  -d '{"solar_date":"1987-01-07","solar_time":"09:55","gender":"male"}' \
  | jq .

# æµ‹è¯•ä»Šæ—¥è¿åŠ¿
curl -X POST http://127.0.0.1:8001/api/v1/bazi/daily-fortune \
  -H "Content-Type: application/json" \
  -d '{"solar_date":"1987-01-07","solar_time":"09:55","gender":"male"}' \
  | jq .
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘è§„èŒƒå®Œæ•´ç‰ˆ](./DEVELOPMENT_GUIDELINES.md)
- [å¾®æœåŠ¡é”™è¯¯æ’æŸ¥](./å¾®æœåŠ¡é‡å¯é”™è¯¯æ’æŸ¥.md)
- [æœåŠ¡å¯åŠ¨æŒ‡å—](../å¯åŠ¨æœåŠ¡æŒ‡å—.md)

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å¼€å‘å‰æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   ./check_services.sh
   ```

2. **ä¿®æ”¹ä»£ç åé‡å¯æœåŠ¡**
   ```bash
   ./stop_all_services.sh && ./start_all_services.sh
   ```

3. **éƒ¨ç½²å‰æµ‹è¯•æœåŠ¡**
   ```bash
   ./check_services.sh
   # ç¡®ä¿æ‰€æœ‰æœåŠ¡éƒ½è¿è¡Œæ­£å¸¸
   ```

4. **å®šæœŸæŸ¥çœ‹æ—¥å¿—**
   ```bash
   tail -f logs/*.log
   ```

5. **æ·»åŠ æ–°æœåŠ¡å¿…é¡»æ›´æ–°è„šæœ¬**
   - `start_all_services.sh`
   - `stop_all_services.sh`
   - `check_services.sh`ï¼ˆå¯é€‰ï¼‰

---

**è®°ä½ï¼šå¾®æœåŠ¡ç®¡ç†æ˜¯ç³»ç»Ÿå·¥ç¨‹ï¼Œä»»ä½•å˜æ›´éƒ½è¦ç³»ç»Ÿæ€§åœ°æ›´æ–°æ‰€æœ‰ç›¸å…³é…ç½®ï¼**

