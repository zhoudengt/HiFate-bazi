# A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒå®Œæˆæ€»ç»“

## âœ… å®ŒæˆçŠ¶æ€

**æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ï¼**

---

## ğŸ“‹ å®Œæˆå†…å®¹

### 1. âœ… A/B æµ‹è¯•æ¡†æ¶

**æ–‡ä»¶**ï¼š
- `server/utils/ab_test.py` - A/B æµ‹è¯•æ ¸å¿ƒæ¡†æ¶
- `server/api/v1/ab_test.py` - A/B æµ‹è¯• API æ¥å£
- `tests/unit/test_ab_test.py` - å•å…ƒæµ‹è¯•

**åŠŸèƒ½**ï¼š
- âœ… å®éªŒåˆ›å»ºå’Œç®¡ç†
- âœ… æµé‡åˆ†é…ï¼ˆç™¾åˆ†æ¯”ï¼‰
- âœ… å˜ä½“åˆ†é…ï¼ˆA/B/Cç­‰ï¼‰
- âœ… äº‹ä»¶è®°å½•å’Œç»Ÿè®¡åˆ†æ
- âœ… å®éªŒçŠ¶æ€ç®¡ç†

**æµ‹è¯•ç»“æœ**ï¼šâœ… é€šè¿‡

---

### 2. âœ… åŠŸèƒ½å¼€å…³ï¼ˆFeature Flagï¼‰

**æ–‡ä»¶**ï¼š
- `server/utils/feature_flag.py` - åŠŸèƒ½å¼€å…³æ ¸å¿ƒæ¡†æ¶
- `server/api/v1/feature_flag.py` - åŠŸèƒ½å¼€å…³ API æ¥å£
- `tests/unit/test_feature_flag.py` - å•å…ƒæµ‹è¯•

**åŠŸèƒ½**ï¼š
- âœ… å¸ƒå°”å¼€å…³ï¼ˆå¼€å¯/å…³é—­ï¼‰
- âœ… ç™¾åˆ†æ¯”å¼€å…³ï¼ˆç°åº¦å‘å¸ƒï¼‰
- âœ… ç™½åå•/é»‘åå•
- âœ… å¼€å…³çŠ¶æ€ç®¡ç†

**æµ‹è¯•ç»“æœ**ï¼šâœ… é€šè¿‡

---

### 3. âœ… ç°åº¦å‘å¸ƒæµç¨‹

**æ–‡ä»¶**ï¼š
- `scripts/deployment/gray_release.sh` - ç°åº¦å‘å¸ƒè„šæœ¬
- `scripts/deployment/rollback_gray.sh` - ç°åº¦å‘å¸ƒå›æ»šè„šæœ¬

**åŠŸèƒ½**ï¼š
- âœ… æ„å»ºæ–°ç‰ˆæœ¬å®¹å™¨
- âœ… å¯åŠ¨ç°åº¦å®¹å™¨ï¼ˆä¸åŒç«¯å£ï¼‰
- âœ… æµé‡åˆ†é…é…ç½®æç¤º
- âœ… ç°åº¦å‘å¸ƒå›æ»š

**é›†æˆ**ï¼šâœ… å·²é›†æˆåˆ° `deploy.sh`ï¼ˆé€‰é¡¹ 8 å’Œ 10ï¼‰

---

### 4. âœ… æ•°æ®åº“å›æ»šæœºåˆ¶

**æ–‡ä»¶**ï¼š
- `scripts/deployment/rollback.sh` - æ•°æ®åº“å›æ»šè„šæœ¬
- `scripts/migration/create_rollback.sh` - åˆ›å»ºå›æ»šè„šæœ¬å·¥å…·
- `scripts/migration/rollback/README.md` - å›æ»šè„šæœ¬è¯´æ˜

**åŠŸèƒ½**ï¼š
- âœ… å›æ»šè„šæœ¬ç®¡ç†
- âœ… äº¤äº’å¼å›æ»šæ‰§è¡Œ
- âœ… å›æ»šæ—¥å¿—è®°å½•
- âœ… å›æ»šè„šæœ¬æ¨¡æ¿ç”Ÿæˆ

**é›†æˆ**ï¼šâœ… å·²é›†æˆåˆ° `deploy.sh`ï¼ˆé€‰é¡¹ 9ï¼‰

---

## ğŸ“ æ–°å¢æ–‡ä»¶ç»Ÿè®¡

### æ ¸å¿ƒä»£ç 
- `server/utils/ab_test.py` - A/B æµ‹è¯•æ¡†æ¶
- `server/utils/feature_flag.py` - åŠŸèƒ½å¼€å…³æ¡†æ¶
- `server/api/v1/ab_test.py` - A/B æµ‹è¯• API
- `server/api/v1/feature_flag.py` - åŠŸèƒ½å¼€å…³ API

### éƒ¨ç½²è„šæœ¬
- `scripts/deployment/gray_release.sh` - ç°åº¦å‘å¸ƒ
- `scripts/deployment/rollback_gray.sh` - ç°åº¦å›æ»š
- `scripts/deployment/rollback.sh` - æ•°æ®åº“å›æ»š
- `scripts/migration/create_rollback.sh` - åˆ›å»ºå›æ»šè„šæœ¬

### æµ‹è¯•æ–‡ä»¶
- `tests/unit/test_ab_test.py` - A/B æµ‹è¯•æµ‹è¯•
- `tests/unit/test_feature_flag.py` - åŠŸèƒ½å¼€å…³æµ‹è¯•

### æ–‡æ¡£
- `docs/A_Bæµ‹è¯•å’Œç°åº¦å‘å¸ƒæŒ‡å—.md` - ä½¿ç”¨æŒ‡å—
- `docs/A_Bæµ‹è¯•å’Œç°åº¦å‘å¸ƒå®Œæˆæ€»ç»“.md` - æœ¬æ–‡æ¡£
- `scripts/migration/rollback/README.md` - å›æ»šè„šæœ¬è¯´æ˜

**æ€»è®¡**ï¼š11 ä¸ªæ–°æ–‡ä»¶

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### A/B æµ‹è¯•æ¡†æ¶æµ‹è¯•

| æµ‹è¯•é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| åˆ›å»ºå®éªŒ | âœ… é€šè¿‡ | å®éªŒåˆ›å»ºå’Œç®¡ç†æ­£å¸¸ |
| åˆ†é…å˜ä½“ | âœ… é€šè¿‡ | å˜ä½“åˆ†é…æ­£å¸¸ï¼Œç”¨æˆ·ä¸€è‡´æ€§ä¿æŒ |
| æµé‡ç™¾åˆ†æ¯” | âœ… é€šè¿‡ | æµé‡åˆ†é…å‡†ç¡® |
| äº‹ä»¶è®°å½• | âœ… é€šè¿‡ | äº‹ä»¶è®°å½•å’Œç»Ÿè®¡æ­£å¸¸ |
| å®éªŒçŠ¶æ€ | âœ… é€šè¿‡ | çŠ¶æ€ç®¡ç†æ­£å¸¸ |

### åŠŸèƒ½å¼€å…³æµ‹è¯•

| æµ‹è¯•é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| å¸ƒå°”å¼€å…³ | âœ… é€šè¿‡ | å¼€å¯/å…³é—­æ­£å¸¸ |
| ç™¾åˆ†æ¯”å¼€å…³ | âœ… é€šè¿‡ | ç™¾åˆ†æ¯”åˆ†é…å‡†ç¡® |
| ç™½åå• | âœ… é€šè¿‡ | ç™½åå•åŠŸèƒ½æ­£å¸¸ |
| é»‘åå• | âœ… é€šè¿‡ | é»‘åå•åŠŸèƒ½æ­£å¸¸ |

**æ€»ä½“ç»“æœ**ï¼šâœ… **æ‰€æœ‰æµ‹è¯•é€šè¿‡**

---

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### A/B æµ‹è¯•

```python
from server.utils.ab_test import get_ab_test_manager, Experiment, ExperimentStatus

manager = get_ab_test_manager()
experiment = Experiment(
    name="æ–°ç®—æ³•æµ‹è¯•",
    status=ExperimentStatus.RUNNING,
    traffic_percent=50.0,
    variants={"A": 50, "B": 50}
)
manager.create_experiment(experiment)

variant = manager.assign_variant("æ–°ç®—æ³•æµ‹è¯•", user_id="user123")
```

### åŠŸèƒ½å¼€å…³

```python
from server.utils.feature_flag import get_feature_flag_manager, FeatureFlag, FlagType

manager = get_feature_flag_manager()
flag = FeatureFlag(
    name="æ–°åŠŸèƒ½",
    enabled=True,
    flag_type=FlagType.PERCENTAGE,
    value=10.0  # 10% æµé‡
)
manager.create_flag(flag)

enabled = manager.is_enabled("æ–°åŠŸèƒ½", user_id="user123")
```

### ç°åº¦å‘å¸ƒ

```bash
# ä½¿ç”¨ deploy.sh
./deploy.sh
# é€‰æ‹© 8) ç°åº¦å‘å¸ƒ

# æˆ–ç›´æ¥æ‰§è¡Œ
./scripts/deployment/gray_release.sh
```

### æ•°æ®åº“å›æ»š

```bash
# ä½¿ç”¨ deploy.sh
./deploy.sh
# é€‰æ‹© 9) æ•°æ®åº“å›æ»š

# æˆ–ç›´æ¥æ‰§è¡Œ
./scripts/deployment/rollback.sh
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### æ”¹è¿›å‰ vs æ”¹è¿›å

| åŠŸèƒ½ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| **A/B æµ‹è¯•** | âŒ æ—  | âœ… å®Œæ•´æ¡†æ¶ |
| **åŠŸèƒ½å¼€å…³** | âŒ æ—  | âœ… æ”¯æŒå¤šç§ç±»å‹ |
| **ç°åº¦å‘å¸ƒ** | âŒ æ—  | âœ… å®Œæ•´æµç¨‹ |
| **æ•°æ®åº“å›æ»š** | âŒ æ—  | âœ… è‡ªåŠ¨åŒ–å·¥å…· |

---

## ğŸ”„ é›†æˆåˆ° deploy.sh

`deploy.sh` æ–°å¢é€‰é¡¹ï¼š

- **8) ç°åº¦å‘å¸ƒ** - æ‰§è¡Œç°åº¦å‘å¸ƒæµç¨‹
- **9) æ•°æ®åº“å›æ»š** - æ‰§è¡Œæ•°æ®åº“å›æ»š
- **10) ç°åº¦å‘å¸ƒå›æ»š** - å›æ»šæ­£åœ¨è¿›è¡Œçš„ç°åº¦å‘å¸ƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒæŒ‡å—](./A_Bæµ‹è¯•å’Œç°åº¦å‘å¸ƒæŒ‡å—.md) - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- [éƒ¨ç½²æ–‡æ¡£](./Dockerç”Ÿäº§éƒ¨ç½²å®Œæ•´æŒ‡å—.md) - éƒ¨ç½²æŒ‡å—
- [æµ‹è¯•æŒ‡å—](./æµ‹è¯•å’Œä»£ç æ£€æŸ¥æŒ‡å—.md) - æµ‹è¯•æŒ‡å—

---

## âœ¨ æ€»ç»“

æœ¬æ¬¡å®Œå–„æˆåŠŸå®ç°äº†ï¼š

1. âœ… **A/B æµ‹è¯•æœºåˆ¶** - å®Œæ•´çš„ A/B æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒå®éªŒç®¡ç†ã€æµé‡åˆ†é…ã€äº‹ä»¶è®°å½•
2. âœ… **ç°åº¦å‘å¸ƒæµç¨‹** - å®Œæ•´çš„ç°åº¦å‘å¸ƒæµç¨‹ï¼Œæ”¯æŒé€æ­¥å‘å¸ƒå’Œå›æ»š
3. âœ… **æ•°æ®åº“å›æ»šæœºåˆ¶** - è‡ªåŠ¨åŒ–æ•°æ®åº“å›æ»šå·¥å…·ï¼Œæ”¯æŒè„šæœ¬ç®¡ç†å’Œæ‰§è¡Œ

**æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ï¼** ğŸ‰

---

**å®Œæˆæ—¶é—´**ï¼š2025-01-XX  
**å®ŒæˆçŠ¶æ€**ï¼šâœ… å…¨éƒ¨å®Œæˆ

