# é…ç½®æ•°æ®åº“åŒ–å®æ–½è¿›åº¦

## âœ… å·²å®Œæˆ

### 1. æ•°æ®åº“è¡¨åˆ›å»º
- âœ… `service_configs` è¡¨ï¼ˆæœåŠ¡é…ç½®è¡¨ï¼‰
- âœ… `llm_input_formats` è¡¨ï¼ˆLLMè¾“å…¥æ ¼å¼å®šä¹‰è¡¨ï¼‰

### 2. æ•°æ®è¿ç§»
- âœ… è¿ç§» `services.env` æ•°æ®åˆ°æ•°æ®åº“ï¼ˆ29ä¸ªé…ç½®é¡¹ï¼‰
- âœ… åˆ›å»ºæ ¼å¼å®šä¹‰åˆå§‹æ•°æ®ï¼ˆ9ä¸ªæ ¼å¼å®šä¹‰ï¼‰

### 3. æ ¸å¿ƒç»„ä»¶å®ç°
- âœ… `ConfigLoader` - é…ç½®åŠ è½½å™¨ï¼ˆæ”¯æŒç¼“å­˜å’Œçƒ­æ›´æ–°ï¼‰
- âœ… `InputDataFormatLoader` - æ ¼å¼å®šä¹‰åŠ è½½å™¨ï¼ˆæ”¯æŒä»Redisè·å–æ•°æ®ï¼‰

### 4. æ ¼å¼å®šä¹‰åˆ›å»º
å·²åˆ›å»º9ä¸ªæ ¼å¼å®šä¹‰ï¼š
1. âœ… `fortune_analysis_full` - å®Œæ•´æ ¼å¼ï¼ˆç”¨äºFortuneLLMClientï¼‰
2. âœ… `fortune_analysis_minimal` - ç²¾ç®€æ ¼å¼
3. âœ… `fortune_analysis_simple` - ç®€å•æ ¼å¼ï¼ˆç”¨äºFortuneAnalysisLLMClientï¼‰
4. âœ… `marriage_analysis` - æ„Ÿæƒ…å©šå§»åˆ†ææ ¼å¼
5. âœ… `career_wealth_analysis` - äº‹ä¸šè´¢å¯Œåˆ†ææ ¼å¼
6. âœ… `children_study_analysis` - å­å¥³å­¦ä¹ åˆ†ææ ¼å¼
7. âœ… `health_analysis` - èº«ä½“å¥åº·åˆ†ææ ¼å¼
8. âœ… `general_review_analysis` - æ€»è¯„åˆ†ææ ¼å¼
9. âœ… `qa_conversation` - AIé—®ç­”æ ¼å¼

### 5. ä»£ç ä¿®æ”¹
- âœ… ä¿®æ”¹ `fortune_llm_client.py` ä½¿ç”¨æ ¼å¼å®šä¹‰
- âœ… ä¿®æ”¹ `marriage_analysis.py` ä½¿ç”¨æ ¼å¼å®šä¹‰ï¼ˆåŒ…å«æ•°æ®å­˜å‚¨åˆ°Redisï¼‰

## ğŸ”„ è¿›è¡Œä¸­

### 1. å…¶ä»–åˆ†æç±»å‹ä»£ç ä¿®æ”¹
- â³ `career_wealth_analysis.py` - å¾…ä¿®æ”¹
- â³ `children_study_analysis.py` - å¾…ä¿®æ”¹
- â³ `health_analysis_v2.py` - å¾…ä¿®æ”¹
- â³ `general_review_analysis.py` - å¾…ä¿®æ”¹
- â³ `qa_conversation.py` - å¾…ä¿®æ”¹

### 2. æ•°æ®å­˜å‚¨åˆ°Redis
- â³ ç¡®ä¿æ‰€æœ‰åˆ†æç±»å‹çš„æ•°æ®åœ¨è®¡ç®—åå­˜å‚¨åˆ°Redisï¼ˆä½¿ç”¨æ ¼å¼å®šä¹‰ä¸­æŒ‡å®šçš„keyæ ¼å¼ï¼‰
- â³ ç»Ÿä¸€Redis keyæ ¼å¼

### 3. çƒ­æ›´æ–°API
- â³ å®ç°é…ç½®çƒ­æ›´æ–°API
- â³ å®ç°æ ¼å¼å®šä¹‰çƒ­æ›´æ–°API

### 4. æœåŠ¡å¯åŠ¨ä»£ç ä¿®æ”¹
- â³ ä¿®æ”¹æœåŠ¡å¯åŠ¨ä»£ç ä½¿ç”¨ `ConfigLoader` åŠ è½½é…ç½®

## ğŸ“‹ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å®Œæˆå…¶ä»–åˆ†æç±»å‹çš„ä»£ç ä¿®æ”¹**
   - é‡‡ç”¨ä¸ `marriage_analysis.py` ç›¸åŒçš„æ–¹å¼
   - ä¼˜å…ˆä½¿ç”¨æ ¼å¼å®šä¹‰ï¼Œé™çº§åˆ°åŸæœ‰æ–¹æ³•

2. **ç»Ÿä¸€æ•°æ®å­˜å‚¨åˆ°Redis**
   - ç¡®ä¿æ‰€æœ‰åˆ†æç±»å‹çš„æ•°æ®åœ¨è®¡ç®—åå­˜å‚¨åˆ°Redis
   - ä½¿ç”¨æ ¼å¼å®šä¹‰ä¸­æŒ‡å®šçš„keyæ ¼å¼

3. **å®ç°çƒ­æ›´æ–°API**
   - `/api/v1/config/reload` - é‡æ–°åŠ è½½é…ç½®
   - `/api/v1/format/reload` - é‡æ–°åŠ è½½æ ¼å¼å®šä¹‰

4. **æµ‹è¯•éªŒè¯**
   - æµ‹è¯•æ‰€æœ‰åˆ†æç±»å‹ä½¿ç”¨æ ¼å¼å®šä¹‰
   - æµ‹è¯•æ•°æ®å­˜å‚¨åˆ°Redis
   - æµ‹è¯•çƒ­æ›´æ–°åŠŸèƒ½

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### Redis Keyæ ¼å¼
æ ¼å¼å®šä¹‰ä¸­ä½¿ç”¨çš„keyæ¨¡æ¿ï¼š
- `bazi:{solar_date}:{solar_time}:{gender}` - å…«å­—æ•°æ®
- `fortune:{solar_date}:{solar_time}:{gender}:liunian` - æµå¹´æ•°æ®
- `fortune:{solar_date}:{solar_time}:{gender}:dayun` - å¤§è¿æ•°æ®
- `marriage:{solar_date}:{solar_time}:{gender}:mingpan` - å©šå§»åˆ†æ-å‘½ç›˜
- `marriage:{solar_date}:{solar_time}:{gender}:peiou` - å©šå§»åˆ†æ-é…å¶
- ç­‰ç­‰...

### é™çº§ç­–ç•¥
- ä¼˜å…ˆä½¿ç”¨æ ¼å¼å®šä¹‰ä»Redisè·å–æ•°æ®
- å¦‚æœRedisä¸­æ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨åŸæœ‰æ–¹æ³•è®¡ç®—
- è®¡ç®—åå°†æ•°æ®å­˜å‚¨åˆ°Redisï¼ˆä½¿ç”¨æ ¼å¼å®šä¹‰ä¸­æŒ‡å®šçš„keyæ ¼å¼ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿Redisä¸­çš„æ•°æ®ä¸è®¡ç®—çš„æ•°æ®ä¸€è‡´
2. **ç¼“å­˜è¿‡æœŸ**ï¼šè®¾ç½®åˆç†çš„TTLï¼ˆé»˜è®¤24å°æ—¶ï¼‰
3. **é”™è¯¯å¤„ç†**ï¼šæ ¼å¼å®šä¹‰åŠ è½½å¤±è´¥æ—¶ï¼Œé™çº§åˆ°åŸæœ‰æ–¹æ³•
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢

