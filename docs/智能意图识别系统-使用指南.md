# æ™ºèƒ½æ„å›¾è¯†åˆ«ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**ï¼šv1.0.0  
**æ›´æ–°æ—¶é—´**ï¼š2025-11-24

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸“ç”¨Coze Bot

1. è®¿é—® [Coze å¹³å°](https://www.coze.cn/)
2. ç™»å½•è´¦å·
3. åˆ›å»ºæ–°Botï¼š
   - åç§°ï¼š**æ„å›¾è¯†åˆ«ä¸“å®¶**
   - æè¿°ï¼šä¸“é—¨ç”¨äºè¯†åˆ«ç”¨æˆ·é—®é¢˜çš„æ„å›¾
   - ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯é€‰ï¼‰ï¼šç•™ç©ºå³å¯ï¼ˆPromptåœ¨ä»£ç ä¸­ï¼‰
4. åˆ›å»ºå®Œæˆåï¼Œå¤åˆ¶ **Bot ID**

### ç¬¬äºŒæ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `config/services.env`ï¼š

```bash
vim config/services.env
```

æ‰¾åˆ°å¹¶ä¿®æ”¹ï¼š

```bash
# å°† PLACEHOLDER_INTENT_BOT_ID æ›¿æ¢ä¸ºæ‚¨çš„Bot ID
export INTENT_BOT_ID="7573909067308695606"  # æ›¿æ¢ä¸ºå®é™…Bot ID
```

ä¿å­˜é€€å‡ºï¼ˆ`:wq`ï¼‰ã€‚

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
# åœæ­¢ç°æœ‰æœåŠ¡
./stop_all_services.sh

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬æ–°çš„Intent Serviceï¼‰
./start_all_services.sh

# ç­‰å¾…çº¦10ç§’ï¼Œè®©æœåŠ¡å®Œå…¨å¯åŠ¨
```

### ç¬¬å››æ­¥ï¼šéªŒè¯æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
ps aux | grep intent_service
ps aux | grep prompt_optimizer

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/intent_service_9008.log
```

å¦‚æœçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼š

```
2025-11-24 12:00:00 - intent_service - INFO - Redis cache initialized successfully
2025-11-24 12:00:00 - intent_service - INFO - QuestionFilter initialized
2025-11-24 12:00:00 - intent_service - INFO - IntentClassifier initialized
2025-11-24 12:00:00 - intent_service - INFO - Intent Service is running on 0.0.0.0:9008
```

### ç¬¬äº”æ­¥ï¼šæµ‹è¯•åŠŸèƒ½

```bash
# æµ‹è¯•æ„å›¾è¯†åˆ«
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·"

# å®Œæ•´æµ‹è¯•ï¼ˆéœ€è¦å…«å­—ä¿¡æ¯ï¼‰
curl "http://localhost:8001/api/v1/smart-analyze?question=æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·&year=1990&month=1&day=1&hour=12&gender=male"
```

å¦‚æœè¿”å›æ­£å¸¸JSONå“åº”ï¼Œè¯´æ˜åŠŸèƒ½æ­£å¸¸ï¼

---

## ğŸ“– ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç®€å•é—®é¢˜

**ç”¨æˆ·é—®é¢˜**ï¼š"æˆ‘çš„äº‹ä¸šæ€ä¹ˆæ ·ï¼Ÿ"

**ç³»ç»Ÿå¤„ç†**ï¼š
1. è¯†åˆ«æ„å›¾ï¼š`career`ï¼ˆäº‹ä¸šï¼‰
2. ç½®ä¿¡åº¦ï¼š0.95ï¼ˆéå¸¸é«˜ï¼‰
3. åŒ¹é…è§„åˆ™ï¼š`FORMULA_CAREER`
4. è¿”å›äº‹ä¸šç›¸å…³çš„åˆ†æ

### åœºæ™¯2ï¼šå¤åˆé—®é¢˜

**ç”¨æˆ·é—®é¢˜**ï¼š"æˆ‘ä»Šå¹´èƒ½èµšåˆ°é’±å—ï¼Ÿä¼šä¸ä¼šå‡èŒï¼Ÿ"

**ç³»ç»Ÿå¤„ç†**ï¼š
1. è¯†åˆ«æ„å›¾ï¼š`["wealth", "career"]`ï¼ˆè´¢å¯Œ + äº‹ä¸šï¼‰
2. ç½®ä¿¡åº¦ï¼š0.92
3. åŒ¹é…è§„åˆ™ï¼š`["FORMULA_WEALTH", "FORMULA_CAREER"]`
4. è¿”å›è´¢å¯Œå’Œäº‹ä¸šçš„ç»¼åˆåˆ†æ

### åœºæ™¯3ï¼šå£è¯­åŒ–è¡¨è¾¾

**ç”¨æˆ·é—®é¢˜**ï¼š"æˆ‘è¿™è¾ˆå­èƒ½ä¸èƒ½å‘è´¢ï¼Ÿ"

**ç³»ç»Ÿå¤„ç†**ï¼š
1. è¯†åˆ«"å‘è´¢" â†’ `wealth`
2. ç½®ä¿¡åº¦ï¼š0.93ï¼ˆè™½ç„¶å£è¯­åŒ–ï¼Œä½†æ„å›¾æ˜ç¡®ï¼‰
3. è¿”å›è´¢å¯Œè¿åŠ¿åˆ†æ

### åœºæ™¯4ï¼šä¸“ä¸šæœ¯è¯­

**ç”¨æˆ·é—®é¢˜**ï¼š"æˆ‘çš„é£Ÿç¥æ—ºä¸æ—ºï¼Ÿ"

**ç³»ç»Ÿå¤„ç†**ï¼š
1. è¯†åˆ«ä¸“ä¸šæœ¯è¯­ï¼š`["shishen", "wangshui"]`
2. ç½®ä¿¡åº¦ï¼š0.96ï¼ˆä¸“ä¸šæœ¯è¯­ï¼Œéå¸¸æ˜ç¡®ï¼‰
3. è¿”å›åç¥å’Œæ—ºè¡°åˆ†æ

### åœºæ™¯5ï¼šæ¨¡ç³Šé—®é¢˜

**ç”¨æˆ·é—®é¢˜**ï¼š"æˆ‘å’‹æ ·ï¼Ÿ"

**ç³»ç»Ÿå¤„ç†**ï¼š
1. è¯†åˆ«æ„å›¾ï¼š`general`ï¼ˆç»¼åˆåˆ†æï¼‰
2. ç½®ä¿¡åº¦ï¼š0.65ï¼ˆè¾ƒä½ï¼‰
3. æ ‡è®°ä¸ºæ¨¡ç³Šï¼š`is_ambiguous=true`
4. è¿”å›ç»¼åˆåˆ†æï¼Œå¹¶æç¤ºç”¨æˆ·æå‡ºæ›´å…·ä½“é—®é¢˜

### åœºæ™¯6ï¼šéå‘½ç†é—®é¢˜

**ç”¨æˆ·é—®é¢˜**ï¼š"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"

**ç³»ç»Ÿå¤„ç†**ï¼š
1. é—®é¢˜è¿‡æ»¤ï¼šåˆ¤å®šä¸ºéå‘½ç†ç›¸å…³
2. è¿”å›å‹å¥½æç¤ºï¼š"æŠ±æ­‰ï¼Œæˆ‘æ˜¯ä¸“ä¸šçš„å‘½ç†åˆ†æåŠ©æ‰‹ï¼Œæ— æ³•å›ç­”å¤©æ°”ç›¸å…³çš„é—®é¢˜ã€‚"

---

## ğŸ”Œ APIæ¥å£è¯´æ˜

### 1. æ™ºèƒ½è¿åŠ¿åˆ†æ

**æ¥å£**ï¼š`GET /api/v1/smart-analyze`

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| question | string | âœ“ | ç”¨æˆ·é—®é¢˜ |
| year | int | âœ“ | å‡ºç”Ÿå¹´ä»½ |
| month | int | âœ“ | å‡ºç”Ÿæœˆä»½ï¼ˆ1-12ï¼‰ |
| day | int | âœ“ | å‡ºç”Ÿæ—¥æœŸï¼ˆ1-31ï¼‰ |
| hour | int | - | å‡ºç”Ÿæ—¶è¾°ï¼ˆ0-23ï¼‰ï¼Œé»˜è®¤12 |
| gender | string | âœ“ | æ€§åˆ«ï¼ˆmale/femaleï¼‰ |
| user_id | string | - | ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰ |

**ç¤ºä¾‹è¯·æ±‚**ï¼š
```bash
curl -X GET "http://localhost:8001/api/v1/smart-analyze" \
  -G \
  --data-urlencode "question=æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·" \
  --data-urlencode "year=1990" \
  --data-urlencode "month=1" \
  --data-urlencode "day=1" \
  --data-urlencode "hour=12" \
  --data-urlencode "gender=male"
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "question": "æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·",
  "intent_result": {
    "intents": ["career"],
    "confidence": 0.95,
    "keywords": ["äº‹ä¸š", "è¿åŠ¿"],
    "is_ambiguous": false
  },
  "bazi_info": {
    "å››æŸ±": {
      "å¹´æŸ±": {"å¤©å¹²": "åºš", "åœ°æ”¯": "åˆ"},
      "æœˆæŸ±": {"å¤©å¹²": "æˆŠ", "åœ°æ”¯": "å¯…"},
      "æ—¥æŸ±": {"å¤©å¹²": "ç”²", "åœ°æ”¯": "å­"},
      "æ—¶æŸ±": {"å¤©å¹²": "åºš", "åœ°æ”¯": "åˆ"}
    },
    "åç¥": { ... },
    "äº”è¡Œ": { ... }
  },
  "matched_rules_count": 15,
  "response": "æ ¹æ®æ‚¨çš„é—®é¢˜ã€Œæˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·ã€ï¼Œæˆ‘å°†ä¸ºæ‚¨åˆ†æäº‹ä¸šè¿åŠ¿æ–¹é¢çš„æƒ…å†µã€‚\n\nã€å…«å­—ä¿¡æ¯ã€‘\næ—¥ä¸»ï¼šç”²\näº”è¡Œï¼šæœ¨2 ç«2 åœŸ1 é‡‘2 æ°´1\n\nã€è¯¦ç»†åˆ†æã€‘\nâ€¢ æ‚¨çš„äº‹ä¸šå®«è¾ƒæ—ºï¼Œåˆ©äºèŒåœºå‘å±•...\nâ€¢ å‘½ä¸­æœ‰æ­£å®˜æ˜Ÿï¼Œé€‚åˆä»äº‹ç®¡ç†ç±»å·¥ä½œ...\nâ€¢ ...\n\nä»¥ä¸Šåˆ†æåŸºäºæ‚¨çš„å…«å­—ä¿¡æ¯ï¼Œä»…ä¾›å‚è€ƒã€‚"
}
```

### 2. æµ‹è¯•æ„å›¾è¯†åˆ«

**æ¥å£**ï¼š`GET /api/v1/test-intent`

**å‚æ•°**ï¼š
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| question | string | âœ“ | æµ‹è¯•é—®é¢˜ |

**ç¤ºä¾‹è¯·æ±‚**ï¼š
```bash
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘ä»Šå¹´èƒ½å‘è´¢å—"
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "question": "æˆ‘ä»Šå¹´èƒ½å‘è´¢å—",
  "result": {
    "intents": ["wealth"],
    "confidence": 0.93,
    "rule_types": ["FORMULA_WEALTH"],
    "keywords": ["å‘è´¢"],
    "reasoning": "è™½ç„¶è¡¨è¾¾å£è¯­åŒ–ï¼Œä½†'å‘è´¢'æ˜ç¡®æŒ‡å‘è´¢å¯Œè¿åŠ¿",
    "is_ambiguous": false,
    "prompt_version": "v1.0",
    "response_time_ms": 234
  }
}
```

---

## ğŸ¨ å‰ç«¯é›†æˆç¤ºä¾‹

### HTML + JavaScript

```html
<!DOCTYPE html>
<html>
<head>
  <title>æ™ºèƒ½è¿åŠ¿åˆ†æ</title>
  <meta charset="UTF-8">
</head>
<body>
  <h1>æ™ºèƒ½è¿åŠ¿åˆ†æ</h1>
  
  <form id="fortuneForm">
    <label>æ‚¨çš„é—®é¢˜ï¼š</label>
    <input type="text" id="question" placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·ï¼Ÿ" required />
    
    <label>å‡ºç”Ÿå¹´ä»½ï¼š</label>
    <input type="number" id="year" placeholder="1990" required />
    
    <label>å‡ºç”Ÿæœˆä»½ï¼š</label>
    <input type="number" id="month" placeholder="1" min="1" max="12" required />
    
    <label>å‡ºç”Ÿæ—¥æœŸï¼š</label>
    <input type="number" id="day" placeholder="1" min="1" max="31" required />
    
    <label>å‡ºç”Ÿæ—¶è¾°ï¼š</label>
    <input type="number" id="hour" placeholder="12" min="0" max="23" value="12" />
    
    <label>æ€§åˆ«ï¼š</label>
    <select id="gender" required>
      <option value="male">ç”·</option>
      <option value="female">å¥³</option>
    </select>
    
    <button type="submit">å¼€å§‹åˆ†æ</button>
  </form>
  
  <div id="result"></div>
  
  <script>
    document.getElementById('fortuneForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const question = document.getElementById('question').value;
      const year = document.getElementById('year').value;
      const month = document.getElementById('month').value;
      const day = document.getElementById('day').value;
      const hour = document.getElementById('hour').value;
      const gender = document.getElementById('gender').value;
      
      const url = `http://localhost:8001/api/v1/smart-analyze?` +
        `question=${encodeURIComponent(question)}` +
        `&year=${year}` +
        `&month=${month}` +
        `&day=${day}` +
        `&hour=${hour}` +
        `&gender=${gender}`;
      
      try {
        const response = await fetch(url);
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('result').innerHTML = `
            <h2>åˆ†æç»“æœ</h2>
            <p><strong>æ„å›¾è¯†åˆ«ï¼š</strong>${data.intent_result.intents.join(', ')}</p>
            <p><strong>ç½®ä¿¡åº¦ï¼š</strong>${(data.intent_result.confidence * 100).toFixed(1)}%</p>
            <pre>${data.response}</pre>
          `;
        } else {
          document.getElementById('result').innerHTML = `<p style="color:red;">${data.message}</p>`;
        }
      } catch (error) {
        document.getElementById('result').innerHTML = `<p style="color:red;">è¯·æ±‚å¤±è´¥ï¼š${error}</p>`;
      }
    });
  </script>
</body>
</html>
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### åŸºç¡€æµ‹è¯•

```bash
# äº‹ä¸šè¿åŠ¿
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·"

# è´¢å¯Œè¿åŠ¿
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘èƒ½å‘è´¢å—"

# å©šå§»æ„Ÿæƒ…
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘ä»€ä¹ˆæ—¶å€™ç»“å©š"

# å¥åº·è¿åŠ¿
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘çš„èº«ä½“å¥åº·å—"

# æ€§æ ¼ç‰¹ç‚¹
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘æ˜¯ä»€ä¹ˆæ€§æ ¼"

# ç»¼åˆåˆ†æ
curl "http://localhost:8001/api/v1/test-intent?question=å¸®æˆ‘ç®—ç®—å‘½"
```

### é«˜çº§æµ‹è¯•

```bash
# å¤åˆé—®é¢˜
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘ä»Šå¹´èƒ½èµšåˆ°é’±å—ï¼Œä¼šä¸ä¼šå‡èŒ"

# å£è¯­åŒ–è¡¨è¾¾
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘è¿™è¾ˆå­èƒ½ä¸èƒ½å‘è´¢å•Š"

# ä¸“ä¸šæœ¯è¯­
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘çš„é£Ÿç¥æ—ºä¸æ—º"

# æ¨¡ç³Šé—®é¢˜
curl "http://localhost:8001/api/v1/test-intent?question=æˆ‘å’‹æ ·"

# éå‘½ç†é—®é¢˜
curl "http://localhost:8001/api/v1/test-intent?question=ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·"
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep intent_service

# æ£€æŸ¥ç«¯å£
lsof -i :9008

# æ£€æŸ¥æ—¥å¿—
tail -f logs/intent_service_9008.log
```

### æŸ¥çœ‹ç¼“å­˜æƒ…å†µ

```bash
# è¿æ¥Redis
redis-cli -p 16379 -n 3

# æŸ¥çœ‹ç¼“å­˜æ•°é‡
> DBSIZE

# æŸ¥çœ‹æ‰€æœ‰ç¼“å­˜é”®
> KEYS intent:cache:*

# æŸ¥çœ‹æŸä¸ªç¼“å­˜
> GET intent:cache:xxxxx

# æ¸…ç†æ‰€æœ‰ç¼“å­˜
> FLUSHDB
```

### é‡å¯æœåŠ¡

```bash
# å•ç‹¬é‡å¯Intent Service
kill $(cat logs/intent_service_9008.pid)
.venv/bin/python services/intent_service/grpc_server.py > logs/intent_service_9008.log 2>&1 &

# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
./stop_all_services.sh
./start_all_services.sh
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šIntent Serviceæ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º "Address already in use"

**è§£å†³**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :9008

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# é‡æ–°å¯åŠ¨
./start_all_services.sh
```

### é—®é¢˜2ï¼šè¯†åˆ«ç»“æœä¸å‡†ç¡®

**ç—‡çŠ¶**ï¼šæ„å›¾è¯†åˆ«é”™è¯¯æˆ–ç½®ä¿¡åº¦ä½

**å¯èƒ½åŸå› **ï¼š
1. Coze Boté…ç½®é”™è¯¯
2. Promptç‰ˆæœ¬è¿‡æ—§
3. ç¼“å­˜äº†é”™è¯¯ç»“æœ

**è§£å†³**ï¼š
```bash
# 1. æ£€æŸ¥Bot ID
grep INTENT_BOT_ID config/services.env

# 2. æ¸…ç†ç¼“å­˜
redis-cli -p 16379 -n 3 FLUSHDB

# 3. æŸ¥çœ‹æ—¥å¿—
tail -n 100 logs/intent_service_9008.log | grep ERROR

# 4. é‡å¯æœåŠ¡
./stop_all_services.sh
./start_all_services.sh
```

### é—®é¢˜3ï¼šå“åº”é€Ÿåº¦æ…¢

**ç—‡çŠ¶**ï¼šé¦–æ¬¡è¯·æ±‚è¶…è¿‡5ç§’

**å¯èƒ½åŸå› **ï¼š
1. LLMè°ƒç”¨è¶…æ—¶
2. ç½‘ç»œé—®é¢˜
3. Coze APIé™æµ

**è§£å†³**ï¼š
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://api.coze.cn

# 2. å¯ç”¨ç¼“å­˜ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
# æ£€æŸ¥é…ç½®
grep REDIS config/services.intent_service/config.py

# 3. è°ƒæ•´è¶…æ—¶æ—¶é—´
vim services/intent_service/llm_client.py
# æ‰¾åˆ° timeout=10ï¼Œæ”¹ä¸º timeout=30
```

### é—®é¢˜4ï¼šCoze APIè°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º "Coze API error"

**å¯èƒ½åŸå› **ï¼š
1. Tokenè¿‡æœŸ
2. Bot IDé”™è¯¯
3. APIé™æµ

**è§£å†³**ï¼š
```bash
# 1. æ£€æŸ¥Token
grep COZE_ACCESS_TOKEN config/services.env

# 2. æ£€æŸ¥Bot ID
grep INTENT_BOT_ID config/services.env

# 3. æ‰‹åŠ¨æµ‹è¯•API
curl -H "Authorization: Bearer YOUR_TOKEN" \
  "https://api.coze.cn/v1/workspace/list"

# 4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
grep "Coze API" logs/intent_service_9008.log
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨Redisç¼“å­˜ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰

ç¼“å­˜å¯ä»¥å°†å“åº”æ—¶é—´ä»300msé™ä½åˆ°50msä»¥ä¸‹ã€‚

### 2. è°ƒæ•´ç¼“å­˜TTL

å¦‚æœPromptæ›´æ–°é¢‘ç¹ï¼š

```bash
# ç¼–è¾‘é…ç½®
vim config/services.env

# å‡å°‘TTLï¼ˆé»˜è®¤3600ç§’ = 1å°æ—¶ï¼‰
export PROMPT_CACHE_TTL="1800"  # æ”¹ä¸º30åˆ†é’Ÿ

# é‡å¯æœåŠ¡
./stop_all_services.sh
./start_all_services.sh
```

### 3. æ‰¹é‡è¯·æ±‚

å¦‚æœéœ€è¦å¤„ç†å¤§é‡é—®é¢˜ï¼š

```python
import grpc
from proto import intent_pb2, intent_pb2_grpc

channel = grpc.insecure_channel('127.0.0.1:9008')
stub = intent_pb2_grpc.IntentServiceStub(channel)

# æ‰¹é‡è¯·æ±‚
requests = [
    intent_pb2.ClassifyRequest(question=q)
    for q in ["é—®é¢˜1", "é—®é¢˜2", "é—®é¢˜3", ...]
]

batch_request = intent_pb2.BatchClassifyRequest(requests=requests)
response = stub.BatchClassify(batch_request)
```

### 4. é¢„çƒ­ç¼“å­˜

ç³»ç»Ÿå¯åŠ¨åï¼Œé¢„å…ˆç¼“å­˜å¸¸è§é—®é¢˜ï¼š

```bash
# åˆ›å»ºé¢„çƒ­è„šæœ¬
cat > warm_cache.sh << 'EOF'
#!/bin/bash
common_questions=(
  "æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·"
  "æˆ‘èƒ½å‘è´¢å—"
  "æˆ‘ä»€ä¹ˆæ—¶å€™ç»“å©š"
  "æˆ‘çš„å¥åº·æ€ä¹ˆæ ·"
  "æˆ‘æ˜¯ä»€ä¹ˆæ€§æ ¼"
)

for q in "${common_questions[@]}"; do
  curl -s "http://localhost:8001/api/v1/test-intent?question=$q" > /dev/null
  echo "Warmed: $q"
done
EOF

chmod +x warm_cache.sh
./warm_cache.sh
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æç¤ºç”¨æˆ·æå‡ºæ˜ç¡®é—®é¢˜

åœ¨å‰ç«¯ç•Œé¢æ·»åŠ ç¤ºä¾‹é—®é¢˜ï¼š

```
ğŸ’¡ æ‚¨å¯ä»¥è¿™æ ·é—®ï¼š
â€¢ "æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·ï¼Ÿ"
â€¢ "æˆ‘ä»Šå¹´èƒ½å‘è´¢å—ï¼Ÿ"
â€¢ "æˆ‘ä»€ä¹ˆæ—¶å€™ä¼šç»“å©šï¼Ÿ"
â€¢ "æˆ‘çš„å¥åº·çŠ¶å†µå¦‚ä½•ï¼Ÿ"
```

### 2. å¤„ç†æ¨¡ç³Šé—®é¢˜

å½“ `is_ambiguous=true` æ—¶ï¼Œå¼•å¯¼ç”¨æˆ·ï¼š

```javascript
if (data.intent_result.is_ambiguous) {
  alert('æ‚¨çš„é—®é¢˜æ¯”è¾ƒç¬¼ç»Ÿï¼Œå»ºè®®æ‚¨æ›´å…·ä½“åœ°æè¿°ï¼Œä¾‹å¦‚ï¼š"æˆ‘çš„äº‹ä¸šè¿åŠ¿å¦‚ä½•ï¼Ÿ"');
}
```

### 3. æ˜¾ç¤ºç½®ä¿¡åº¦

è®©ç”¨æˆ·äº†è§£ç³»ç»Ÿçš„ç¡®å®šæ€§ï¼š

```
âœ“ æ„å›¾è¯†åˆ«ï¼šäº‹ä¸šè¿åŠ¿ï¼ˆç½®ä¿¡åº¦ 95%ï¼‰
```

### 4. æ”¶é›†åé¦ˆ

åœ¨ç»“æœé¡µé¢æ·»åŠ åé¦ˆæŒ‰é’®ï¼š

```html
<button onclick="sendFeedback(true)">ğŸ‘ æ»¡æ„</button>
<button onclick="sendFeedback(false)">ğŸ‘ ä¸æ»¡æ„</button>
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘å®ŒæˆæŠ¥å‘Š](./æ™ºèƒ½æ„å›¾è¯†åˆ«ç³»ç»Ÿ-å¼€å‘å®ŒæˆæŠ¥å‘Š.md)
- [APIæ–‡æ¡£](../server/api/v1/smart_fortune.py)
- [ç³»ç»Ÿæ¶æ„](./æ™ºèƒ½æ„å›¾è¯†åˆ«ç³»ç»Ÿ-å¼€å‘å®ŒæˆæŠ¥å‘Š.md#æ¶æ„è®¾è®¡)
- [è¿ç»´æŒ‡å—](./æ™ºèƒ½æ„å›¾è¯†åˆ«ç³»ç»Ÿ-å¼€å‘å®ŒæˆæŠ¥å‘Š.md#è¿ç»´æŒ‡å—)

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`tail -f logs/intent_service_9008.log`
2. **æ£€æŸ¥é…ç½®**ï¼š`cat config/services.env | grep INTENT`
3. **æµ‹è¯•API**ï¼š`curl http://localhost:8001/api/v1/test-intent?question=æµ‹è¯•`
4. **è”ç³»å¼€å‘**ï¼šæŸ¥çœ‹å¼€å‘å®ŒæˆæŠ¥å‘Šä¸­çš„æ•…éšœæ’é™¤ç« èŠ‚

---

**ç¥æ‚¨ä½¿ç”¨é¡ºåˆ©ï¼** ğŸ‰

