# 🚨 清除缓存步骤（必须执行）

## ⚠️ 重要说明
由于浏览器顽固缓存导致显示乱码，必须按以下步骤清除缓存。

---

## 🔧 步骤1：访问清除缓存页面（最简单）

### 方法A：直接访问清除页面
```
http://localhost:8001/frontend/clear-cache.html
```

这个页面会：
- 自动清除 Service Worker
- 自动清除 Cache Storage
- 自动清除 localStorage / sessionStorage  
- 自动重定向到排盘页面

---

## 🔧 步骤2：手动清除（如果方法A不行）

### Chrome/Edge：
1. 按 `F12` 打开开发者工具
2. 点击右上角 **⚙️** (设置)
3. 找到 **"Disable cache (while DevTools is open)"** 并勾选
4. **右键点击**浏览器刷新按钮
5. 选择 **"清空缓存并硬性重新加载"**

### Safari：
1. 按 `Option + Cmd + E` 清空缓存
2. 按 `Cmd + R` 刷新

---

## 🔧 步骤3：验证修复（重要）

访问排盘页面后：
```
http://localhost:8001/frontend/pan.html
```

1. 按 `F12` 打开开发者工具
2. 切换到 **Console (控制台)** 标签
3. 输入生辰八字并计算
4. **查看控制台输出**，应该看到：
   ```
   📊 婚姻规则数量: 27
   📊 第1条规则名: 婚姻规则10376
   📊 第1条规则名(字节): 5a 5a 59 fb 89 c4 ...
   ```

5. 如果看到正确的中文，说明修复成功
6. 如果还是乱码，**截图控制台输出**发给我

---

## 🎯 如果还不行：使用隐私模式

最干净的测试方法：
1. 打开**隐私/无痕模式**窗口
2. 访问：`http://localhost:8001/frontend/pan.html`
3. 这个模式下没有任何缓存

---

## ✅ 预期结果

成功后应该看到：
- **婚姻规则10376**: 中等姻缘：两人都刚强务实...
- **富贵命规则19001**: 富贵命：魁罡日，发达不灾...
- **婚姻规则10085**: 为四方的脸型，细长眼睛棱分明...

而不是：
- ~~å©šå§»è§„åˆ™1~~ (乱码)

---

## 📝 技术原因

问题根源：
1. 浏览器缓存了旧的API响应（没有明确charset的响应）
2. 新的响应头`charset=utf-8`被浏览器忽略
3. Service Worker 或 HTTP缓存导致持续使用旧数据

已修复：
- ✅ API响应头：`Content-Type: application/json; charset=utf-8`
- ✅ 缓存控制：`Cache-Control: no-cache, no-store, must-revalidate`
- ✅ JSON编码：`ensure_ascii=False`

---

**现在请执行步骤1，访问清除缓存页面！**

