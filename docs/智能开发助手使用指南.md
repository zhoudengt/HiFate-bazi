# 智能开发助手使用指南

## 概述

智能开发助手是智能工程化开发系统的核心组件，提供自动化热更新、智能决策、完整性验证等功能，确保开发上线成功率 ≥ 98%。

## 快速开始

### 1. 开发新功能

```bash
# 1. 启动开发助手
python3 scripts/ai/dev_assistant.py --start

# 2. 获取开发建议
python3 scripts/ai/dev_assistant.py --suggest "开发新API" --dev-type api

# 3. 开发代码...

# 4. 完成开发（自动触发热更新）
python3 scripts/ai/dev_assistant.py --complete
```

### 2. 自动化热更新

```bash
# 方式1：启动文件监控（开发时自动触发热更新）
python3 scripts/ai/auto_hot_reload.py --watch

# 方式2：手动触发一次
python3 scripts/ai/auto_hot_reload.py --trigger

# 方式3：触发并验证
python3 scripts/ai/auto_hot_reload.py --trigger --verify
```

### 3. 完整性验证

```bash
# API 开发完整性验证
python3 scripts/ai/completeness_validator.py --type api --name xxx

# 规则开发完整性验证
python3 scripts/ai/completeness_validator.py --type rule --name wealth

# 前端开发完整性验证
python3 scripts/ai/completeness_validator.py --type frontend --name fortune
```

## 核心功能

### 自动化热更新系统

**功能**：
- 文件变更自动检测
- 自动触发热更新（无需手动）
- 自动验证热更新成功
- 失败自动回滚
- **禁止重启服务**（强制热更新）

**使用场景**：
- 开发时：启动文件监控，自动触发热更新
- 部署时：手动触发一次，验证热更新成功

**命令**：
```bash
# 启动文件监控
python3 scripts/ai/auto_hot_reload.py --watch

# 手动触发
python3 scripts/ai/auto_hot_reload.py --trigger

# 验证状态
python3 scripts/ai/auto_hot_reload.py --verify

# 回滚
python3 scripts/ai/auto_hot_reload.py --rollback
```

### 智能决策引擎

**功能**：
- 判断是否需要热更新（100%需要，禁止重启）
- 判断是否需要重启（100%禁止）
- 判断是否需要测试
- 判断是否需要部署
- 提供明确的执行建议

**使用场景**：
- 代码变更后，判断需要执行的操作
- 提供明确的执行建议

**命令**：
```bash
# 分析文件变更
python3 scripts/ai/decision_engine.py --analyze server/api/v1/xxx.py

# 显示决策摘要
python3 scripts/ai/decision_engine.py --analyze server/api/v1/xxx.py --summary

# 检查变更类型
python3 scripts/ai/decision_engine.py --check python_code
```

### 完整性验证系统

**功能**：
- 检查所有必需文件是否创建
- 检查所有必需注册是否完成
- 检查所有必需测试是否编写
- 生成完整性报告

**使用场景**：
- 开发完成后，验证完整性
- 避免交付丢三落四

**命令**：
```bash
# API 开发完整性验证
python3 scripts/ai/completeness_validator.py --type api --name xxx

# 规则开发完整性验证
python3 scripts/ai/completeness_validator.py --type rule --name wealth

# 前端开发完整性验证
python3 scripts/ai/completeness_validator.py --type frontend --name fortune

# 输出 JSON 格式
python3 scripts/ai/completeness_validator.py --type api --name xxx --json
```

### 智能检查清单

**功能**：
- 根据开发类型自动加载对应检查清单
- 自动执行检查项
- 生成检查报告
- 提供修复建议

**使用场景**：
- 开发完成后，运行检查清单
- 确保不遗漏任何步骤

**命令**：
```bash
# 运行检查清单
python3 scripts/ai/smart_checklist.py --type api --name xxx

# 输出 JSON 格式
python3 scripts/ai/smart_checklist.py --type api --name xxx --json
```

### 上下文加载器

**功能**：
- 自动加载项目上下文（.cursorrules、代码结构）
- 根据开发类型加载对应知识库
- 生成上下文摘要供 AI 使用

**使用场景**：
- AI 理解用户需求时，加载项目上下文
- 提供开发建议时，加载相关知识库

**命令**：
```bash
# 加载项目上下文
python3 scripts/ai/context_loader.py --type api --summary

# 输出 JSON 格式
python3 scripts/ai/context_loader.py --type api --json
```

## 使用流程

### 场景1：开发新 API

```bash
# 1. 启动开发助手
python3 scripts/ai/dev_assistant.py --start

# 2. 获取开发建议
python3 scripts/ai/dev_assistant.py --suggest "开发新API" --dev-type api

# 3. 开发代码
# - 创建 server/api/v1/xxx.py
# - 注册 gRPC 端点
# - 注册路由
# - 编写测试

# 4. 完整性验证
python3 scripts/ai/completeness_validator.py --type api --name xxx

# 5. 完成开发（自动触发热更新）
python3 scripts/ai/dev_assistant.py --complete
```

### 场景2：开发新规则

```bash
# 1. 获取开发建议
python3 scripts/ai/dev_assistant.py --suggest "添加新规则" --dev-type rule

# 2. 开发代码
# - 编写解析脚本
# - 编写导入脚本
# - 导入规则到数据库
# - 更新前后端类型映射

# 3. 完整性验证
python3 scripts/ai/completeness_validator.py --type rule --name wealth

# 4. 完成开发（自动触发热更新）
python3 scripts/ai/dev_assistant.py --complete
```

### 场景3：修改现有功能

```bash
# 1. 启动文件监控（自动触发热更新）
python3 scripts/ai/auto_hot_reload.py --watch

# 2. 修改代码
# - 文件变更自动触发热更新

# 3. 验证热更新成功
python3 scripts/ai/auto_hot_reload.py --verify

# 4. 验证功能正常（必须！）
# - 调用相关 API 测试功能
```

## 集成到现有工具

### Git Hooks

**pre-commit**：提交前自动检查代码规范
**post-commit**：提交后自动触发热更新（仅本地开发环境）

### 开发流程检查工具

已集成自动化热更新到 `scripts/dev/dev_flow_check.py`：
- 完整检查后自动触发热更新
- 验证热更新成功

### 部署自动化工具

已集成自动化热更新到 `scripts/deploy/auto_deploy.py`：
- 增量部署时自动触发热更新
- 部署后验证热更新状态

## 常见问题

### Q1: 热更新未自动触发？

**A**: 检查：
1. 文件监控是否启动：`python3 scripts/ai/auto_hot_reload.py --watch`
2. 服务是否运行：`curl http://localhost:8001/health`
3. 热更新 API 是否可用：`curl http://localhost:8001/api/v1/hot-reload/status`

### Q2: 完整性验证失败？

**A**: 查看缺失的项：
```bash
python3 scripts/ai/completeness_validator.py --type api --name xxx
```

根据报告修复缺失的项。

### Q3: 智能决策引擎判断错误？

**A**: 检查文件变更类型：
```bash
python3 scripts/ai/decision_engine.py --analyze <文件路径> --summary
```

根据决策摘要执行建议的操作。

## 最佳实践

1. **开发时启动文件监控**：自动触发热更新，无需手动操作
2. **开发完成后运行完整性验证**：确保不遗漏任何步骤
3. **使用智能开发助手**：获取完整的开发步骤和检查清单
4. **禁止重启服务**：必须使用热更新
5. **验证功能正常**：热更新后必须验证实际功能，不单单是健康检查

## 相关文档

- **自动化热更新使用指南**：`docs/自动化热更新使用指南.md`
- **完整性验证使用指南**：`docs/完整性验证使用指南.md`
- **项目知识库**：`docs/knowledge_base/`

