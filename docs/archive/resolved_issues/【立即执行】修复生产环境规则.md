# 【立即执行】修复生产环境规则问题

## 🚨 当前状态

- ❌ **问题未解决**
- 生产环境匹配：**20 条规则**
- 本地环境匹配：**63 条规则**
- 差异：**43 条规则**

## ✅ 立即执行（复制粘贴以下命令）

### 方式 1: 一行命令执行（推荐）

```bash
# 复制以下命令，在终端执行（需要输入两次 SSH 密码）
scp scripts/temp_rules_export.sql root@8.210.52.217:/tmp/rules_import.sql && \
ssh root@8.210.52.217 "cd /opt/HiFate-bazi && docker exec -i hifate-mysql-master mysql -uroot -p${SSH_PASSWORD} hifate_bazi < /tmp/rules_import.sql && curl -X POST http://8.210.52.217:8001/api/v1/hot-reload/check" && \
sleep 5 && \
bash scripts/verify_fix.sh
```

### 方式 2: 分步执行

```bash
# 步骤 1: 上传 SQL 文件（需要输入 SSH 密码）
scp scripts/temp_rules_export.sql root@8.210.52.217:/tmp/rules_import.sql

# 步骤 2: SSH 到生产环境并执行 SQL（需要输入 SSH 密码）
ssh root@8.210.52.217

# 步骤 3: 在生产环境服务器上执行（复制以下命令）
cd /opt/HiFate-bazi
docker exec -i hifate-mysql-master mysql -uroot -p${SSH_PASSWORD} hifate_bazi < /tmp/rules_import.sql
curl -X POST http://8.210.52.217:8001/api/v1/hot-reload/check

# 步骤 4: 退出 SSH
exit

# 步骤 5: 在本地验证（等待 5 秒后）
sleep 5
bash scripts/verify_fix.sh
```

## 📊 验证结果

执行完成后，运行验证脚本：

```bash
bash scripts/verify_fix.sh
```

**预期结果**：
- ✅ 总匹配数：50+ 条（接近本地 63 条）
- ✅ 事业规则：9+ 条（当前 0 条）
- ✅ 身体规则：15+ 条（当前 5 条）
- ✅ 总评规则：6+ 条（当前 1 条）

## 🔍 如果修复后仍有问题

运行完整诊断：

```bash
python3 scripts/simple_comprehensive_check.py
```

## 📝 相关文件

- `scripts/temp_rules_export.sql` - SQL 文件（1.1MB，1142 条规则）
- `scripts/verify_fix.sh` - 验证脚本
- `修复指南-生产环境规则问题.md` - 详细文档

