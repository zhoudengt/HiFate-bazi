# ä»£ç ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š - 2025-12-14

## ğŸ“‹ æ£€æŸ¥æ¦‚è§ˆ

**æ£€æŸ¥æ—¶é—´**ï¼š2025-12-14  
**æ£€æŸ¥èŒƒå›´**ï¼šæœ¬åœ°ã€Node1ã€Node2  
**æ£€æŸ¥é¡¹**ï¼šGitç‰ˆæœ¬ã€å…³é”®æ–‡ä»¶ã€gRPCä»£ç ã€å®¹å™¨é…ç½®

---

## ğŸ” æ£€æŸ¥ç»“æœ

### 1. Git ç‰ˆæœ¬ä¸€è‡´æ€§

| ç¯å¢ƒ | Git Commit | çŠ¶æ€ |
|------|-----------|------|
| **æœ¬åœ°** | `944aa15` | âœ… |
| **Node1** | `?` | â³ æ£€æŸ¥ä¸­ |
| **Node2** | `?` | â³ æ£€æŸ¥ä¸­ |

**è¦æ±‚**ï¼šä¸‰å¤„ Git ç‰ˆæœ¬å¿…é¡»å®Œå…¨ä¸€è‡´

---

### 2. å…³é”®æ–‡ä»¶ä¸€è‡´æ€§

#### 2.1 gRPC ç”Ÿæˆä»£ç 

| æ–‡ä»¶ | æœ¬åœ° | Node1 | Node2 | çŠ¶æ€ |
|------|------|-------|-------|------|
| `proto/generated/bazi_core_pb2_grpc.py` | âœ… å·²ä¿®å¤ | ? | ? | â³ |
| `proto/generated/intent_pb2_grpc.py` | âœ… å·²ä¿®å¤ | ? | ? | â³ |
| `proto/generated/*_pb2_grpc.py` (10ä¸ª) | âœ… å·²ä¿®å¤ | ? | ? | â³ |

**æ£€æŸ¥é¡¹**ï¼š
- âŒ æ—  `add_registered_method_handlers` æ–¹æ³•è°ƒç”¨ï¼ˆåº”ä¸º 0ï¼‰

#### 2.2 ç¡¬ç¼–ç è·¯å¾„æ£€æŸ¥

| æ–‡ä»¶ | æœ¬åœ° | Node1 | Node2 | çŠ¶æ€ |
|------|------|-------|-------|------|
| `server/api/grpc_gateway.py` | âœ… å·²ä¿®å¤ | ? | ? | â³ |
| `server/api/v2/desk_fengshui_api.py` | âœ… å·²ä¿®å¤ | ? | ? | â³ |

**æ£€æŸ¥é¡¹**ï¼š
- âŒ æ—  `/Users/zhoudt` ç¡¬ç¼–ç è·¯å¾„ï¼ˆåº”ä¸º 0ï¼‰

#### 2.3 Docker Compose é…ç½®

| é…ç½®é¡¹ | æœ¬åœ° | Node1 | Node2 | çŠ¶æ€ |
|--------|------|-------|-------|------|
| `proto:/app/proto` æŒ‚è½½ | âœ… 10ä¸ª | ? | ? | â³ |
| `services:/app/services` æŒ‚è½½ | âœ… 10ä¸ª | ? | ? | â³ |
| `src:/app/src` æŒ‚è½½ | âœ… 10ä¸ª | ? | ? | â³ |

**æ£€æŸ¥é¡¹**ï¼š
- âœ… æ‰€æœ‰å¾®æœåŠ¡å®¹å™¨éƒ½æœ‰ proto ç›®å½•æŒ‚è½½ï¼ˆåº”ä¸º 10ï¼‰

---

### 3. å®¹å™¨å†…ä»£ç ä¸€è‡´æ€§

| æ£€æŸ¥é¡¹ | Node1 | Node2 | çŠ¶æ€ |
|--------|-------|-------|------|
| å®¹å™¨å†… gRPC ä»£ç  | ? | ? | â³ |
| å®¹å™¨å†…ç¡¬ç¼–ç è·¯å¾„ | ? | ? | â³ |
| å®¹å™¨æŒ‚è½½éªŒè¯ | ? | ? | â³ |

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥å®¹å™¨å†…ä»£ç 
docker exec hifate-bazi-core grep -c "add_registered_method_handlers" /app/proto/generated/bazi_core_pb2_grpc.py
# åº”è¯¥è¿”å› 0
```

---

## ğŸ“Š ä¸ä¸€è‡´é¡¹æ±‡æ€»

### å‘ç°çš„ä¸ä¸€è‡´

1. **å¾…æ£€æŸ¥é¡¹**ï¼š
   - [ ] Git ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´
   - [ ] Node1 ä»£ç æ˜¯å¦å·²åŒæ­¥
   - [ ] Node2 ä»£ç æ˜¯å¦å·²åŒæ­¥
   - [ ] å®¹å™¨å†…ä»£ç æ˜¯å¦å·²åŒæ­¥

---

## ğŸ”§ ä¿®å¤å»ºè®®

### å¦‚æœå‘ç°ä¸ä¸€è‡´

1. **åŒæ­¥ Git ä»£ç **ï¼š
   ```bash
   # Node1
   ssh root@8.210.52.217 "cd /opt/HiFate-bazi && git pull origin master"
   
   # Node2
   ssh root@47.243.160.43 "cd /opt/HiFate-bazi && git pull origin master"
   ```

2. **ä¿®å¤ gRPC ä»£ç **ï¼š
   ```bash
   # åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
   find proto/generated -name "*_pb2_grpc.py" -exec sed -i "/server.add_registered_method_handlers/d" {} \;
   ```

3. **é‡å¯å®¹å™¨**ï¼š
   ```bash
   # åº”ç”¨æ–°é…ç½®
   docker-compose -f docker-compose.prod.yml -f docker-compose.node1.yml \
     --env-file /opt/HiFate-bazi/.env up -d --force-recreate --no-deps bazi-core ...
   ```

---

## âœ… æ£€æŸ¥æ¸…å•

- [ ] Git ç‰ˆæœ¬ä¸‰å¤„ä¸€è‡´
- [ ] å…³é”®æ–‡ä»¶å†…å®¹ä¸€è‡´
- [ ] æ— ç¡¬ç¼–ç è·¯å¾„
- [ ] gRPC ä»£ç å·²ä¿®å¤
- [ ] å®¹å™¨æŒ‚è½½é…ç½®æ­£ç¡®
- [ ] å®¹å™¨å†…ä»£ç å·²åŒæ­¥
- [ ] ç¯å¢ƒå˜é‡æ­£ç¡®åŠ è½½

---

## ğŸ“ æ£€æŸ¥è„šæœ¬

ä½¿ç”¨ `scripts/check_code_consistency.sh` è‡ªåŠ¨æ£€æŸ¥ï¼š

```bash
bash scripts/check_code_consistency.sh
```

