# 智能运势流式接口调用说明

## 接口地址
```
GET http://8.210.52.217:8001/api/v1/smart-fortune/smart-analyze-stream
```

## 参数
| 参数 | 必填 | 说明 |
|------|------|------|
| question | 是 | 用户问题 |
| year | 是 | 出生年份 |
| month | 是 | 出生月份 |
| day | 是 | 出生日期 |
| hour | 否 | 出生时辰（默认12） |
| gender | 是 | 性别（male/female） |
| user_id | 否 | 用户ID |

## 返回格式（SSE流式）
```
event: status
data: {"stage": "intent", "message": "正在识别意图..."}

event: llm_chunk
data: {"content": "文本内容"}

event: error
data: {"message": "错误信息"}

event: end
data: {}
```

## 前端调用（EventSource）
```javascript
const url = `http://8.210.52.217:8001/api/v1/smart-fortune/smart-analyze-stream?` +
    `question=${encodeURIComponent("事业财富")}` +
    `&year=1990&month=1&day=15&hour=12&gender=male&user_id=test_user_001`;

const eventSource = new EventSource(url);

eventSource.addEventListener('status', (e) => {
    const data = JSON.parse(e.data);
    console.log('状态:', data.message);
});

eventSource.addEventListener('llm_chunk', (e) => {
    const data = JSON.parse(e.data);
    console.log('内容:', data.content);
    // 追加到页面
});

eventSource.addEventListener('error', (e) => {
    const data = JSON.parse(e.data);
    console.error('错误:', data.message);
    eventSource.close();
});

eventSource.addEventListener('end', () => {
    eventSource.close();
});
```

## 事件类型
- `status`: 状态更新
- `basic_analysis`: 基础分析结果
- `llm_start`: LLM开始
- `llm_chunk`: LLM内容块（流式）
- `llm_end`: LLM结束
- `error`: 错误
- `end`: 流结束

