# HiFate-bazi é¡¹ç›®é£Žé™©ç‚¹åˆ†æžæŠ¥å‘Š

> **ç”Ÿæˆæ—¶é—´**ï¼š2025-01-15  
> **åˆ†æžä¾æ®**ï¼šä»£ç å®¡æŸ¥ã€æž¶æž„æ–‡æ¡£ã€é…ç½®æ–‡ä»¶  
> **çŠ¶æ€**ï¼šå¾…ä¼˜åŒ–

---

## ðŸ“‹ ç›®å½•

- [ä¸€ã€æž¶æž„é£Žé™©ï¼ˆé«˜ï¼‰](#ä¸€æž¶æž„é£Žé™©é«˜)
- [äºŒã€å®‰å…¨é£Žé™©ï¼ˆé«˜ï¼‰](#äºŒå®‰å…¨é£Žé™©é«˜)
- [ä¸‰ã€å¯ç”¨æ€§é£Žé™©ï¼ˆé«˜ï¼‰](#ä¸‰å¯ç”¨æ€§é£Žé™©é«˜)
- [å››ã€æ•°æ®é£Žé™©ï¼ˆä¸­ï¼‰](#å››æ•°æ®é£Žé™©ä¸­)
- [äº”ã€æ€§èƒ½é£Žé™©ï¼ˆä¸­ï¼‰](#äº”æ€§èƒ½é£Žé™©ä¸­)
- [å…­ã€è¿ç»´é£Žé™©ï¼ˆä¸­ï¼‰](#å…­è¿ç»´é£Žé™©ä¸­)
- [ä¸ƒã€ä¾èµ–é£Žé™©ï¼ˆä¸­ï¼‰](#ä¸ƒä¾èµ–é£Žé™©ä¸­)
- [å…«ã€ä¸šåŠ¡é£Žé™©ï¼ˆä½Ž-ä¸­ï¼‰](#å…«ä¸šåŠ¡é£Žé™©ä½Ž-ä¸­)
- [é£Žé™©ä¼˜å…ˆçº§æ€»ç»“](#é£Žé™©ä¼˜å…ˆçº§æ€»ç»“)
- [å»ºè®®çš„æ”¹è¿›è·¯çº¿å›¾](#å»ºè®®çš„æ”¹è¿›è·¯çº¿å›¾)

---

## ä¸€ã€æž¶æž„é£Žé™©ï¼ˆé«˜ï¼‰

### 1.1 å•ç‚¹æ•…éšœé£Žé™©

| é£Žé™©ç‚¹ | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | çŽ°çŠ¶ |
|--------|---------|---------|------|
| **gRPC-Web ç½‘å…³ï¼ˆç«¯å£ 8001ï¼‰** | ðŸ”´ é«˜ | æ‰€æœ‰å‰ç«¯è¯·æ±‚ | å•å®žä¾‹è¿è¡Œï¼Œæ— è´Ÿè½½å‡è¡¡ |
| **MySQL ä¸»åº“** | ðŸ”´ é«˜ | æ‰€æœ‰æ•°æ®è¯»å†™ | æœ‰ä¸»ä»Žå¤åˆ¶æ–¹æ¡ˆï¼Œä½†é…ç½®å¯èƒ½ä¸å®Œå–„ |
| **Redis å•å®žä¾‹** | ðŸŸ¡ ä¸­ | ç¼“å­˜å’Œä¼šè¯ | æ— é›†ç¾¤é…ç½® |
| **Coze API ä¾èµ–** | ðŸ”´ é«˜ | LLM ç›¸å…³åŠŸèƒ½ | æœ‰é™çº§æ–¹æ¡ˆä½†ä¸å¤Ÿå®Œå–„ |

**å»ºè®®**ï¼š
- âœ… ä¸º Web æœåŠ¡é…ç½® Nginx è´Ÿè½½å‡è¡¡ + å¤šå®žä¾‹
- âœ… éªŒè¯ MySQL ä¸»ä»Žå¤åˆ¶çš„è‡ªåŠ¨æ•…éšœåˆ‡æ¢
- âœ… é…ç½® Redis å“¨å…µæ¨¡å¼æˆ–é›†ç¾¤
- âœ… å®Œå–„ Coze API çš„é™çº§æœºåˆ¶ï¼ˆç¼“å­˜ã€é‡è¯•ã€é™æµï¼‰

---

### 1.2 å¾®æœåŠ¡ä¾èµ–å¤æ‚åº¦

```
11 ä¸ªå¾®æœåŠ¡ç›¸äº’ä¾èµ–ï¼š
- bazi-core (9001)
- bazi-fortune (9002)
- bazi-analyzer (9003)
- bazi-rule (9004)
- fortune-analysis (9005)
- payment-service (9006)
- fortune-rule (9007)
- intent-service (9008)
- prompt-optimizer (9009)
- desk-fengshui (9010)
- web-app (8001) - ç½‘å…³
```

**é£Žé™©**ï¼š
- âš ï¸ æœåŠ¡é—´è°ƒç”¨é“¾è·¯é•¿ï¼Œæ•…éšœä¼ æ’­å¿«
- âš ï¸ ç¼ºä¹ç»Ÿä¸€çš„æœåŠ¡æ²»ç†ï¼ˆç†”æ–­ã€é™æµã€ç›‘æŽ§ï¼‰
- âš ï¸ æœåŠ¡å¯åŠ¨é¡ºåºä¾èµ–ä¸æ˜Žç¡®

**å»ºè®®**ï¼š
- âœ… å¼•å…¥æœåŠ¡ç½‘æ ¼ï¼ˆå¦‚ Istioï¼‰æˆ– API ç½‘å…³
- âœ… å®žçŽ°æœåŠ¡å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨æ¢å¤
- âœ… é…ç½®æœåŠ¡é—´çš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥

---

## äºŒã€å®‰å…¨é£Žé™©ï¼ˆé«˜ï¼‰

### 2.1 æ•æ„Ÿä¿¡æ¯æ³„éœ²é£Žé™©

**å‘çŽ°çš„æ•æ„Ÿä¿¡æ¯å­˜å‚¨ä½ç½®**ï¼š

1. **`config/services.env` åŒ…å«æ˜Žæ–‡ API Token**
   ```bash
   export COZE_ACCESS_TOKEN="pat_PtzrONUsEpMKhUb9mDc5nhyYwBWylvDgpgaFPd8TzM1gWRJZauIxtuUf147OnIde"
   ```

2. **æ•°æ®åº“å¯†ç é»˜è®¤å€¼ä¸ºå¼±å¯†ç **
   ```python
   'password': os.getenv('MYSQL_PASSWORD', os.getenv('MYSQL_ROOT_PASSWORD', '123456'))
   ```

3. **é…ç½®æ–‡ä»¶å¯èƒ½è¢«æäº¤åˆ°ä»£ç åº“**

**é£Žé™©**ï¼š
- ðŸ”´ æ•æ„Ÿä¿¡æ¯æ³„éœ²
- ðŸ”´ æ•°æ®åº“è¢«æœªæŽˆæƒè®¿é—®
- ðŸ”´ API Token è¢«æ»¥ç”¨

**å»ºè®®**ï¼š
- âœ… å°†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ç§»è‡³çŽ¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ Vaultï¼‰
- âœ… ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
- âœ… å°† `config/services.env` æ·»åŠ åˆ° `.gitignore`
- âœ… ä½¿ç”¨å¯†é’¥è½®æ¢æœºåˆ¶
- âœ… å®žçŽ°å¯†é’¥å®¡è®¡å’Œç›‘æŽ§

---

### 2.2 SQL æ³¨å…¥é£Žé™©

**çŽ°çŠ¶**ï¼š
- âœ… å¤§éƒ¨åˆ†æŸ¥è¯¢å·²ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- âš ï¸ ä½†éœ€è¦å…¨é¢å®¡è®¡æ‰€æœ‰ SQL è¯­å¥

**é£Žé™©**ï¼š
- ðŸ”´ å¯èƒ½å­˜åœ¨æœªå‘çŽ°çš„ SQL æ³¨å…¥æ¼æ´ž
- ðŸ”´ ç›´æŽ¥æ‹¼æŽ¥ SQL è¯­å¥çš„åœ°æ–¹

**å»ºè®®**ï¼š
- âœ… ä½¿ç”¨ ORMï¼ˆå¦‚ SQLAlchemyï¼‰ç»Ÿä¸€æ•°æ®åº“æ“ä½œ
- âœ… è¿›è¡Œä»£ç å®¡è®¡ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ç›´æŽ¥æ‹¼æŽ¥ SQL çš„åœ°æ–¹
- âœ… ä½¿ç”¨ SQL æ³¨å…¥æ‰«æå·¥å…·
- âœ… å®šæœŸè¿›è¡Œå®‰å…¨æ¸—é€æµ‹è¯•

---

### 2.3 è®¤è¯æŽˆæƒä¸å®Œå–„

**å‘çŽ°çš„è®¤è¯æœºåˆ¶**ï¼š
- å‰ç«¯ä½¿ç”¨ localStorage å­˜å‚¨ Token
- åŽç«¯æœ‰ JWT Token éªŒè¯ï¼Œä½†å¯èƒ½ä¸å…¨é¢

**é£Žé™©**ï¼š
- ðŸ”´ Token å­˜å‚¨åœ¨ localStorageï¼ˆæ˜“å— XSS æ”»å‡»ï¼‰
- ðŸŸ¡ ç¼ºä¹å®Œå–„çš„æƒé™æŽ§åˆ¶ç³»ç»Ÿ
- ðŸŸ¡ æ²¡æœ‰ API è®¿é—®é¢‘çŽ‡é™åˆ¶ï¼ˆè™½ç„¶æœ‰åŸºç¡€é™æµï¼‰

**å»ºè®®**ï¼š
- âœ… Token æ”¹ä¸º HttpOnly Cookie å­˜å‚¨
- âœ… å®žçŽ°åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ï¼ˆRBACï¼‰
- âœ… å®Œå–„ API é™æµå’Œ IP ç™½åå•æœºåˆ¶
- âœ… å®žçŽ° Token åˆ·æ–°æœºåˆ¶

---

## ä¸‰ã€å¯ç”¨æ€§é£Žé™©ï¼ˆé«˜ï¼‰

### 3.1 å¤–éƒ¨ API ä¾èµ–é£Žé™©

**Coze API ä¾èµ–**ï¼š

**çŽ°çŠ¶**ï¼š
- âœ… æœ‰é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º
- âš ï¸ ç¼ºä¹è‡ªåŠ¨é™çº§åˆ°è§„åˆ™åŒ¹é…æ¨¡å¼
- âš ï¸ æ²¡æœ‰ API è°ƒç”¨æ¬¡æ•°é™åˆ¶

**é£Žé™©**ï¼š
- ðŸ”´ Coze API æ•…éšœæ—¶ç”¨æˆ·ä½“éªŒå·®
- ðŸ”´ API é…é¢å¯èƒ½è¢«è€—å°½
- ðŸ”´ æ²¡æœ‰å¤‡ç”¨ LLM æä¾›å•†

**å»ºè®®**ï¼š
- âœ… å®žçŽ°è‡ªåŠ¨é™çº§æœºåˆ¶ï¼ˆCoze API å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨è§„åˆ™åŒ¹é…ï¼‰
- âœ… å¢žåŠ  API è°ƒç”¨ç¼“å­˜ï¼ˆç›¸åŒè¯·æ±‚è¿”å›žç¼“å­˜ç»“æžœï¼‰
- âœ… å®žçŽ° API é…é¢ç®¡ç†å’Œå‘Šè­¦
- âœ… è€ƒè™‘å¼•å…¥å¤šä¸ª LLM æä¾›å•†ä½œä¸ºå¤‡ç”¨

---

### 3.2 æ•°æ®åº“è¿žæŽ¥æ± é£Žé™©

**å½“å‰é…ç½®**ï¼š
```python
MYSQL_POOL_CONFIG = {
    'mincached': 10,        # æœ€å°è¿žæŽ¥æ•°
    'maxcached': 50,        # æœ€å¤§ç¼“å­˜è¿žæŽ¥æ•°
    'maxconnections': 100,  # æœ€å¤§è¿žæŽ¥æ•°
    'connection_timeout': 30,
    'recycle_time': 3600,
}
```

**é£Žé™©**ï¼š
- ðŸ”´ 11 ä¸ªæœåŠ¡å¯èƒ½åŒæ—¶è¿žæŽ¥æ•°æ®åº“
- ðŸ”´ é«˜å¹¶å‘ä¸‹å¯èƒ½è¾¾åˆ°æœ€å¤§è¿žæŽ¥æ•°
- âš ï¸ æ²¡æœ‰è¿žæŽ¥æ± ç›‘æŽ§å’Œå‘Šè­¦

**å»ºè®®**ï¼š
- âœ… æ ¹æ®å®žé™…è´Ÿè½½è°ƒæ•´è¿žæŽ¥æ± å¤§å°
- âœ… å®žçŽ°è¿žæŽ¥æ± ç›‘æŽ§ï¼ˆè¿žæŽ¥æ•°ã€ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ï¼‰
- âœ… é…ç½®æ•°æ®åº“è¿žæŽ¥å‘Šè­¦
- âœ… å®žçŽ°è¿žæŽ¥æ± å¥åº·æ£€æŸ¥

---

### 3.3 ç›‘æŽ§å’Œå‘Šè­¦ä¸è¶³

**çŽ°çŠ¶**ï¼š
- âœ… æœ‰æ—¥å¿—ç³»ç»Ÿ
- âš ï¸ ç¼ºä¹ç»Ÿä¸€ç›‘æŽ§
- âš ï¸ æ²¡æœ‰å‘Šè­¦æœºåˆ¶ï¼ˆæœåŠ¡æ•…éšœã€æ€§èƒ½ä¸‹é™ï¼‰
- âš ï¸ ç¼ºä¹ APMï¼ˆåº”ç”¨æ€§èƒ½ç›‘æŽ§ï¼‰

**é£Žé™©**ï¼š
- ðŸ”´ æœåŠ¡æ•…éšœæ— æ³•åŠæ—¶å‘çŽ°
- ðŸ”´ æ€§èƒ½é—®é¢˜æ— æ³•é¢„è­¦
- ðŸ”´ é—®é¢˜æŽ’æŸ¥å›°éš¾

**å»ºè®®**ï¼š
- âœ… å¼•å…¥ Prometheus + Grafana ç›‘æŽ§
- âœ… é…ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦ï¼ˆCPUã€å†…å­˜ã€é”™è¯¯çŽ‡ã€å“åº”æ—¶é—´ï¼‰
- âœ… å®žçŽ°åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼ˆå¦‚ Jaegerï¼‰
- âœ… é…ç½®æ—¥å¿—èšåˆï¼ˆå¦‚ ELK Stackï¼‰

---

## å››ã€æ•°æ®é£Žé™©ï¼ˆä¸­ï¼‰

### 4.1 å¤‡ä»½æœºåˆ¶ä¸å®Œå–„

**å‘çŽ°çš„å¤‡ä»½æ–¹æ¡ˆ**ï¼š
- âš ï¸ å¤‡ä»½æ˜¯æ‰‹åŠ¨çš„ï¼Œæ²¡æœ‰è‡ªåŠ¨åŒ–
- âš ï¸ æ²¡æœ‰å¤‡ä»½éªŒè¯æœºåˆ¶
- âš ï¸ æ²¡æœ‰å¼‚åœ°å¤‡ä»½
- âš ï¸ Redis æ•°æ®æ²¡æœ‰å¤‡ä»½

**é£Žé™©**ï¼š
- ðŸ”´ æ•°æ®ä¸¢å¤±æ— æ³•æ¢å¤
- ðŸ”´ å¤‡ä»½ä¸åŠæ—¶
- ðŸ”´ å¤‡ä»½æ•°æ®å¯èƒ½æŸå

**å»ºè®®**ï¼š
- âœ… å®žçŽ°è‡ªåŠ¨åŒ–æ¯æ—¥å¤‡ä»½ï¼ˆæ•°æ®åº“ + Redisï¼‰
- âœ… é…ç½®å¤‡ä»½éªŒè¯ï¼ˆå®šæœŸæ¢å¤æµ‹è¯•ï¼‰
- âœ… å®žçŽ°å¼‚åœ°å¤‡ä»½ï¼ˆOSS æˆ–å…¶ä»–äº‘å­˜å‚¨ï¼‰
- âœ… é…ç½®å¤‡ä»½ä¿ç•™ç­–ç•¥ï¼ˆ7 å¤©ã€30 å¤©ã€90 å¤©ï¼‰

---

### 4.2 æ•°æ®ä¸€è‡´æ€§é£Žé™©

**MySQL ä¸»ä»Žå¤åˆ¶**ï¼š
- âš ï¸ æ–‡æ¡£ä¸­æœ‰ä¸»ä»Žå¤åˆ¶é…ç½®ï¼Œä½†å¯èƒ½å­˜åœ¨æ•°æ®å»¶è¿Ÿ
- âš ï¸ è¯»å†™åˆ†ç¦»å¯èƒ½å¯¼è‡´è¯»åˆ°çš„æ•°æ®ä¸ä¸€è‡´

**é£Žé™©**ï¼š
- ðŸŸ¡ ä¸»ä»Žå»¶è¿Ÿå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- ðŸŸ¡ ä¸»ä»Žåˆ‡æ¢å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±

**å»ºè®®**ï¼š
- âœ… éªŒè¯ä¸»ä»Žå¤åˆ¶å»¶è¿Ÿç›‘æŽ§
- âœ… å®žçŽ°è¯»ä¸€è‡´æ€§çº§åˆ«æŽ§åˆ¶
- âœ… å…³é”®ä¸šåŠ¡å¼ºåˆ¶è¯»ä¸»åº“
- âœ… å®žçŽ°ä¸»ä»Žåˆ‡æ¢è‡ªåŠ¨åŒ–å’Œæ•°æ®ä¸€è‡´æ€§éªŒè¯

---

## äº”ã€æ€§èƒ½é£Žé™©ï¼ˆä¸­ï¼‰

### 5.1 LLM è°ƒç”¨æ€§èƒ½ç“¶é¢ˆ

**æ„å›¾è¯†åˆ«æ··åˆæž¶æž„**ï¼ˆå·²æœ‰ä¼˜åŒ–ï¼‰ï¼š
- âœ… æœ¬åœ°æ¨¡åž‹ + LLM å…œåº•
- âš ï¸ ä½† LLM è°ƒç”¨ä»å¯èƒ½æˆä¸ºç“¶é¢ˆï¼ˆ500-2000msï¼‰

**é£Žé™©**ï¼š
- ðŸŸ¡ LLM è°ƒç”¨æ…¢ï¼Œç”¨æˆ·ä½“éªŒå·®
- ðŸŸ¡ API è°ƒç”¨æˆæœ¬é«˜

**å»ºè®®**ï¼š
- âœ… å¢žåŠ  LLM ç»“æžœç¼“å­˜ï¼ˆç›¸åŒé—®é¢˜ç¼“å­˜ç»“æžœï¼‰
- âœ… å®žçŽ°å¼‚æ­¥ LLM è°ƒç”¨ï¼ˆæµå¼è¾“å‡ºï¼‰
- âœ… ä¼˜åŒ–æç¤ºè¯å‡å°‘ Token æ¶ˆè€—
- âœ… å®žçŽ°æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼ˆçƒ­ç‚¹é—®é¢˜é¢„ç¼“å­˜ï¼‰

---

### 5.2 æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

**é£Žé™©**ï¼š
- ðŸŸ¡ è§„åˆ™åŒ¹é…å¯èƒ½æ¶‰åŠå¤§é‡æ•°æ®åº“æŸ¥è¯¢
- ðŸŸ¡ ç¼ºä¹æŸ¥è¯¢æ€§èƒ½ç›‘æŽ§
- ðŸŸ¡ å¯èƒ½å­˜åœ¨æ…¢æŸ¥è¯¢

**å»ºè®®**ï¼š
- âœ… å®žçŽ°æ•°æ®åº“æ…¢æŸ¥è¯¢ç›‘æŽ§
- âœ… ä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ ç´¢å¼•
- âœ… å®žçŽ°æŸ¥è¯¢ç»“æžœç¼“å­˜ï¼ˆRedisï¼‰
- âœ… ä¼˜åŒ–è§„åˆ™åŒ¹é…ç®—æ³•ï¼ˆæ‰¹é‡æŸ¥è¯¢ã€é¢„åŠ è½½ï¼‰

---

### 5.3 ç¼“å­˜ç­–ç•¥ä¸å®Œå–„

**çŽ°çŠ¶**ï¼š
- âœ… Redis å·²é…ç½®
- âš ï¸ ç¼“å­˜ä½¿ç”¨å¯èƒ½ä¸å……åˆ†
- âš ï¸ æ²¡æœ‰ç¼“å­˜å¤±æ•ˆç­–ç•¥
- âš ï¸ æ²¡æœ‰ç¼“å­˜å‘½ä¸­çŽ‡ç›‘æŽ§

**é£Žé™©**ï¼š
- ðŸŸ¡ ç¼“å­˜å‘½ä¸­çŽ‡ä½Žï¼Œæ€§èƒ½ä¸ä½³
- ðŸŸ¡ ç¼“å­˜æ•°æ®å¯èƒ½è¿‡æœŸæˆ–ä¸ä¸€è‡´

**å»ºè®®**ï¼š
- âœ… ä¸ºé«˜é¢‘æŸ¥è¯¢æ·»åŠ ç¼“å­˜ï¼ˆå…«å­—è®¡ç®—ã€è§„åˆ™åŒ¹é…ï¼‰
- âœ… å®žçŽ°ç¼“å­˜é¢„çƒ­æœºåˆ¶
- âœ… ç›‘æŽ§ç¼“å­˜å‘½ä¸­çŽ‡
- âœ… å®žçŽ°ç¼“å­˜å¤±æ•ˆå’Œæ›´æ–°ç­–ç•¥

---

## å…­ã€è¿ç»´é£Žé™©ï¼ˆä¸­ï¼‰

### 6.1 éƒ¨ç½²å¤æ‚åº¦é«˜

**11 ä¸ªæœåŠ¡ + æ•°æ®åº“ + Redis**ï¼š
- âš ï¸ éƒ¨ç½²æ­¥éª¤å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™
- âš ï¸ ç¼ºä¹ç»Ÿä¸€çš„éƒ¨ç½²æµç¨‹
- âš ï¸ æ²¡æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•

**é£Žé™©**ï¼š
- ðŸŸ¡ éƒ¨ç½²å¤±è´¥çŽ‡é«˜
- ðŸŸ¡ éƒ¨ç½²æ—¶é—´é•¿
- ðŸŸ¡ å›žæ»šå›°éš¾

**å»ºè®®**ï¼š
- âœ… ä½¿ç”¨ Docker Compose ç»Ÿä¸€ç®¡ç†
- âœ… å®žçŽ° CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²
- âœ… å¢žåŠ éƒ¨ç½²å‰è‡ªåŠ¨åŒ–æµ‹è¯•
- âœ… å®žçŽ°ä¸€é”®éƒ¨ç½²å’Œå›žæ»šè„šæœ¬

---

### 6.2 æ—¥å¿—ç®¡ç†ä¸ç»Ÿä¸€

**çŽ°çŠ¶**ï¼š
- âš ï¸ æ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ—¥å¿—æ–‡ä»¶
- âš ï¸ æ—¥å¿—æ ¼å¼ä¸ç»Ÿä¸€
- âš ï¸ ç¼ºä¹æ—¥å¿—èšåˆå’Œåˆ†æž

**é£Žé™©**ï¼š
- ðŸŸ¡ é—®é¢˜æŽ’æŸ¥å›°éš¾
- ðŸŸ¡ æ— æ³•å…¨å±€åˆ†æžæ—¥å¿—
- ðŸŸ¡ æ—¥å¿—å ç”¨ç©ºé—´å¤§

**å»ºè®®**ï¼š
- âœ… ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼ˆJSON æ ¼å¼ï¼‰
- âœ… å¼•å…¥æ—¥å¿—èšåˆç³»ç»Ÿï¼ˆELK Stack æˆ– Lokiï¼‰
- âœ… å®žçŽ°æ—¥å¿—çº§åˆ«åŠ¨æ€è°ƒæ•´
- âœ… é…ç½®æ—¥å¿—è½®è½¬å’Œæ¸…ç†ç­–ç•¥

---

### 6.3 ç‰ˆæœ¬ç®¡ç†é£Žé™©

**é£Žé™©**ï¼š
- ðŸŸ¡ å¤šä¸ªæœåŠ¡ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´
- ðŸŸ¡ æ•°æ®åº“è¿ç§»å¯èƒ½å¤±è´¥
- ðŸŸ¡ å›žæ»šæœºåˆ¶ä¸å®Œå–„

**å»ºè®®**ï¼š
- âœ… å®žçŽ°ç‰ˆæœ¬æ ‡ç­¾ç®¡ç†ï¼ˆæ‰€æœ‰æœåŠ¡ç»Ÿä¸€ç‰ˆæœ¬ï¼‰
- âœ… æ•°æ®åº“è¿ç§»å‰å¤‡ä»½
- âœ… å®Œå–„å›žæ»šè„šæœ¬å’Œæµç¨‹
- âœ… å®žçŽ°ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

---

## ä¸ƒã€ä¾èµ–é£Žé™©ï¼ˆä¸­ï¼‰

### 7.1 ç¬¬ä¸‰æ–¹åº“ä¾èµ–

**å…³é”®ä¾èµ–**ï¼š
- `grpcio==1.60.0`ï¼ˆé™çº§ç‰ˆæœ¬ï¼Œå¯èƒ½æœ‰å…¼å®¹æ€§é—®é¢˜ï¼‰
- `mediapipe>=0.10.14,<0.10.19`ï¼ˆç‰ˆæœ¬é™åˆ¶ä¸¥æ ¼ï¼‰
- `protobuf>=4.25.3,<5`ï¼ˆç‰ˆæœ¬é™åˆ¶ï¼‰

**é£Žé™©**ï¼š
- ðŸŸ¡ ä¾èµ–ç‰ˆæœ¬å†²çª
- ðŸŸ¡ å®‰å…¨æ¼æ´žä¿®å¤å»¶è¿Ÿ
- ðŸŸ¡ å‡çº§å›°éš¾

**å»ºè®®**ï¼š
- âœ… å®šæœŸæ›´æ–°ä¾èµ–å¹¶æµ‹è¯•
- âœ… ä½¿ç”¨ä¾èµ–å®‰å…¨æ‰«æå·¥å…·ï¼ˆå¦‚ safetyã€pip-auditï¼‰
- âœ… è®°å½•ä¾èµ–å‡çº§æ—¥å¿—
- âœ… ä¿æŒä¾èµ–ç‰ˆæœ¬æœ€æ–°ï¼ˆåœ¨å…¼å®¹èŒƒå›´å†…ï¼‰

---

### 7.2 å¤–éƒ¨æœåŠ¡ä¾èµ–

**ä¾èµ–çš„å¤–éƒ¨æœåŠ¡**ï¼š
- Coze APIï¼ˆLLM æœåŠ¡ï¼‰
- æ”¯ä»˜æœåŠ¡ï¼ˆStripeã€å¾®ä¿¡ã€æ”¯ä»˜å®ï¼‰
- ç¬¬ä¸‰æ–¹è¿åŠ¿ API

**é£Žé™©**ï¼š
- ðŸŸ¡ æœåŠ¡ä¸å¯ç”¨
- ðŸŸ¡ API å˜æ›´
- ðŸŸ¡ é…é¢é™åˆ¶

**å»ºè®®**ï¼š
- âœ… å®žçŽ°å¤šæä¾›å•†å¤‡é€‰æ–¹æ¡ˆ
- âœ… ç›‘æŽ§å¤–éƒ¨ API çŠ¶æ€
- âœ… å®žçŽ° API è°ƒç”¨é™æµå’Œé…é¢ç®¡ç†
- âœ… å®žçŽ°æœåŠ¡é™çº§å’Œç†”æ–­æœºåˆ¶

---

## å…«ã€ä¸šåŠ¡é£Žé™©ï¼ˆä½Ž-ä¸­ï¼‰

### 8.1 è§„åˆ™åŒ¹é…å‡†ç¡®æ€§

**è§„åˆ™å­˜å‚¨åœ¨æ•°æ®åº“**ï¼š
- âš ï¸ è§„åˆ™æ•°é‡åºžå¤§ï¼ŒåŒ¹é…å‡†ç¡®æ€§ä¾èµ–è§„åˆ™è´¨é‡
- âš ï¸ è§„åˆ™æ›´æ–°å¯èƒ½å½±å“çŽ°æœ‰åŠŸèƒ½

**é£Žé™©**ï¼š
- ðŸŸ¡ è§„åˆ™åŒ¹é…é”™è¯¯
- ðŸŸ¡ è§„åˆ™å†²çª

**å»ºè®®**ï¼š
- âœ… å®žçŽ°è§„åˆ™åŒ¹é…æµ‹è¯•ç”¨ä¾‹
- âœ… è§„åˆ™æ›´æ–°å‰è¿›è¡Œå›žå½’æµ‹è¯•
- âœ… ç›‘æŽ§è§„åˆ™åŒ¹é…æˆåŠŸçŽ‡
- âœ… å®žçŽ°è§„åˆ™è´¨é‡è¯„ä¼°æœºåˆ¶

---

### 8.2 ç”¨æˆ·ä½“éªŒé£Žé™©

**é£Žé™©**ï¼š
- ðŸŸ¡ LLM è°ƒç”¨æ…¢ï¼Œç”¨æˆ·ä½“éªŒå·®
- ðŸŸ¡ é”™è¯¯ä¿¡æ¯ä¸å¤Ÿå‹å¥½
- ðŸŸ¡ ç¼ºä¹åŠ è½½çŠ¶æ€æç¤º

**å»ºè®®**ï¼š
- âœ… ä¼˜åŒ– LLM è°ƒç”¨ï¼ˆå¼‚æ­¥ã€æµå¼ï¼‰
- âœ… æ”¹å–„é”™è¯¯æç¤º
- âœ… å¢žåŠ åŠ è½½åŠ¨ç”»å’Œè¿›åº¦æç¤º
- âœ… å®žçŽ°ç”¨æˆ·åé¦ˆæ”¶é›†æœºåˆ¶

---

## é£Žé™©ä¼˜å…ˆçº§æ€»ç»“

| ä¼˜å…ˆçº§ | é£Žé™©ç±»åž‹ | é£Žé™©ç‚¹ | å»ºè®®å¤„ç†æ—¶é—´ | çŠ¶æ€ |
|--------|---------|--------|------------|------|
| **P0** | å®‰å…¨ | æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€SQL æ³¨å…¥ | ç«‹å³ | ðŸ”´ å¾…å¤„ç† |
| **P0** | å¯ç”¨æ€§ | å•ç‚¹æ•…éšœã€å¤–éƒ¨ API ä¾èµ– | 1 å‘¨å†… | ðŸ”´ å¾…å¤„ç† |
| **P1** | æ•°æ® | å¤‡ä»½æœºåˆ¶ã€æ•°æ®ä¸€è‡´æ€§ | 2 å‘¨å†… | ðŸŸ¡ å¾…å¤„ç† |
| **P1** | æ€§èƒ½ | LLM æ€§èƒ½ç“¶é¢ˆã€ç¼“å­˜ç­–ç•¥ | 1 ä¸ªæœˆå†… | ðŸŸ¡ å¾…å¤„ç† |
| **P2** | è¿ç»´ | éƒ¨ç½²å¤æ‚åº¦ã€æ—¥å¿—ç®¡ç† | 2 ä¸ªæœˆå†… | ðŸŸ¢ å¾…ä¼˜åŒ– |
| **P2** | ä¾èµ– | ç¬¬ä¸‰æ–¹åº“å®‰å…¨ã€å¤–éƒ¨æœåŠ¡ | æŒç»­ç›‘æŽ§ | ðŸŸ¢ æŒç»­æ”¹è¿› |

---

## å»ºè®®çš„æ”¹è¿›è·¯çº¿å›¾

### ðŸš¨ ç¬¬ä¸€é˜¶æ®µï¼ˆç´§æ€¥ï¼Œ1 å‘¨å†…ï¼‰

**ç›®æ ‡**ï¼šæ¶ˆé™¤é«˜é£Žé™©å®‰å…¨éšæ‚£å’Œå•ç‚¹æ•…éšœ

1. **å®‰å…¨åŠ å›º**
   - [ ] ç§»é™¤ä»£ç ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼ˆAPI Tokenã€å¯†ç ï¼‰
   - [ ] å°†æ•æ„Ÿé…ç½®ç§»è‡³çŽ¯å¢ƒå˜é‡
   - [ ] ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
   - [ ] SQL æ³¨å…¥æ¼æ´žå…¨é¢å®¡è®¡

2. **é«˜å¯ç”¨æ”¹é€ **
   - [ ] å®žçŽ°è‡ªåŠ¨åŒ–å¤‡ä»½æœºåˆ¶
   - [ ] é…ç½®æœåŠ¡å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯
   - [ ] å®Œå–„ Coze API é™çº§æœºåˆ¶
   - [ ] éªŒè¯ MySQL ä¸»ä»Žå¤åˆ¶æ•…éšœåˆ‡æ¢

---

### âš¡ ç¬¬äºŒé˜¶æ®µï¼ˆé‡è¦ï¼Œ1 ä¸ªæœˆå†…ï¼‰

**ç›®æ ‡**ï¼šæå‡ç³»ç»Ÿç›‘æŽ§ã€æ€§èƒ½å’Œç¨³å®šæ€§

1. **ç›‘æŽ§ä½“ç³»**
   - [ ] å®žçŽ°ç»Ÿä¸€çš„ç›‘æŽ§å’Œå‘Šè­¦ç³»ç»Ÿï¼ˆPrometheus + Grafanaï¼‰
   - [ ] é…ç½®å…³é”®æŒ‡æ ‡å‘Šè­¦
   - [ ] å®žçŽ°åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª

2. **æ€§èƒ½ä¼˜åŒ–**
   - [ ] å®Œå–„ç¼“å­˜ç­–ç•¥ï¼ˆRedis ç¼“å­˜ï¼‰
   - [ ] å®žçŽ°æ•°æ®åº“æ…¢æŸ¥è¯¢ç›‘æŽ§
   - [ ] ä¼˜åŒ– LLM è°ƒç”¨æ€§èƒ½ï¼ˆç¼“å­˜ã€å¼‚æ­¥ï¼‰

3. **æœåŠ¡æ²»ç†**
   - [ ] é…ç½®æœåŠ¡é—´çš„ç†”æ–­å’Œé™æµ
   - [ ] å®žçŽ°æœåŠ¡å¥åº·æ£€æŸ¥
   - [ ] ä¼˜åŒ–è¿žæŽ¥æ± é…ç½®

---

### ðŸŽ¯ ç¬¬ä¸‰é˜¶æ®µï¼ˆä¼˜åŒ–ï¼Œ3 ä¸ªæœˆå†…ï¼‰

**ç›®æ ‡**ï¼šå®žçŽ°é«˜å¯ç”¨ã€è‡ªåŠ¨åŒ–è¿ç»´å’ŒæŒç»­ä¼˜åŒ–

1. **é«˜å¯ç”¨æž¶æž„**
   - [ ] å®žçŽ°æœåŠ¡é«˜å¯ç”¨ï¼ˆè´Ÿè½½å‡è¡¡ã€å¤šå®žä¾‹ï¼‰
   - [ ] é…ç½® Redis é›†ç¾¤
   - [ ] å®žçŽ°å¼‚åœ°å¤‡ä»½

2. **è¿ç»´è‡ªåŠ¨åŒ–**
   - [ ] å¼•å…¥ CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²
   - [ ] å®žçŽ°ä¸€é”®éƒ¨ç½²å’Œå›žæ»šè„šæœ¬
   - [ ] é…ç½®æ—¥å¿—èšåˆç³»ç»Ÿ

3. **æŒç»­ä¼˜åŒ–**
   - [ ] å®šæœŸæ›´æ–°ä¾èµ–å¹¶æµ‹è¯•
   - [ ] ä¼˜åŒ–è§„åˆ™åŒ¹é…ç®—æ³•
   - [ ] å®žçŽ°ç”¨æˆ·åé¦ˆæ”¶é›†æœºåˆ¶

---

## é£Žé™©è¿½è¸ªè®°å½•

### 2025-01-15
- âœ… å®Œæˆé¡¹ç›®é£Žé™©ç‚¹åˆ†æž
- âœ… ç”Ÿæˆé£Žé™©åˆ†æžæŠ¥å‘Š
- ðŸ”„ å¾…ï¼šå¼€å§‹ç¬¬ä¸€é˜¶æ®µæ”¹è¿›å·¥ä½œ

---

## ç›¸å…³æ–‡æ¡£

- [Dockerç”Ÿäº§éƒ¨ç½²å®Œæ•´æŒ‡å—](./Dockerç”Ÿäº§éƒ¨ç½²å®Œæ•´æŒ‡å—.md)
- [å¼€å‘è§„èŒƒ](../.cursorrules)
- [ä¸Šçº¿éƒ¨ç½²](./ä¸Šçº¿éƒ¨ç½².md)
- [æ€§èƒ½ç“¶é¢ˆè¯¦ç»†åˆ†æž](./æ€§èƒ½ç“¶é¢ˆè¯¦ç»†åˆ†æž.md)

---

**æŠ¥å‘Šç»´æŠ¤**ï¼šå®šæœŸæ›´æ–°é£Žé™©çŠ¶æ€å’Œä¼˜åŒ–è¿›åº¦  
**æ›´æ–°é¢‘çŽ‡**ï¼šæ¯æœˆæˆ–é‡å¤§å˜æ›´åŽ

