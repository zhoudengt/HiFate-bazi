# æ‰¹é‡ä¿®æ”¹è§„åˆ™å†…å®¹ - å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¿«é€Ÿæ“ä½œï¼ˆ5æ­¥ï¼‰

### 1ï¸âƒ£ åˆ›å»º Excel æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰

```bash
python scripts/excel_to_rules_content_json.py --mode template \
  --template-output rules_template.xlsx
```

### 2ï¸âƒ£ ç¼–è¾‘ Excel æ–‡ä»¶

**æ ¼å¼è¦æ±‚ï¼š**

| rule_code | content_text                    | content_type |
|-----------|--------------------------------|--------------|
| 10156     | æ³¨æ„å…³æ³¨ï¼Œå¤–æ¥å¥³äººäº‰ä¸ˆå¤«ã€‚      | description  |

**é‡è¦ï¼š** `rule_code` å¯ä»¥ä¸å¸¦ `MARR-` å‰ç¼€ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ·»åŠ ã€‚

### 3ï¸âƒ£ è½¬æ¢ä¸º JSON

```bash
python scripts/excel_to_rules_content_json.py --mode convert \
  --excel rules_template.xlsx \
  --output rules_content.json
```

### 4ï¸âƒ£ æµ‹è¯•æ›´æ–°ï¼ˆæ¨¡æ‹Ÿè¿è¡Œï¼‰

```bash
python scripts/batch_update_content_from_json.py --mode import \
  --file rules_content.json \
  --dry-run
```

### 5ï¸âƒ£ æ‰§è¡Œå®é™…æ›´æ–°

```bash
python scripts/batch_update_content_from_json.py --mode import \
  --file rules_content.json
```

---

## ğŸ“‹ Excel æ–‡ä»¶æ ¼å¼

### å¿…éœ€çš„åˆ—

- **rule_code**: è§„åˆ™ç¼–å·ï¼ˆå¦‚ `10156`ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ·»åŠ  `MARR-`ï¼‰
- **content_text**: è§„åˆ™å†…å®¹æ–‡æœ¬

### å¯é€‰çš„åˆ—

- **content_type**: å†…å®¹ç±»å‹ï¼ˆé»˜è®¤ `description`ï¼‰

### ç¤ºä¾‹

```
| rule_code | content_text                    | content_type |
|-----------|--------------------------------|--------------|
| 10156     | æ³¨æ„å…³æ³¨ï¼Œå¤–æ¥å¥³äººäº‰ä¸ˆå¤«ã€‚      | description  |
| 10157     | å…¶ä»–è§„åˆ™å†…å®¹1                   | description  |
```

---

## âš™ï¸ é«˜çº§é€‰é¡¹

### è‡ªå®šä¹‰åˆ—å

```bash
python scripts/excel_to_rules_content_json.py --mode convert \
  --excel rules.xlsx \
  --output rules.json \
  --rule-code-column "è§„åˆ™ç¼–å·" \
  --content-text-column "è§„åˆ™å†…å®¹"
```

### æŒ‡å®šå·¥ä½œè¡¨

```bash
python scripts/excel_to_rules_content_json.py --mode convert \
  --excel rules.xlsx \
  --output rules.json \
  --sheet "è§„åˆ™è¡¨"
```

### è‡ªå®šä¹‰å‰ç¼€

```bash
python scripts/excel_to_rules_content_json.py --mode convert \
  --excel rules.xlsx \
  --output rules.json \
  --rule-code-prefix "RULE-"
```

---

## âœ… éªŒè¯æ›´æ–°

### é€šè¿‡ API éªŒè¯

```bash
curl -X POST http://127.0.0.1:8001/api/v1/bazi/rules/match \
  -H "Content-Type: application/json" \
  -d '{
    "solar_date": "1990-05-15",
    "solar_time": "14:30",
    "gender": "male",
    "rule_types": ["marriage_ten_gods"]
  }' | jq '.matched_rules[] | select(.rule_code == "MARR-10156") | .content'
```

### é€šè¿‡æ•°æ®åº“éªŒè¯

```sql
SELECT rule_code, content, updated_at 
FROM bazi_rules 
WHERE rule_code = 'MARR-10156';
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. âœ… **åªä¿®æ”¹ content**ï¼šå…¶ä»–å­—æ®µï¼ˆ`rule_code`ã€`conditions` ç­‰ï¼‰ä¿æŒä¸å˜
2. âœ… **è‡ªåŠ¨æ·»åŠ å‰ç¼€**ï¼š`rule_code` å¯ä»¥ä¸å¸¦ `MARR-` å‰ç¼€
3. âœ… **å…ˆæµ‹è¯•å†æ›´æ–°**ï¼šåŠ¡å¿…å…ˆä½¿ç”¨ `--dry-run` æµ‹è¯•
4. âœ… **è‡ªåŠ¨çƒ­åŠ è½½**ï¼šæ›´æ–°åè‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·ï¼Œè§¦å‘çƒ­åŠ è½½

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- **å®Œæ•´æ“ä½œæµç¨‹**ï¼š`docs/æ‰¹é‡ä¿®æ”¹è§„åˆ™å†…å®¹æ“ä½œæµç¨‹.md`
- **Excel æ ¼å¼è¯´æ˜**ï¼š`docs/Excelæ ¼å¼è¯´æ˜.md`
- **JSON æ ¼å¼è¯´æ˜**ï¼š`docs/åŸºäºJSONæ‰¹é‡ä¿®æ”¹è§„åˆ™å†…å®¹.md`

---

## ğŸ”§ å¸¸è§é—®é¢˜

**Q: Excel æ–‡ä»¶è¯»å–å¤±è´¥ï¼Ÿ**  
A: æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦ä¸º `.xlsx`ï¼Œæ–‡ä»¶æ˜¯å¦è¢«å ç”¨ã€‚

**Q: æç¤ºç¼ºå°‘å¿…éœ€çš„åˆ—ï¼Ÿ**  
A: æ£€æŸ¥ Excel æ˜¯å¦åŒ…å« `rule_code` å’Œ `content_text` åˆ—ã€‚

**Q: è§„åˆ™æ›´æ–°åæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ**  
A: æ£€æŸ¥è§„åˆ™ç‰ˆæœ¬å·æ˜¯å¦å·²æ›´æ–°ï¼ŒæœåŠ¡æ˜¯å¦æ”¯æŒçƒ­åŠ è½½ã€‚

