#!/bin/bash
# 运行修复和测试的便捷脚本

echo "============================================================"
echo "🔧 修复生产环境规则问题"
echo "============================================================"

# 步骤 1: 快速测试当前状态
echo ""
echo "步骤 1: 测试当前状态"
echo "============================================================"
python3 scripts/quick_test_production.py

# 步骤 2: 询问是否继续
echo ""
echo "============================================================"
echo "❓ 是否继续修复？"
echo "============================================================"
echo "如果匹配数量不足，请选择:"
echo "  1. 自动修复（需要 SSH 密码）"
echo "  2. 手动修复（推荐）"
echo "  3. 仅测试（不修复）"
echo ""
read -p "请输入选项 (1/2/3，默认 3): " choice
choice=${choice:-3}

case $choice in
    1)
        echo ""
        echo "执行自动修复..."
        python3 scripts/fix_production_rules.py
        ;;
    2)
        echo ""
        echo "执行手动修复脚本..."
        bash scripts/manual_sync_rules_to_production.sh
        ;;
    3)
        echo ""
        echo "跳过修复，仅测试"
        ;;
    *)
        echo "无效选项，跳过修复"
        ;;
esac

# 步骤 3: 最终测试
echo ""
echo "============================================================"
echo "步骤 2: 最终测试验证"
echo "============================================================"
python3 scripts/quick_test_production.py

echo ""
echo "============================================================"
echo "✅ 完成！"
echo "============================================================"

