<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - HiFate</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/fatetell-style.css">
    <style>
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-box">
            <h1>HiFateç³»ç»Ÿ - ç™»å½•</h1>
            <div class="debug-info" id="debugInfo">æ­£åœ¨åŠ è½½è„šæœ¬...</div>
            <form id="loginForm">
                <div class="form-group">
                    <label>ç”¨æˆ·å</label>
                    <input type="text" id="username" value="admin" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="password" value="admin123" required>
                </div>
                <button type="submit" class="btn btn-primary">ç™»å½•</button>
            </form>
            <div id="errorMsg" class="error-msg"></div>
        </div>
    </div>

    <script>
        // è°ƒè¯•ä¿¡æ¯
        const debugInfo = document.getElementById('debugInfo');
        function updateDebug(msg) {
            debugInfo.innerHTML += '<br>' + msg;
            console.log(msg);
        }
        
        updateDebug('1. å¼€å§‹åŠ è½½è„šæœ¬...');
    </script>
    
    <script src="config.js" 
            onload="updateDebug('2. âœ… config.js åŠ è½½æˆåŠŸ'); console.log('TOKEN_KEY:', typeof TOKEN_KEY !== 'undefined' ? 'âœ…' : 'âŒ');"
            onerror="updateDebug('2. âŒ config.js åŠ è½½å¤±è´¥'); console.error('config.js åŠ è½½å¤±è´¥');"></script>
    
    <script src="js/api.js"
            onload="updateDebug('3. âœ… api.js åŠ è½½æˆåŠŸ'); console.log('api:', typeof api !== 'undefined' ? 'âœ…' : 'âŒ');"
            onerror="updateDebug('3. âŒ api.js åŠ è½½å¤±è´¥'); console.error('api.js åŠ è½½å¤±è´¥');"></script>
    
    <script src="js/auth.js"
            onload="updateDebug('4. âœ… auth.js åŠ è½½æˆåŠŸ'); console.log('Auth:', typeof Auth !== 'undefined' ? 'âœ…' : 'âŒ');"
            onerror="updateDebug('4. âŒ auth.js åŠ è½½å¤±è´¥'); console.error('auth.js åŠ è½½å¤±è´¥');"></script>
    
    <script>
        // ç­‰å¾…æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            updateDebug('5. é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥...');
            
            const checks = [];
            checks.push('TOKEN_KEY: ' + (typeof TOKEN_KEY !== 'undefined' ? 'âœ…' : 'âŒ'));
            checks.push('api: ' + (typeof api !== 'undefined' ? 'âœ…' : 'âŒ'));
            checks.push('Auth: ' + (typeof Auth !== 'undefined' ? 'âœ…' : 'âŒ'));
            
            updateDebug('æ£€æŸ¥ç»“æœ: ' + checks.join(', '));
            
            // æ£€æŸ¥å¿…è¦çš„å¯¹è±¡æ˜¯å¦å·²åŠ è½½
            if (typeof Auth === 'undefined') {
                const errorMsg = document.getElementById('errorMsg');
                errorMsg.textContent = 'âŒ Auth å¯¹è±¡æœªå®šä¹‰ï¼è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ã€‚';
                errorMsg.style.color = 'red';
                updateDebug('âŒ Auth æœªå®šä¹‰ï¼Œæ— æ³•ç»§ç»­');
                return;
            }
            
            if (typeof api === 'undefined') {
                const errorMsg = document.getElementById('errorMsg');
                errorMsg.textContent = 'âŒ api å¯¹è±¡æœªå®šä¹‰ï¼è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ã€‚';
                errorMsg.style.color = 'red';
                updateDebug('âŒ api æœªå®šä¹‰ï¼Œæ— æ³•ç»§ç»­');
                return;
            }
            
            updateDebug('âœ… æ‰€æœ‰å¯¹è±¡å·²åŠ è½½ï¼Œå¯ä»¥ç™»å½•');
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = document.getElementById('username').value;
                    const password = document.getElementById('password').value;
                    const errorMsg = document.getElementById('errorMsg');
                    
                    try {
                        errorMsg.textContent = '';
                        errorMsg.style.color = '';
                        updateDebug('ğŸ” å¼€å§‹ç™»å½•: ' + username);
                        await Auth.login(username, password);
                        updateDebug('âœ… ç™»å½•æˆåŠŸï¼Œè·³è½¬ä¸­...');
                        window.location.href = 'index.html';
                    } catch (error) {
                        updateDebug('âŒ ç™»å½•å¤±è´¥: ' + error.message);
                        errorMsg.textContent = error.message || 'ç™»å½•å¤±è´¥';
                        errorMsg.style.color = 'red';
                    }
                });
            } else {
                updateDebug('âŒ ç™»å½•è¡¨å•æœªæ‰¾åˆ°');
            }
        });
    </script>
</body>
</html>
