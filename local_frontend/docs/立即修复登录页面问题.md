# 立即修复登录页面401错误

## 问题确认

访问 `http://localhost:8001/frontend/login.html` 返回 401 错误，页面显示 JSON：
```json
{"success":false,"error":"未提供认证信息,请在请求头中添加 Authorization: Bearer <token>","error_type":"unauthorized"}
```

## 根本原因

认证中间件拦截了所有请求，包括静态文件。虽然已更新代码添加白名单前缀，但**服务器需要重启才能使中间件修改生效**。

## 立即修复步骤

### 步骤1：重启后端服务

**方法1：如果服务在终端运行**
1. 找到运行服务的终端窗口
2. 按 `Ctrl+C` 停止服务
3. 重新启动：
   ```bash
   cd /Users/zhoudt/Downloads/project/HiFate-bazi
   python3 server/start.py
   ```

**方法2：如果服务在后台运行**
```bash
# 查找进程
ps aux | grep "python.*server/start.py" | grep -v grep

# 停止进程（替换 PID）
kill <PID>

# 重新启动
cd /Users/zhoudt/Downloads/project/HiFate-bazi
python3 server/start.py
```

### 步骤2：验证修复

重启后，运行测试脚本：
```bash
bash scripts/test_frontend_access.sh
```

或者直接访问：
```bash
curl http://localhost:8001/frontend/login.html | head -n 5
```

**预期结果**：应该返回 HTML 内容（`<!DOCTYPE html>`），而不是 JSON。

### 步骤3：浏览器验证

1. 刷新页面：`http://localhost:8001/frontend/login.html`
2. **预期结果**：
   - 页面显示登录表单（不是 JSON）
   - 浏览器控制台无 401 错误
   - 工具类正常加载

## 为什么需要重启？

中间件代码修改后，Python 不会自动重新加载中间件类。需要：
- **重启服务**：确保新的中间件代码生效
- **或等待热更新**：但中间件代码可能不在热更新监控范围内

## 修复后的验证清单

- [ ] 访问 `/frontend/login.html` 显示登录表单（不是 JSON）
- [ ] 访问 `/frontend/js/core/error-handler.js` 返回 JavaScript 文件
- [ ] 浏览器控制台无 401 错误
- [ ] 登录功能正常工作
- [ ] 错误处理显示友好错误消息

---

**重启服务后，所有问题应该解决！**

