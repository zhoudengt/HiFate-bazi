# 前端工具链配置指南

> **本指南说明如何配置 Vite、ESLint、Prettier 等前端工具链。**

## 一、工具链概览

### 1.1 工具列表

- **构建工具**：Vite - 快速开发构建工具
- **代码规范**：ESLint - 代码检查
- **代码格式化**：Prettier - 代码格式化
- **测试框架**：Vitest（单元测试）+ Playwright（E2E测试）

### 1.2 目录结构

```
local_frontend/
├── src/                    # 源代码（未来模块化）
├── dist/                   # 构建输出
├── vite.config.js          # Vite配置
├── .eslintrc.js            # ESLint配置
├── .prettierrc             # Prettier配置
├── package.json            # 依赖管理
└── ...
```

## 二、Vite 配置

### 2.1 安装依赖

```bash
cd local_frontend
npm init -y
npm install -D vite
```

### 2.2 创建 vite.config.js

```javascript
import { defineConfig } from 'vite';

export default defineConfig({
  // 开发服务器配置
  server: {
    port: 8080,
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8001',
        changeOrigin: true
      }
    }
  },
  
  // 构建配置
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'terser',
    rollupOptions: {
      input: {
        main: './index.html',
        // 添加其他页面入口
      }
    }
  },
  
  // 插件配置
  plugins: []
});
```

### 2.3 package.json 脚本

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

## 三、ESLint 配置

### 3.1 安装依赖

```bash
npm install -D eslint eslint-config-standard eslint-plugin-standard
```

### 3.2 创建 .eslintrc.js

```javascript
module.exports = {
  env: {
    browser: true,
    es2021: true
  },
  extends: [
    'standard'
  ],
  parserOptions: {
    ecmaVersion: 12,
    sourceType: 'module'
  },
  rules: {
    // 自定义规则
    'no-console': 'warn', // 生产代码中警告console.log
    'no-debugger': 'error',
    'no-alert': 'error',
    'no-unused-vars': 'warn',
    'prefer-const': 'error',
    'no-var': 'error'
  },
  globals: {
    // 全局变量声明
    'ErrorHandler': 'readonly',
    'DomUtils': 'readonly',
    'Validator': 'readonly',
    'api': 'readonly',
    'API_CONFIG': 'readonly',
    'GRPC_CONFIG': 'readonly',
    'TOKEN_KEY': 'readonly'
  }
};
```

### 3.3 package.json 脚本

```json
{
  "scripts": {
    "lint": "eslint js/**/*.js",
    "lint:fix": "eslint js/**/*.js --fix"
  }
}
```

## 四、Prettier 配置

### 4.1 安装依赖

```bash
npm install -D prettier eslint-config-prettier
```

### 4.2 创建 .prettierrc

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 4,
  "trailingComma": "none",
  "printWidth": 100,
  "arrowParens": "avoid"
}
```

### 4.3 创建 .prettierignore

```
node_modules/
dist/
*.min.js
```

### 4.4 package.json 脚本

```json
{
  "scripts": {
    "format": "prettier --write \"js/**/*.js\"",
    "format:check": "prettier --check \"js/**/*.js\""
  }
}
```

## 五、Git Hooks 配置

### 5.1 安装 husky

```bash
npm install -D husky lint-staged
```

### 5.2 初始化 husky

```bash
npx husky install
npx husky add .husky/pre-commit "npx lint-staged"
```

### 5.3 配置 lint-staged

在 package.json 中添加：

```json
{
  "lint-staged": {
    "js/**/*.js": [
      "eslint --fix",
      "prettier --write"
    ]
  }
}
```

## 六、渐进式迁移

### 6.1 阶段1：保持现有结构

- 保持现有 HTML 文件结构
- 逐步迁移 JS 文件到 src/js
- 使用 Vite 作为开发服务器

### 6.2 阶段2：模块化改造

- 将所有 JS 文件迁移到 src/js
- 使用 ES 模块导入
- 重构代码使用统一工具类

### 6.3 阶段3：完整构建流程

- 配置完整构建流程
- 代码分割和优化
- 生产环境部署

## 七、使用说明

### 7.1 开发模式

```bash
npm run dev
```

访问：http://localhost:8080

### 7.2 代码检查

```bash
npm run lint
npm run lint:fix
```

### 7.3 代码格式化

```bash
npm run format
npm run format:check
```

### 7.4 构建

```bash
npm run build
```

## 八、注意事项

1. **兼容性**：确保新工具链不影响现有功能
2. **渐进式**：分阶段迁移，不一次性改动
3. **测试**：每次配置变更后充分测试
4. **文档**：及时更新文档说明变更

---

**配置完成后，所有代码提交前会自动运行 ESLint 和 Prettier 检查。**

