# 前端开发检查清单

> **每次开发新功能或修改代码时，必须完成以下检查清单。**

## 一、开发前检查

### 1.1 准备工作

- [ ] 阅读 `docs/开发规范.md`
- [ ] 理解功能需求
- [ ] 设计代码结构
- [ ] 准备测试用例

### 1.2 工具类准备

- [ ] 确认已引入 `js/core/error-handler.js`
- [ ] 确认已引入 `js/core/dom-utils.js`
- [ ] 确认已引入 `js/core/validator.js`
- [ ] 确认已引入 `css/common.css`

## 二、代码规范检查

### 2.1 命名规范

- [ ] 文件名使用 kebab-case
- [ ] 类名使用 PascalCase
- [ ] 函数/变量使用 camelCase
- [ ] 常量使用 UPPER_SNAKE_CASE

### 2.2 代码风格

- [ ] 使用 ES6+ 语法
- [ ] 使用 async/await（非 Promise.then）
- [ ] 使用 const/let（非 var）
- [ ] 函数不超过 50 行
- [ ] 文件不超过 300 行

### 2.3 注释

- [ ] 工具类和公共方法有 JSDoc 注释
- [ ] 复杂逻辑有注释说明
- [ ] TODO/FIXME 已标注负责人和日期

## 三、错误处理检查

### 3.1 错误处理实现

- [ ] 所有 API 调用都有 try-catch
- [ ] 使用 `ErrorHandler.showError()` 显示错误
- [ ] 使用 `ErrorHandler.handleApiError()` 处理 API 错误
- [ ] 错误信息用户友好（不暴露技术细节）
- [ ] 控制台记录详细错误（便于调试）

### 3.2 UI 区域显示

- [ ] 错误显示前确保 UI 区域可见（使用 `sectionId` 参数）
- [ ] 关键阶段提前显示 UI 区域（使用 `ErrorHandler.showSection()`）
- [ ] 错误消息容器已添加到 HTML（`<div id="errorMessage"></div>`）

### 3.3 错误处理示例

```javascript
// ✅ 正确示例
try {
    const result = await api.post('/bazi/calculate', data);
    if (!result.success) {
        ErrorHandler.handleApiError(result.error, {
            containerId: 'errorMessage',
            sectionId: 'resultSection'
        });
        return;
    }
} catch (error) {
    ErrorHandler.handleApiError(error, {
        containerId: 'errorMessage',
        sectionId: 'resultSection'
    });
}
```

## 四、DOM 操作检查

### 4.1 DOM 操作实现

- [ ] 使用 `DomUtils` 工具类（非直接操作 DOM）
- [ ] 使用 `DomUtils.setText()` 设置文本（非 innerHTML）
- [ ] 使用 `DomUtils.show()/hide()` 显示/隐藏元素
- [ ] 使用 `DomUtils.setFormValue()/getFormValue()` 操作表单

### 4.2 DOM 操作示例

```javascript
// ✅ 正确示例
DomUtils.setText('result', '内容');
DomUtils.show('result');
DomUtils.setFormValue('inputId', 'value');
const value = DomUtils.getFormValue('inputId');
```

## 五、数据验证检查

### 5.1 数据验证实现

- [ ] 所有用户输入都进行验证
- [ ] 使用 `Validator` 工具类进行验证
- [ ] 验证失败时显示友好错误信息
- [ ] 八字输入使用 `Validator.baziInput()`

### 5.2 数据验证示例

```javascript
// ✅ 正确示例
try {
    Validator.required(solar_date, '出生日期');
    Validator.date(solar_date, '出生日期');
    Validator.required(solar_time, '出生时间');
    Validator.time(solar_time, '出生时间');
    Validator.gender(gender, '性别');
} catch (error) {
    ErrorHandler.showError(error.message);
    return;
}
```

## 六、API 调用检查

### 6.1 API 调用实现

- [ ] 使用统一 `api` 对象（非直接 fetch）
- [ ] 调用前验证参数（使用 `Validator`）
- [ ] 显示加载状态
- [ ] 使用 try-catch 处理错误
- [ ] 响应数据验证
- [ ] 更新 UI 前检查元素存在

### 6.2 API 调用示例

```javascript
// ✅ 正确示例
// 1. 参数验证
try {
    Validator.baziInput(data);
} catch (error) {
    ErrorHandler.showError(error.message);
    return;
}

// 2. 显示加载状态
DomUtils.show('loading');
DomUtils.hide('result');

// 3. 调用 API
try {
    const result = await api.post('/bazi/calculate', data);
    
    // 4. 处理响应
    if (result.success) {
        DomUtils.setText('result', result.data);
        DomUtils.show('result');
    } else {
        ErrorHandler.handleApiError(result.error, {
            containerId: 'errorMessage',
            sectionId: 'resultSection'
        });
    }
} catch (error) {
    ErrorHandler.handleApiError(error, {
        containerId: 'errorMessage',
        sectionId: 'resultSection'
    });
} finally {
    // 5. 隐藏加载状态
    DomUtils.hide('loading');
}
```

## 七、页面结构检查

### 7.1 HTML 结构

- [ ] 错误消息容器存在：`<div id="errorMessage" class="error-message"></div>`
- [ ] 加载状态容器存在（如需要）：`<div id="loading" class="loading"></div>`
- [ ] 结果容器存在（如需要）：`<div id="result"></div>`

### 7.2 脚本引入顺序

- [ ] 配置脚本：`config.js`
- [ ] 核心工具类：`js/core/error-handler.js`, `js/core/dom-utils.js`, `js/core/validator.js`
- [ ] API 客户端：`js/api.js`
- [ ] 业务逻辑（如需要）：`js/auth.js`
- [ ] 页面脚本：内联或外部脚本

### 7.3 样式引入

- [ ] 公共样式：`css/common.css`
- [ ] 页面样式（如需要）：`css/[页面名].css`

## 八、功能测试检查

### 8.1 正常流程测试

- [ ] 功能正常运行
- [ ] 数据正确显示
- [ ] 用户交互正常

### 8.2 异常流程测试

- [ ] 网络错误处理
- [ ] 服务器错误处理
- [ ] 数据验证错误处理
- [ ] 权限错误处理

### 8.3 边界条件测试

- [ ] 空值处理
- [ ] 边界值处理
- [ ] 特殊字符处理

## 九、提交前检查

### 9.1 代码质量

- [ ] 无 console.log（生产代码）
- [ ] 无调试代码（如调试 fetch）
- [ ] 无 TODO/FIXME（或已标注负责人和日期）
- [ ] 代码已格式化
- [ ] 注释完整

### 9.2 功能验证

- [ ] 核心功能手动验证
- [ ] 错误场景测试
- [ ] 跨浏览器测试（Chrome、Firefox、Safari）
- [ ] 响应式布局检查

### 9.3 性能检查

- [ ] 页面加载时间 < 3 秒
- [ ] 首屏渲染时间 < 1.5 秒
- [ ] 无内存泄漏（长时间运行测试）

## 十、发布前检查

### 10.1 最终验证

- [ ] 所有检查清单已完成
- [ ] 功能测试通过
- [ ] 错误处理完善
- [ ] 用户体验良好

### 10.2 文档更新

- [ ] 更新 README（如有新功能）
- [ ] 更新 API 文档（如有新接口）
- [ ] 更新开发规范（如有新规范）

---

**所有检查项完成后，方可提交代码。**

