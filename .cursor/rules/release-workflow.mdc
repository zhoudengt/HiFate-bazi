---
description: 上线流程规范（开发→测试→提交→部署→验证）
alwaysApply: false
globs:
  - deploy/**
  - scripts/deploy/**
  - .github/workflows/**
---

# 上线流程规范

> **完整文档**：`docs/deploy/详细发布流程.md`

## 核心流程（不可跳过任何步骤）

```
本地开发 → 热更新验证 → 功能测试 → Git 提交 → 增量部署 → 生产验证
```

---

## 快速参考

### 1. 本地开发
- 阅读规范：`standards/08_数据编排架构规范.md`、`standards/hot-reload.md`
- 禁止修改底层计算逻辑（`core/calculators/`、`server/engines/`）

### 2. 本地热更新验证
```bash
python3 scripts/ai/auto_hot_reload.py --trigger
python3 scripts/ai/auto_hot_reload.py --verify
```

### 3. 功能测试（必做）
```bash
# 完整回归测试
python3 scripts/evaluation/api_regression_test.py --env production --category basic --category stream --category payment --parallel
```

### 4. Git 提交
```bash
git add <文件>
git commit -m "feat|fix|refactor: <描述>"
git push origin master
```

### 5. 部署（推荐门控发布）
```bash
bash deploy/scripts/gated_deploy.sh
```

### 6. 生产验证（必做）
```bash
curl -s http://8.210.52.217:8001/api/v1/health
python3 scripts/evaluation/api_regression_test.py --env production --category basic --category stream --category payment --parallel
```

---

## 热更新端点选择

| 端点 | 用途 |
|------|------|
| `/hot-reload/reload-all` | **生产部署必须用这个** |
| `/hot-reload/verify` | 部署后功能验证 |
| `/hot-reload/check` | 仅开发调试用 |

---

## 绝对禁止

- ❌ 直接在服务器上改代码
- ❌ 跳过 Git 提交
- ❌ `docker restart` / `docker-compose restart`
- ❌ 使用 `/hot-reload/check` 做生产部署
- ❌ 跳过功能验证
