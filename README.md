# HiFate-bazi å…«å­—ç³»ç»Ÿ

> å®Œæ•´çš„å…«å­—å‘½ç†åˆ†æç³»ç»Ÿï¼ŒåŸºäº 868+ æ¡ä¸“ä¸šè§„åˆ™ï¼Œæ”¯æŒ AI é©±åŠ¨çš„æ™ºèƒ½è¿åŠ¿åˆ†æ

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com/)
[![gRPC](https://img.shields.io/badge/gRPC-1.60+-blue.svg)](https://grpc.io/)
[![License](https://img.shields.io/badge/License-Proprietary-red.svg)](LICENSE)

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

HiFate-bazi æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…«å­—å‘½ç†åˆ†æç³»ç»Ÿï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæä¾›ç®—æ³•å…¬å¼åˆ†æã€è¿åŠ¿é¢„æµ‹ã€æ™ºèƒ½è¿åŠ¿åˆ†æã€é¢ç›¸æ‰‹ç›¸ã€åŠå…¬æ¡Œé£æ°´ç­‰åŠŸèƒ½ã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ”® **ç®—æ³•å…¬å¼åˆ†æ**ï¼šåŸºäº 868+ æ¡è§„åˆ™çš„å…¨é¢å…«å­—åˆ†æï¼ˆè´¢å¯Œã€å©šå§»ã€äº‹ä¸šã€æ€§æ ¼ã€å¥åº·ç­‰ï¼‰
- ğŸ“… **è¿åŠ¿é¢„æµ‹**ï¼šå¤§è¿ã€æµå¹´ã€æœˆè¿ã€æ—¥è¿å…¨æ–¹ä½è¿åŠ¿åˆ†æ
- ğŸ¤– **æ™ºèƒ½è¿åŠ¿åˆ†æ**ï¼šAI é©±åŠ¨çš„æ™ºèƒ½è¿åŠ¿åˆ†æï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æé—®
- ğŸ­ **åç¥å‘½æ ¼**ï¼šåç¥åˆ†æã€å‘½æ ¼åˆ¤æ–­
- ğŸ‘¤ **é¢ç›¸æ‰‹ç›¸**ï¼šåŸºäº AI çš„é¢ç›¸æ‰‹ç›¸åˆ†æ
- ğŸ¢ **åŠå…¬æ¡Œé£æ°´**ï¼šåŸºäº YOLOv8 çš„ç‰©å“æ£€æµ‹å’Œé£æ°´åˆ†æ
- ğŸ’° **æ”¯ä»˜æœåŠ¡**ï¼šé›†æˆ Stripe æ”¯ä»˜
- ğŸ§ª **A/B æµ‹è¯•**ï¼šæ”¯æŒåŠŸèƒ½å¼€å…³å’Œç°åº¦å‘å¸ƒ

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (Frontend)                        â”‚
â”‚              HTML + JavaScript + CSS (é™æ€é¡µé¢)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/gRPC-Web
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»æœåŠ¡ (Web API)                           â”‚
â”‚              FastAPI + Uvicorn (Port 8001)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   API   â”‚ Service â”‚ Engine  â”‚   DB    â”‚  Utils  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ gRPC    â”‚         â”‚         â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¾®æœåŠ¡å±‚ (gRPC Services)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚bazi_core â”‚ â”‚ fortune   â”‚ â”‚ analyzer  â”‚ â”‚  rule    â”‚ ...  â”‚
â”‚  â”‚  (9001)  â”‚ â”‚  (9002)   â”‚ â”‚  (9003)   â”‚ â”‚ (9004)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚fortune_  â”‚ â”‚ payment   â”‚ â”‚  intent  â”‚ â”‚optimizer â”‚ ...  â”‚
â”‚  â”‚analysis  â”‚ â”‚  (9006)   â”‚ â”‚  (9008)   â”‚ â”‚  (9009)   â”‚      â”‚
â”‚  â”‚  (9005)  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨å±‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  MySQL   â”‚ â”‚  Redis    â”‚ â”‚  Models  â”‚                      â”‚
â”‚  â”‚  (13306) â”‚ â”‚ (16379)   â”‚ â”‚  Cache   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡ç«¯å£æ¸…å•

| æœåŠ¡ | ç«¯å£ | åè®® | è¯´æ˜ |
|------|------|------|------|
| **Web API** | 8001 | HTTP/gRPC-Web | ä¸»æœåŠ¡ï¼Œå¯¹å¤–æä¾› API |
| **bazi_core** | 9001 | gRPC | å…«å­—æ ¸å¿ƒè®¡ç®—æœåŠ¡ |
| **bazi_fortune** | 9002 | gRPC | å¤§è¿æµå¹´è®¡ç®—æœåŠ¡ |
| **bazi_analyzer** | 9003 | gRPC | å…«å­—åˆ†ææœåŠ¡ |
| **bazi_rule** | 9004 | gRPC | è§„åˆ™åŒ¹é…æœåŠ¡ |
| **fortune_analysis** | 9005 | gRPC | è¿åŠ¿åˆ†ææœåŠ¡ |
| **payment_service** | 9006 | gRPC | æ”¯ä»˜æœåŠ¡ |
| **fortune_rule** | 9007 | gRPC | è¿åŠ¿è§„åˆ™æœåŠ¡ |
| **intent_service** | 9008 | gRPC | æ„å›¾è¯†åˆ«æœåŠ¡ï¼ˆæ··åˆæ¶æ„ï¼‰ |
| **prompt_optimizer** | 9009 | gRPC | æç¤ºä¼˜åŒ–æœåŠ¡ |
| **desk_fengshui** | 9010 | gRPC | åŠå…¬æ¡Œé£æ°´åˆ†ææœåŠ¡ |
| **MySQL** | 13306 | TCP | æ•°æ®åº“ |
| **Redis** | 16379 | TCP | ç¼“å­˜ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
HiFate-bazi/
â”œâ”€â”€ server/                 # ä¸»æœåŠ¡ï¼ˆHTTP APIï¼‰
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ v1/           # v1 ç‰ˆæœ¬ API
â”‚   â”‚   â”‚   â”œâ”€â”€ smart_fortune.py    # æ™ºèƒ½è¿åŠ¿åˆ†æ API
â”‚   â”‚   â”‚   â”œâ”€â”€ formula_analysis.py # ç®—æ³•å…¬å¼åˆ†æ API
â”‚   â”‚   â”‚   â””â”€â”€ ...                # å…¶ä»– API
â”‚   â”‚   â””â”€â”€ grpc_gateway.py        # gRPC-Web ç½‘å…³
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ engines/           # è§„åˆ™å¼•æ“
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ ab_test.py            # A/B æµ‹è¯•å·¥å…·
â”‚   â”‚   â”œâ”€â”€ feature_flag.py       # åŠŸèƒ½å¼€å…³å·¥å…·
â”‚   â”‚   â””â”€â”€ performance_monitor.py # æ€§èƒ½ç›‘æ§å·¥å…·
â”‚   â”œâ”€â”€ config/            # æœåŠ¡é…ç½®
â”‚   â””â”€â”€ db/                # æ•°æ®åº“è¿æ¥
â”‚
â”œâ”€â”€ services/               # å¾®æœåŠ¡ï¼ˆgRPCï¼‰
â”‚   â”œâ”€â”€ bazi_core/        # å…«å­—æ ¸å¿ƒè®¡ç®—
â”‚   â”œâ”€â”€ bazi_fortune/     # è¿åŠ¿è®¡ç®—
â”‚   â”œâ”€â”€ bazi_analyzer/    # å…«å­—åˆ†æ
â”‚   â”œâ”€â”€ bazi_rule/        # è§„åˆ™å¼•æ“
â”‚   â”œâ”€â”€ fortune_analysis/ # è¿åŠ¿åˆ†æ
â”‚   â”œâ”€â”€ payment_service/  # æ”¯ä»˜æœåŠ¡
â”‚   â”œâ”€â”€ intent_service/   # æ„å›¾è¯†åˆ«ï¼ˆæ··åˆæ¶æ„ï¼‰
â”‚   â”‚   â”œâ”€â”€ classifier.py         # æ··åˆåˆ†ç±»å™¨
â”‚   â”‚   â”œâ”€â”€ local_classifier.py   # æœ¬åœ° BERT æ¨¡å‹
â”‚   â”‚   â””â”€â”€ rule_postprocessor.py # è§„åˆ™åå¤„ç†
â”‚   â”œâ”€â”€ prompt_optimizer/ # æç¤ºä¼˜åŒ–
â”‚   â””â”€â”€ desk_fengshui/    # åŠå…¬æ¡Œé£æ°´ï¼ˆYOLOv8ï¼‰
â”‚
â”œâ”€â”€ src/                   # æ ¸å¿ƒè®¡ç®—åº“
â”‚   â”œâ”€â”€ bazi_calculator.py # å…«å­—è®¡ç®—æ ¸å¿ƒ
â”‚   â”œâ”€â”€ bazi_config/       # å…«å­—é…ç½®æ•°æ®
â”‚   â”œâ”€â”€ analyzers/         # åˆ†æå™¨
â”‚   â””â”€â”€ clients/           # å¾®æœåŠ¡å®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ frontend/              # å‰ç«¯é¡µé¢
â”‚   â”œâ”€â”€ index.html                    # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ formula-analysis.html         # ç®—æ³•å…¬å¼åˆ†æ
â”‚   â”œâ”€â”€ smart-fortune.html            # æ™ºèƒ½è¿åŠ¿åˆ†æ
â”‚   â”œâ”€â”€ smart-fortune-stream.html     # æ™ºèƒ½è¿åŠ¿åˆ†æï¼ˆæµå¼ç‰ˆï¼‰
â”‚   â”œâ”€â”€ fortune.html                  # è¿åŠ¿åˆ†æ
â”‚   â”œâ”€â”€ desk-fengshui.html           # åŠå…¬æ¡Œé£æ°´
â”‚   â”œâ”€â”€ face-analysis-v2.html        # é¢ç›¸åˆ†æ
â”‚   â””â”€â”€ ...                          # å…¶ä»–é¡µé¢
â”‚
â”œâ”€â”€ proto/                 # gRPC åè®®å®šä¹‰
â”‚   â”œâ”€â”€ *.proto            # åè®®æ–‡ä»¶
â”‚   â””â”€â”€ generated/         # ç”Ÿæˆçš„ Python ä»£ç 
â”‚
â”œâ”€â”€ scripts/                # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ services/          # æœåŠ¡ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ migration/         # æ•°æ®è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ deployment/        # éƒ¨ç½²è„šæœ¬ï¼ˆç°åº¦å‘å¸ƒã€å›æ»šï¼‰
â”‚   â”œâ”€â”€ tests/             # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ tools/             # å·¥å…·è„šæœ¬
â”‚
â”œâ”€â”€ standards/              # è§„èŒƒæ–‡æ¡£ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
â”œâ”€â”€ deploy/docs/            # éƒ¨ç½²æ–‡æ¡£
â”‚
â”œâ”€â”€ tests/                  # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ unit/              # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/       # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ api/               # API æµ‹è¯•
â”‚
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ services.env       # æœåŠ¡é…ç½®
â”‚
â”œâ”€â”€ start.sh               # å¿«æ·å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop.sh                # å¿«æ·åœæ­¢è„šæœ¬
â”œâ”€â”€ deploy.sh              # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”œâ”€â”€ Dockerfile             # Docker æ„å»º
â””â”€â”€ docker-compose.yml     # Docker ç¼–æ’
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.11+
- **MySQL**: 8.0+ (ç«¯å£ 13306)
- **Redis**: 7.0+ (ç«¯å£ 16379)
- **æ“ä½œç³»ç»Ÿ**: macOS / Linux / Windows

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://gitee.com/zhoudengtang/hifate-prod.git
cd HiFate-bazi

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv .venv
source .venv/bin/activate  # macOS/Linux
# æˆ–
.venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `env.template` å¹¶é…ç½®ï¼š

```bash
cp env.template .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“ã€Redisã€AI æœåŠ¡ç­‰ï¼š

```bash
# æ•°æ®åº“é…ç½®
MYSQL_HOST=localhost
MYSQL_PORT=13306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=hifate_bazi

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=16379

# Coze AI é…ç½®ï¼ˆæ™ºèƒ½è¿åŠ¿åˆ†æï¼‰
COZE_ACCESS_TOKEN=your_token
COZE_BOT_ID=your_bot_id
```

### å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
./start.sh

# æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨
python3 server/start.py

# åœæ­¢æœåŠ¡
./stop.sh
```

### è®¿é—®é¡µé¢

| åŠŸèƒ½ | åœ°å€ |
|------|------|
| é¦–é¡µ | http://localhost:8001/frontend/index.html |
| ç®—æ³•å…¬å¼åˆ†æ | http://localhost:8001/frontend/formula-analysis.html |
| æ™ºèƒ½è¿åŠ¿åˆ†æ | http://localhost:8001/frontend/smart-fortune-stream.html |
| è¿åŠ¿åˆ†æ | http://localhost:8001/frontend/fortune.html |
| æœˆè¿æŸ¥è¯¢ | http://localhost:8001/frontend/bazi-monthly-fortune.html |
| æ—¥è¿æŸ¥è¯¢ | http://localhost:8001/frontend/bazi-daily-fortune.html |
| åŠå…¬æ¡Œé£æ°´ | http://localhost:8001/frontend/desk-fengshui.html |
| é¢ç›¸åˆ†æ | http://localhost:8001/frontend/face-analysis-v2.html |

---

## ğŸ³ Docker éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ

```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
./deploy.sh
# é€‰æ‹© 1) å®Œæ•´éƒ¨ç½²

# æˆ–æ‰‹åŠ¨éƒ¨ç½²
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

### Docker åŸºç¡€é•œåƒä¼˜åŒ–

é¡¹ç›®æ”¯æŒ Docker åŸºç¡€é•œåƒä¼˜åŒ–ï¼Œå¤§å¹…åŠ é€Ÿéƒ¨ç½²ï¼š

```bash
# é¦–æ¬¡æ„å»ºåŸºç¡€é•œåƒï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
./scripts/docker/build_base.sh

# æ£€æŸ¥åŸºç¡€é•œåƒçŠ¶æ€
./scripts/docker/check_base.sh

# æ­£å¸¸éƒ¨ç½²ï¼ˆå¿«é€Ÿï¼Œ10-20ç§’ï¼‰
docker compose up -d --build web
```

è¯¦è§ï¼š[deploy/docs/](deploy/docs/)ï¼ˆ03-é¦–æ¬¡éƒ¨ç½²ã€04-æ—¥å¸¸è¿ç»´ï¼‰

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. ç®—æ³•å…¬å¼åˆ†æ

åŸºäº 868+ æ¡ä¸“ä¸šè§„åˆ™çš„å…¨é¢å…«å­—åˆ†æï¼Œæ”¯æŒï¼š

- ğŸ’° **è´¢å¯Œåˆ†æ**ï¼šè´¢è¿ã€æŠ•èµ„ã€æ”¶å…¥é¢„æµ‹
- ğŸ’‘ **å©šé…åˆ†æ**ï¼šå©šå§»é…å¯¹ã€æ„Ÿæƒ…è¿åŠ¿
- ğŸ­ **æ€§æ ¼åˆ†æ**ï¼šæ€§æ ¼ç‰¹ç‚¹ã€å‘½æ ¼åˆ†æ
- ğŸ¥ **èº«ä½“åˆ†æ**ï¼šå¥åº·çŠ¶å†µã€ä½“è´¨ç‰¹å¾
- ğŸ“œ **æ€»è¯„åˆ†æ**ï¼šç»¼åˆå‘½ç†è¯„ä»·

**API**: `POST /api/v1/bazi/formula-analysis`

### 2. æ™ºèƒ½è¿åŠ¿åˆ†æ

AI é©±åŠ¨çš„æ™ºèƒ½è¿åŠ¿åˆ†æï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æé—®ï¼š

- ğŸ¤– **æ„å›¾è¯†åˆ«**ï¼šæ··åˆæ¶æ„ï¼ˆå…³é”®è¯è¿‡æ»¤ + æœ¬åœ° BERT æ¨¡å‹ + LLM å…œåº•ï¼‰
- ğŸ“Š **è§„åˆ™åŒ¹é…**ï¼šè‡ªåŠ¨åŒ¹é…ç›¸å…³è§„åˆ™ç±»å‹
- ğŸ”® **LLM æ·±åº¦è§£è¯»**ï¼šåŸºäº Coze AI çš„æ·±åº¦åˆ†æ
- ğŸ“ˆ **æ€§èƒ½ç›‘æ§**ï¼šç«¯åˆ°ç«¯æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- âš¡ **æµå¼è¾“å‡º**ï¼šæ”¯æŒæµå¼å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**API**: `GET /api/v1/smart-fortune/smart-analyze-stream`

**å“åº”æ—¶é—´**: å¹³å‡ < 100msï¼ˆä¸åŒ…å« LLM åˆ†æï¼‰

### 3. æ„å›¾è¯†åˆ«æ··åˆæ¶æ„

é«˜æ€§èƒ½æ„å›¾è¯†åˆ«ç³»ç»Ÿï¼Œå“åº”æ—¶é—´ < 1ç§’ï¼š

- **ç¬¬1å±‚**ï¼šå…³é”®è¯è¿‡æ»¤ï¼ˆ0msï¼Œå¤„ç† 60% çš„æ˜ç¡®é—®é¢˜ï¼‰
- **ç¬¬2å±‚**ï¼šæœ¬åœ° BERT æ¨¡å‹ï¼ˆ50-100msï¼Œå¤„ç† 20% çš„ç®€å•é—®é¢˜ï¼‰
- **ç¬¬3å±‚**ï¼šè§„åˆ™åå¤„ç†ï¼ˆ10-20msï¼Œæ—¶é—´æ„å›¾è§£æï¼‰
- **ç¬¬4å±‚**ï¼šLLM å…œåº•ï¼ˆ500-1000msï¼Œä»…å¤„ç† 5% çš„æ¨¡ç³Šé—®é¢˜ï¼‰

**å¹³å‡å“åº”æ—¶é—´**: < 100ms

### 4. åŠå…¬æ¡Œé£æ°´åˆ†æ

åŸºäº YOLOv8 çš„ç‰©å“æ£€æµ‹å’Œä¼ ç»Ÿé£æ°´è§„åˆ™ï¼š

- ğŸ“¸ **ç‰©å“æ£€æµ‹**ï¼šYOLOv8 è‡ªåŠ¨è¯†åˆ«åŠå…¬æ¡Œç‰©å“
- ğŸ§­ **æ–¹ä½è®¡ç®—**ï¼šé’é¾™ä½ã€ç™½è™ä½ã€æœ±é›€ä½ã€ç„æ­¦ä½
- ğŸ”® **é£æ°´åˆ†æ**ï¼šç»“åˆå…«å­—å–œç”¨ç¥ã€å¿Œç¥è¿›è¡Œä¸ªæ€§åŒ–åˆ†æ
- ğŸ“Š **è§„åˆ™åŒ¹é…**ï¼šåŸºäºæ•°æ®åº“çš„é£æ°´è§„åˆ™åŒ¹é…

**æŠ€æœ¯æ ˆ**: YOLOv8 (ultralytics>=8.0.0)

---

## ğŸ§ª A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒ

é¡¹ç›®æ”¯æŒå®Œæ•´çš„ A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒåŠŸèƒ½ï¼š

### åŠŸèƒ½å¼€å…³

```python
from server.utils.feature_flag import get_feature_flag_manager

manager = get_feature_flag_manager()
if manager.is_enabled("æ–°åŠŸèƒ½", user_id=user_id):
    # ä½¿ç”¨æ–°åŠŸèƒ½
    result = new_feature.process()
else:
    # ä½¿ç”¨æ—§åŠŸèƒ½
    result = old_feature.process()
```

### A/B æµ‹è¯•

```python
from server.utils.ab_test import get_ab_test_manager

manager = get_ab_test_manager()
variant = manager.assign_variant("æ–°ç®—æ³•æµ‹è¯•", user_id=user_id)
if variant == "A":
    result = old_algorithm.calculate()
else:
    result = new_algorithm.calculate()
```

è¯¦è§ï¼š[standards/deployment.md](standards/deployment.md)ï¼ˆA/B æµ‹è¯•ã€ç°åº¦å‘å¸ƒï¼‰

---

## ğŸ“– æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [å¼€å‘è§„èŒƒ](.cursorrules) | å®Œæ•´çš„å¼€å‘è§„èŒƒå’Œä»£ç æ ‡å‡† |
| [è§„èŒƒæ–‡æ¡£ç»Ÿä¸€å…¥å£](standards/README.md) | æ¶æ„ã€å‘½åã€æµ‹è¯•ã€éƒ¨ç½²ç­‰è§„èŒƒ |
| [éƒ¨ç½²æ–‡æ¡£](deploy/docs/) | 01-æ¶æ„è¯´æ˜ã€02-ECSåˆå§‹åŒ–ã€03-é¦–æ¬¡éƒ¨ç½²ã€04-æ—¥å¸¸è¿ç»´ã€05-æ•…éšœå¤„ç† |
| [éƒ¨ç½²è§„èŒƒ](standards/deployment.md) | å¢é‡éƒ¨ç½²ã€ç°åº¦å‘å¸ƒã€A/B æµ‹è¯• |

---

## ğŸ”§ å¼€å‘è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™

1. **ğŸ”´ é›¶åœæœºåŸåˆ™**ï¼šæ‰€æœ‰è®¾è®¡å¿…é¡»æ”¯æŒä¸åœæœºæ›´æ–°
2. **ğŸ”Œ gRPC ä¼˜å…ˆ**ï¼šæœåŠ¡é—´äº¤äº’å¿…é¡»ä½¿ç”¨ gRPC
3. **ğŸ“œ è§„åˆ™æ•°æ®åº“åŒ–**ï¼šè§„åˆ™å­˜æ•°æ®åº“ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼Œç¦æ­¢ä»æ–‡ä»¶è¯»å–
4. **ğŸ”„ å‘åå…¼å®¹**ï¼šåªåŠ ä¸åˆ ï¼Œä¿æŒå…¼å®¹
5. **âœ… å…ˆæµ‹è¯•åæäº¤**ï¼šä¿®æ”¹åç«‹å³æµ‹è¯•
6. **ğŸ” å®‰å…¨ä¼˜å…ˆ**ï¼šéµå¾ªå®‰å…¨æœ€ä½³å®è·µ
7. **ğŸ§ª A/B æµ‹è¯•ä¼˜å…ˆ**ï¼šæ–°åŠŸèƒ½å¿…é¡»æ”¯æŒ A/B æµ‹è¯•å’Œç°åº¦å‘å¸ƒ

è¯¦è§ï¼š[.cursorrules](.cursorrules)

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯

- **Web æ¡†æ¶**: FastAPI + Uvicorn
- **RPC æ¡†æ¶**: gRPC + Protobuf
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: Redis 7.0
- **AI æ¨¡å‹**: 
  - Coze AI (æ™ºèƒ½è¿åŠ¿åˆ†æ)
  - BERT/RoBERTa (æ„å›¾è¯†åˆ«)
  - YOLOv8 (ç‰©å“æ£€æµ‹)

### å‰ç«¯

- **æŠ€æœ¯**: HTML5 + JavaScript (ES6+) + CSS3
- **é€šä¿¡**: gRPC-Web + REST API
- **UI æ¡†æ¶**: åŸç”Ÿ JavaScriptï¼ˆæ— æ¡†æ¶ä¾èµ–ï¼‰

### éƒ¨ç½²

- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **åŸºç¡€é•œåƒä¼˜åŒ–**: æ”¯æŒé¢„æ„å»ºåŸºç¡€é•œåƒï¼ŒåŠ é€Ÿéƒ¨ç½²
- **éƒ¨ç½²è„šæœ¬**: ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆ`deploy.sh`ï¼‰

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ„å›¾è¯†åˆ«æ€§èƒ½

| åœºæ™¯ | å æ¯” | å“åº”æ—¶é—´ | å‡†ç¡®ç‡ |
|------|------|---------|--------|
| å…³é”®è¯æ˜ç¡® | 60% | <10ms | 95%+ |
| ç®€å•é—®é¢˜ | 20% | 50-100ms | 85-90% |
| å¤æ‚é—®é¢˜ | 15% | 100-200ms | 80-85% |
| æ¨¡ç³Šé—®é¢˜ | 5% | 500-1000ms | 90%+ |

**å¹³å‡å“åº”æ—¶é—´**: < 100ms

### æ™ºèƒ½è¿åŠ¿åˆ†ææ€§èƒ½

| é˜¶æ®µ | ç›®æ ‡è€—æ—¶ | è¯´æ˜ |
|------|---------|------|
| æ„å›¾è¯†åˆ« | < 100ms | æ··åˆæ¶æ„ |
| å…«å­—è®¡ç®— | < 50ms | æœ¬åœ°è®¡ç®— |
| è§„åˆ™åŒ¹é… | < 200ms | æ•°æ®åº“æŸ¥è¯¢ |
| LLM æ·±åº¦è§£è¯» | < 2000ms | å¯é€‰åŠŸèƒ½ |

**æ€»è€—æ—¶ç›®æ ‡**ï¼š
- ä¸åŒ…å«æµå¹´å¤§è¿å’Œ LLMï¼š< 500ms
- åŒ…å«æµå¹´å¤§è¿ï¼š< 2000ms
- åŒ…å«æµå¹´å¤§è¿å’Œ LLMï¼š< 5000ms

---

## ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§

### Gitee ä»“åº“

- **ä»“åº“åœ°å€**: https://gitee.com/zhoudengtang/hifate-prod.git
- **é»˜è®¤åˆ†æ”¯**: master

### ä¸€é”®éƒ¨ç½²

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh

# é€‰æ‹©æ“ä½œï¼š
# 1) å®Œæ•´éƒ¨ç½²ï¼ˆæ¨èï¼‰
# 2) ä»…æ¨é€åˆ° Gitee
# 3) ä»…æ›´æ–°æœåŠ¡å™¨
# ...
```

### ç”Ÿäº§æœåŠ¡å™¨

- **æœåŠ¡å™¨**: 123.57.216.15 (é˜¿é‡Œäº‘ ECS)
- **éƒ¨ç½²è·¯å¾„**: /opt/HiFate-bazi

è¯¦è§ï¼š[deploy/docs/](deploy/docs/)ï¼ˆ03-é¦–æ¬¡éƒ¨ç½²ã€04-æ—¥å¸¸è¿ç»´ï¼‰

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/unit/

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration/

# è¿è¡Œ API æµ‹è¯•
pytest tests/api/
```

### æµ‹è¯•è„šæœ¬

```bash
# ç«¯åˆ°ç«¯æµ‹è¯•
./scripts/tests/test_e2e_all_functions.sh

# æ¶æ„æ”¹è¿›æµ‹è¯•
./scripts/tests/test_architecture_improvements.py
```

---

## ğŸ“ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m '[æ–°å¢] æ·»åŠ æ–°åŠŸèƒ½'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push gitee feature/AmazingFeature`)
5. åˆ›å»º Pull Request

### æäº¤è§„èŒƒ

```
[ç±»å‹] ç®€çŸ­æè¿°

- ä¿®æ”¹æ–‡ä»¶ï¼šåˆ—å‡ºæ–‡ä»¶
- åŠŸèƒ½è¯´æ˜ï¼šè¯¦ç»†è¯´æ˜
- æµ‹è¯•æƒ…å†µï¼šæµ‹è¯•ç»“æœ
```

**ç±»å‹æ ‡ç­¾**ï¼š
- `[æ–°å¢]` - æ–°åŠŸèƒ½
- `[ä¿®å¤]` - Bug ä¿®å¤
- `[ä¼˜åŒ–]` - æ€§èƒ½ä¼˜åŒ–
- `[é‡æ„]` - ä»£ç é‡æ„
- `[è§„åˆ™]` - è§„åˆ™ç›¸å…³å˜æ›´
- `[é…ç½®]` - é…ç½®ä¿®æ”¹

---

## ğŸ“„ è®¸å¯è¯

Copyright Â© 2025 HiFate. All rights reserved.

---

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£ã€å¿«é€Ÿçš„ Web æ¡†æ¶
- [gRPC](https://grpc.io/) - é«˜æ€§èƒ½ RPC æ¡†æ¶
- [Coze AI](https://www.coze.cn/) - AI èƒ½åŠ›æ”¯æŒ
- [YOLOv8](https://github.com/ultralytics/ultralytics) - ç‰©å“æ£€æµ‹æ¨¡å‹

---

**Built with â¤ï¸ by HiFate Team**
