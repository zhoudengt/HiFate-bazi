# HiFate-bazi å…«å­—ç³»ç»Ÿ - AI å¼€å‘è§„èŒƒï¼ˆç²¾ç®€ç‰ˆï¼‰

> **å®Œæ•´è§„èŒƒ**ï¼š`standards/README.md` | **éƒ¨ç½²æŒ‡å—**ï¼š`standards/deployment.md`ã€`deploy/docs/`

---

## ğŸ”” MCP äº¤äº’è¦æ±‚

**é‡è¦æ“ä½œå‰å¿…é¡»å¾æ±‚ç”¨æˆ·æ„è§**ï¼š
- æ‰§è¡Œéƒ¨ç½²å‘½ä»¤å‰ï¼ˆé™¤éç”¨æˆ·æ˜ç¡®è¯´"èŠéº»å¼€é—¨"ï¼‰
- ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶å‰ï¼ˆ`grpc_gateway.py`ã€`bazi_calculator.py` ç­‰ï¼‰
- åˆ é™¤æ–‡ä»¶å‰
- æ‰§è¡Œä¸å¯é€†æ“ä½œå‰

**æ“ä½œå®Œæˆåå¿…é¡»å‘ŠçŸ¥ç”¨æˆ·**ï¼š
- æä¾›å¯é€‰çš„åç»­æ“ä½œå»ºè®®
- è¯´æ˜å·²å®Œæˆçš„å·¥ä½œå’Œå½±å“èŒƒå›´

---

## é¡¹ç›®ä¸Šä¸‹æ–‡

- **è§„èŒƒå…¥å£**ï¼š`standards/README.md`
- **éƒ¨ç½²**ï¼š`standards/deployment.md`ã€`deploy/docs/03-é¦–æ¬¡éƒ¨ç½².md`
- **å¼€å‘æµç¨‹**ï¼šéƒ¨ç½²ç”¨ `@deploy.mdc`ï¼›æäº¤å‰ç”¨ `@dev-checklist.mdc`

---

## å¼€å‘è§’è‰²

é«˜çº§èµ„æ·±å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆã€‚å·¥ä½œåŸåˆ™ï¼šæ€§èƒ½ä¼˜å…ˆã€å¯è§‚æµ‹æ€§ã€é˜²å¾¡æ€§ç¼–ç¨‹ã€æ¶æ„æ€ç»´ã€‚

---

## æ ¸å¿ƒåŸåˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

### 0. ä»£ç ä¿®æ”¹æµç¨‹
> æœ¬åœ°å¼€å‘ â†’ Gitæäº¤ â†’ **é—¨æ§å‘å¸ƒ**ï¼ˆNode2 å‰å“¨éªŒè¯ â†’ Node1 ç”Ÿäº§éƒ¨ç½²ï¼‰ã€‚ç¦æ­¢ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ä»£ç ã€‚
> å‘å¸ƒå‘½ä»¤ï¼š`bash deploy/scripts/gated_deploy.sh`ï¼Œè¯¦è§ `@deploy.mdc`ã€‚
> Phase 2 åˆå§‹åŒ–ï¼š`bash deploy/scripts/init_staging.sh`ï¼ˆä¸€æ¬¡æ€§ï¼Œé›¶åœæœºï¼‰ã€‚

### 0.1 é›¶åœæœºåŸåˆ™
> ä½¿ç”¨çƒ­æ›´æ–°ï¼Œç¦æ­¢é‡å¯æœåŠ¡ã€‚

### 0.1.1 æ•°æ®ç¼–æ’
> æ•°æ®åªè®¡ç®—ä¸€æ¬¡ï¼Œæ‰€æœ‰æ¥å£ä» `BaziDataOrchestrator.fetch_data()` ç»Ÿä¸€è·å–ã€‚ç¦æ­¢æµå¼æ¥å£ç›´æ¥è°ƒåº•å±‚æœåŠ¡ã€ç¦æ­¢ç»•è¿‡ç¼–æ’å™¨ã€‚è¯¦è§ `@orchestrator-rules.mdc` æˆ– `standards/08_æ•°æ®ç¼–æ’æ¶æ„è§„èŒƒ.md`ã€‚

### 0.1.1.1 ç¼“å­˜
> ç¼“å­˜å‘½ä¸­ç‡ â‰¥ 98%ï¼Œkey ç¦æ­¢é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼ˆæœ€å¤šåˆ°å°æ—¶ï¼‰ã€‚è¯¦è§ `@cache-rules.mdc`ã€‚

### 0.1.2 åº•å±‚ä¿æŠ¤
> `core/`ã€`server/engines/`ã€`server/services/` æ ¸å¿ƒé€»è¾‘ç¦æ­¢ä¿®æ”¹ã€‚å¿…é¡»æ”¹æ—¶å…ˆå‘ŠçŸ¥ç”¨æˆ·ã€‚

### 0.2 çƒ­æ›´æ–°
> æ‰€æœ‰æ›´æ–°å¿…é¡»çƒ­æ›´æ–°ã€‚ç¦æ­¢ `docker restart`ã€‚è¯¦è§ `standards/hot-reload.md`ã€‚

---

## å¼€å‘åŸåˆ™ï¼ˆæ‘˜è¦ï¼‰

1. è§„èŒƒä¼˜å…ˆã€å®‰å…¨ä¼˜å…ˆã€é›¶åœæœºä¼˜å…ˆ
2. gRPC ä¼˜å…ˆï¼ˆ`standards/grpc-protocol.md`ï¼‰
3. è§„åˆ™æ•°æ®åº“åŒ–ï¼ˆ`standards/rule-development.md`ï¼‰
4. å‘åå…¼å®¹ã€å…ˆæµ‹è¯•åæäº¤
5. **æ–‡ä»¶æ‹†åˆ†ç”¨ shell å‘½ä»¤**ï¼ˆ`cp`/`sed`/`head`/`tail` æ¬ä»£ç ï¼Œä¸é€å­—é‡å†™ã€‚å‡å°‘ token æ¶ˆè€—å’Œå‡ºé”™æ¦‚ç‡ï¼‰

---

## gRPC ä¸ API

- å‰ç«¯èµ° gRPC-Webï¼ˆ`/api/v1/*`ï¼‰
- æ–°å¢ç«¯ç‚¹å¿…é¡»åœ¨ `grpc_gateway.py` æ³¨å†Œ
- ä¿®æ”¹ `grpc_gateway.py` æˆ– `proto/` æ—¶ç”¨ `@grpc-rules.mdc`

---

## é¡¹ç›®æ¶æ„

- **server/**ï¼šWeb æœåŠ¡ (8001)ï¼Œ`grpc_gateway.py` ä¸ºæ ¸å¿ƒ
- **services/**ï¼šå¾®æœåŠ¡ bazi_core(9001)ã€bazi_fortune(9002)ã€bazi_analyzer(9003) ç­‰
- **local_frontend/**ï¼šæœ¬åœ°å‰ç«¯ï¼›ç”Ÿäº§å‰ç«¯ç”±å‰ç«¯å›¢é˜Ÿéƒ¨ç½²

---

## æ ¸å¿ƒæ–‡ä»¶ï¼ˆä¿®æ”¹å‰å¿…é¡»å’¨è¯¢ï¼‰

| æ–‡ä»¶ | é£é™© |
|------|------|
| `server/api/grpc_gateway.py` | æé«˜ |
| `server/engines/rule_condition.py` | é«˜ |
| `core/calculators/bazi_calculator.py` | æé«˜ |
| `proto/*.proto` | é«˜ |

---

## ä¸‹çº¿ä»£ç ç®¡ç†

> åŠŸèƒ½ä¸‹çº¿æˆ–æ›¿æ¢æ—¶ï¼Œæ—§ä»£ç å¿…é¡»åŠæ—¶æ ‡è®°å¹¶æ¸…ç†ï¼Œç¦æ­¢ç•™"åƒµå°¸ä»£ç "è¢«çƒ­æ›´æ–°æ‰«æåŠ è½½ã€‚

1. **æ ‡è®°**ï¼šåœ¨æ–‡ä»¶é¡¶éƒ¨å’Œç±»/å‡½æ•°ä¸Šæ–¹åŠ  `# [DEPRECATED] å·²è¢« xxx æ›¿ä»£ï¼Œå¾…åˆ é™¤` æ³¨é‡Š
2. **å»æ³¨å†Œ**ï¼šç§»é™¤æ—§ä»£ç çš„è£…é¥°å™¨æ³¨å†Œï¼ˆå¦‚ `@register_payment_client`ã€`@_register`ï¼‰ï¼Œé˜²æ­¢çƒ­æ›´æ–° reload æ—¶é‡æ–°æ¿€æ´»
3. **åˆ é™¤**ï¼šç¡®è®¤æ— å¼•ç”¨åï¼Œä¸‹ä¸€ä¸ªç‰ˆæœ¬ç›´æ¥åˆ é™¤æ–‡ä»¶ï¼Œä¸è¦é•¿æœŸä¿ç•™åºŸå¼ƒæ–‡ä»¶
4. **æ£€æŸ¥**ï¼šæäº¤å‰æœç´¢é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨åŒåæ³¨å†Œï¼ˆåŒä¸€ä¸ª key è¢«å¤šä¸ªæ–‡ä»¶æ³¨å†Œï¼‰ï¼Œæœ‰å†²çªå¿…é¡»è§£å†³

---

## ç¦æ­¢æ“ä½œ

- âŒ æœåŠ¡å™¨ä¸Šç›´æ¥æ”¹ä»£ç 
- âŒ è·³è¿‡ Git ç›´æ¥éƒ¨ç½²
- âŒ `docker restart` / `systemctl restart`
- âŒ ç¡¬ç¼–ç æœ¬åœ°è·¯å¾„
- âŒ ä»æ–‡ä»¶è¯»å–è§„åˆ™ï¼ˆå¿…é¡»ä»æ•°æ®åº“ï¼‰
- âŒ ä¸‹çº¿åŠŸèƒ½åªæ ‡ deprecated ä¸å»æ³¨å†Œï¼ˆä¼šè¢«çƒ­æ›´æ–°é‡æ–°åŠ è½½ï¼‰

---

## ç”¨æˆ·æ„å›¾è§¦å‘å™¨

> ç”¨æˆ·è¯´ä»¥ä¸‹å…³é”®è¯æ—¶ï¼Œ**ç›´æ¥æ‰§è¡Œ**å¯¹åº”å‘½ä»¤ï¼Œæ— éœ€å†ç¡®è®¤ï¼ˆé™¤éæœ‰æœªæäº¤ä»£ç ç­‰é˜»ç¢ï¼‰ã€‚

| ç”¨æˆ·è¯´ | æ‰§è¡Œ |
|--------|------|
| **èŠéº»å¼€é—¨** | `bash deploy/scripts/gated_deploy.sh` |
| èŠéº»å¼€é—¨ dry-run | `bash deploy/scripts/gated_deploy.sh --dry-run` |
| èŠéº»å¼€é—¨ ç´§æ€¥ | `bash deploy/scripts/gated_deploy.sh --skip-node2` |
| èŠéº»å¼€é—¨ å›æ»š | `bash deploy/scripts/gated_deploy.sh --rollback` |
| **æµ‹è¯•** | `python3 scripts/evaluation/api_regression_test.py --env production --category basic --category stream --category payment --parallel` |
| æœ¬åœ°æµ‹è¯• | åŒä¸Šï¼Œ`--env local` |
| çƒ­æ›´æ–° | `python3 scripts/ai/auto_hot_reload.py --trigger` |
| éªŒè¯çƒ­æ›´æ–° | `python3 scripts/ai/auto_hot_reload.py --verify` |
| æäº¤å‰æ£€æŸ¥ | åŠ è½½ `@dev-checklist.mdc` |

---

## æ¡ä»¶è§„åˆ™å¼•ç”¨

| åœºæ™¯ | å¼•ç”¨ |
|------|------|
| éƒ¨ç½²/é—¨æ§å‘å¸ƒ | `@deploy.mdc` |
| æäº¤å‰æ£€æŸ¥ | `@dev-checklist.mdc` |
| ä¿®æ”¹ç¼“å­˜ | `@cache-rules.mdc` |
| ä¿®æ”¹ gRPC/API | `@grpc-rules.mdc` |
| ä¿®æ”¹ç¼–æ’å™¨ | `@orchestrator-rules.mdc` |
| API/æµ‹è¯• | `@frontend-test-and-backend-only.mdc` |

---

**å®Œæ•´è§„èŒƒ**ï¼š`standards/`ã€`.cursorrules.backup`
