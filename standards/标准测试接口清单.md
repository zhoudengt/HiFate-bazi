# 标准测试接口清单

> **说明**：每次提到「测试」时，都运行以下所有接口的回归测试。  
> **测试命令**：`python3 scripts/evaluation/api_regression_test.py --env production --category basic --category stream --category payment --parallel`

---

## 测试环境

| 环境 | 地址 |
|------|------|
| 本地开发 | `http://localhost:8001` |
| 生产环境 | `http://8.210.52.217:8001` |
| 节点2 | `http://47.243.160.43:8001` |

## 通用测试数据

```json
{
  "bazi_1990": {"solar_date": "1990-01-15", "solar_time": "12:00", "gender": "male"},
  "bazi_1992": {"solar_date": "1992-01-15", "solar_time": "12:00", "gender": "male"},
  "bazi_1995": {"solar_date": "1995-01-15", "solar_time": "12:00", "gender": "male"},
  "daily_fortune": {"date": "2025-01-27", "solar_date": "1992-01-15", "solar_time": "12:00", "gender": "male"}
}
```

---

## 一、基础接口（Basic）- 5 个

| 序号 | 接口名称 | 方法 | 路径 | 超时 | 说明 |
|------|---------|------|------|------|------|
| 1 | 基本信息 | POST | `/api/v1/bazi/interface` | 30s | 八字基本信息接口 |
| 2 | 基本排盘 | POST | `/api/v1/bazi/pan/display` | 30s | 基本排盘显示 |
| 3 | 专业排盘-大运流年流月 | POST | `/api/v1/bazi/fortune/display` | 30s | 专业排盘-大运流年流月 |
| 4 | 身宫命宫胎元 | POST | `/api/v1/bazi/shengong-minggong` | 30s | 专业排盘-身宫命宫胎元 |
| 5 | 日元六十甲子 | POST | `/api/v1/bazi/rizhu-liujiazi` | 30s | 八字命理-日元-六十甲子 |

---

## 二、流式接口（Stream）- 13 个

| 序号 | 接口名称 | 方法 | 路径 | 超时 | 说明 |
|------|---------|------|------|------|------|
| 1 | 每日运势日历(流式) | POST | `/api/v1/daily-fortune-calendar/stream` | 100s | 每日运势日历流式接口 |
| 2 | 五行占比(流式) | POST | `/api/v1/bazi/wuxing-proportion/stream` | 100s | 八字命理-五行占比流式分析 |
| 3 | 喜神忌神(流式) | POST | `/api/v1/bazi/xishen-jishen/stream` | 100s | 八字命理-喜神忌神流式分析 |
| 4 | 感情婚姻(流式) | POST | `/api/v1/bazi/marriage-analysis/stream` | 100s | 八字命理-感情婚姻流式分析 |
| 5 | 事业财富(流式) | POST | `/api/v1/career-wealth/stream` | 100s | 八字命理-事业财富流式分析 |
| 6 | 子女学习(流式) | POST | `/api/v1/children-study/stream` | 100s | 八字命理-子女学习流式分析 |
| 7 | 身体健康(流式) | POST | `/api/v1/health/stream` | 100s | 八字命理-身体健康流式分析 |
| 8 | 总评分析(流式) | POST | `/api/v1/general-review/stream` | 100s | 八字命理-总评分析流式 |
| 9 | 年运报告(流式) | POST | `/api/v1/annual-report/stream` | 100s | 八字命理-年运报告流式 |
| 10 | 智能分析-类别(流式) | GET | `/api/v1/smart-fortune/smart-analyze-stream` | 100s | 智能分析-按类别 |
| 11 | 智能分析-问题(流式) | GET | `/api/v1/smart-fortune/smart-analyze-stream` | 100s | 智能分析-按问题 |
| 12 | 面相分析(流式) | POST | `/api/v2/face/analyze/stream` | 90s | 面相综合分析-流式（含图片上传） |
| 13 | 办公桌风水(流式) | POST | `/api/v2/desk-fengshui/analyze/stream` | 90s | 办公桌风水分析-流式（含图片上传） |

### 流式接口详细参数

**智能分析-类别**：
```
GET /api/v1/smart-fortune/smart-analyze-stream?category=事业财富&year=1990&month=5&day=15&hour=14&gender=male&user_id=test_user_001
```

**智能分析-问题**：
```
GET /api/v1/smart-fortune/smart-analyze-stream?question=我今年的事业运势如何？&year=1990&month=5&day=15&hour=14&gender=male&user_id=test_user_001
```

**面相分析**：`multipart/form-data`，字段 `image`（图片文件）+ `analysis_types=gongwei,liuqin`

**办公桌风水**：`multipart/form-data`，字段 `image`（图片文件）

---

## 三、支付接口（Payment）- 3 个

| 序号 | 接口名称 | 方法 | 路径 | 超时 | 说明 |
|------|---------|------|------|------|------|
| 1 | 支付渠道状态 | GET | `/api/v1/payment/providers` | 30s | 获取支付渠道状态（Stripe + PayerMax） |
| 2 | Stripe创建订单 | POST | `/api/v1/payment/unified/create` | 45s | Stripe支付订单创建 |
| 3 | PayerMax创建订单 | POST | `/api/v1/payment/unified/create` | 60s | PayerMax支付订单创建 |

### 支付接口详细参数

**Stripe创建订单**：
```json
{
  "provider": "stripe",
  "amount": "4.10",
  "currency": "USD",
  "product_name": "Stripe测试产品",
  "customer_email": "test@example.com",
  "success_url": "http://localhost:5173/payment/success?session_id={CHECKOUT_SESSION_ID}",
  "cancel_url": "http://localhost:5173/payment/cancel"
}
```

**PayerMax创建订单**：
```json
{
  "provider": "payermax",
  "amount": "19.90",
  "currency": "USD",
  "product_name": "PayerMax测试",
  "customer_email": "test@example.com",
  "success_url": "http://localhost:5173/payment/success",
  "cancel_url": "http://localhost:5173/payment/cancel"
}
```

---

## 四、快速测试命令

```bash
# 完整测试（基本+流式+面相+风水+支付），推荐
python3 scripts/evaluation/api_regression_test.py --env production --category basic --category stream --category payment --parallel

# 本地环境完整测试
python3 scripts/evaluation/api_regression_test.py --env local --category basic --category stream --category payment --parallel

# 仅基础接口
python3 scripts/evaluation/api_regression_test.py --env production --category basic

# 仅流式接口（含面相、风水）
python3 scripts/evaluation/api_regression_test.py --env production --category stream --parallel

# 仅支付接口
python3 scripts/evaluation/api_regression_test.py --env production --category payment
```

---

## 五、测试通过标准

- 基础接口：HTTP 200，响应包含 `success` 字段
- 流式接口：HTTP 200，TTFB < 100ms，SSE 格式正确（`data: {...}\n\n`）
- 支付接口：HTTP 200，响应包含 `success` 字段
- 所有接口：在超时时间内返回

---

## 六、接口总计

| 类别 | 数量 |
|------|------|
| 基础接口 | 5 |
| 流式接口（含面相、风水） | 13 |
| 支付接口 | 3 |
| **合计** | **21** |
