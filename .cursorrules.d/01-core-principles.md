# 核心原则（必须遵守）

## 🔴 0. 零停机原则 【设计前提】

> **所有设计必须保证服务不中断，这是一切设计的基础。**

| 场景 | 要求 | 实现方式 |
|------|------|----------|
| **热更新** | ✅ 零停机 | 代码修改自动重载，无需重启 |
| **版本发布** | ✅ 零停机 | 滚动更新，新旧容器平滑切换 |
| **功能增加** | ✅ 零停机 | 向后兼容，增量部署 |
| **数据库变更** | ✅ 零停机 | 只加字段不删字段，迁移脚本 |
| **配置更新** | ✅ 零停机 | 环境变量/Redis 热加载 |
| **规则更新** | ✅ 零停机 | 数据库+清缓存，无需重启 |

## 1. 最小影响原则 【最重要】
- **坚决不可改动与之无关的代码**
- 修改会引起其他功能变化时，**必须先咨询用户**
- 每次修改前明确影响范围（低/中/高）
- 高影响修改必须用户确认

## 1.1 Token 节省原则 【必须遵守】
- **只读取和操作与当前任务直接相关的文件**
- **禁止读取不相关的信息、程序、文档**
- **禁止读取整个文件，只读取需要的部分**
- **使用 `offset` 和 `limit` 参数限制读取范围**
- **使用 `grep` 或 `codebase_search` 精确定位，而不是全文件读取**
- **避免读取大型文件、日志文件、测试文件（除非明确需要）**
- **禁止读取不相关的目录和子目录**

## 2. gRPC 优先原则 【架构基础】
- **所有服务间交互必须使用 gRPC**
- **前端与后端交互通过 gRPC-Web 网关**
- REST API 仅作为兼容层，新功能必须同时注册 gRPC 端点

## 💡 开发原则

1. **🔐 安全优先**：安全是最高优先级，所有代码必须遵循安全最佳实践（见"安全规范"）
2. **🔴 零停机优先**：所有设计必须支持不停机更新（见"零停机原则"）
3. **🔌 gRPC 优先**：服务间交互必须使用 gRPC（见"gRPC 交互规范"）
4. **📜 规则数据库化**：规则存数据库，支持热更新，**禁止从文件读取**（见"规则存储规范"）
5. **🔄 向后兼容**：只加不删，保持兼容
6. **✅ 先测试后提交**：修改后立即测试
7. **📝 规范命名**：类型用英文，ID 统一格式（见"规则编码规范"和"规则类型命名"）
8. **🔄 问题复盘**：每次问题必须复盘并更新规范（见"问题复盘机制"）
9. **💾 Token 节省**：只读取相关文件，使用 `offset`/`limit` 限制范围（见"Token 节省原则"）
10. **🧪 A/B 测试优先**：新功能必须支持 A/B 测试（见"A/B 测试和灰度发布规范"）
11. **🚀 灰度发布优先**：重要变更必须通过灰度发布（见"A/B 测试和灰度发布规范"）
12. **🔄 回滚准备**：所有数据库变更必须准备回滚脚本（见"A/B 测试和灰度发布规范"）

