# é¡¹ç›®æ¶æ„

## å‰ç«¯æ¶æ„ `frontend/`
```
local_frontend/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ api.js                  # gRPC-Web å®¢æˆ·ç«¯ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ config.js               # API é…ç½®
â”‚   â”œâ”€â”€ fortune.js              # è¿åŠ¿æ•°æ®é€»è¾‘
â”‚   â”œâ”€â”€ fortune-timeline.js     # è¿åŠ¿ UI æ¸²æŸ“
â”‚   â””â”€â”€ ...
â”œâ”€â”€ css/                        # æ ·å¼æ–‡ä»¶
â””â”€â”€ *.html                      # é¡µé¢æ–‡ä»¶
```

## åç«¯æ¶æ„ `server/`
```
server/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ grpc_gateway.py         # gRPC-Web ç½‘å…³ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â””â”€â”€ v1/                     # REST API
â”‚       â”œâ”€â”€ formula_analysis.py # ç®—æ³•å…¬å¼åˆ†æ
â”‚       â””â”€â”€ ...
â”œâ”€â”€ services/                   # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ rule_service.py         # è§„åˆ™åŒ¹é…æœåŠ¡
â”‚   â””â”€â”€ ...
â”œâ”€â”€ engines/                    # è§„åˆ™å¼•æ“
â”‚   â”œâ”€â”€ rule_engine.py          # æ ¸å¿ƒå¼•æ“
â”‚   â””â”€â”€ rule_condition.py       # æ¡ä»¶åŒ¹é…ï¼ˆæ‰©å±•ç‚¹ï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ mysql_config.py         # MySQL é…ç½®ï¼ˆæ³¨æ„é»˜è®¤å€¼ï¼‰
â””â”€â”€ db/                         # æ•°æ®åº“è¿æ¥
```

## å¾®æœåŠ¡æ¶æ„ `services/`
```
services/
â”œâ”€â”€ bazi_core/                  # å…«å­—æ ¸å¿ƒæœåŠ¡ (gRPC 9001)
â”œâ”€â”€ bazi_fortune/               # è¿åŠ¿æœåŠ¡ (gRPC 9002)
â”œâ”€â”€ bazi_analyzer/              # å…«å­—åˆ†æ (gRPC 9003)
â”œâ”€â”€ bazi_rule/                  # è§„åˆ™åŒ¹é… (gRPC 9004)
â”œâ”€â”€ fortune_analysis/           # è¿åŠ¿åˆ†æ (gRPC 9005)
â”œâ”€â”€ payment_service/            # æ”¯ä»˜æœåŠ¡ (gRPC 9006)
â”œâ”€â”€ fortune_rule/               # è¿åŠ¿è§„åˆ™ (gRPC 9007)
â”œâ”€â”€ intent_service/             # æ„å›¾è¯†åˆ« (gRPC 9008)
â”œâ”€â”€ prompt_optimizer/           # æç¤ºä¼˜åŒ– (gRPC 9009)
â””â”€â”€ desk_fengshui/              # é£æ°´åˆ†æ (gRPC 9010)
```

**æœåŠ¡ç«¯å£æ¸…å•**ï¼š
| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| Web æœåŠ¡ | 8001 | HTTP + gRPC-Web ç½‘å…³ |
| bazi-core | 9001 | å…«å­—æ ¸å¿ƒè®¡ç®— |
| bazi-fortune | 9002 | è¿åŠ¿è®¡ç®— |
| bazi-analyzer | 9003 | å…«å­—åˆ†æ |
| bazi-rule | 9004 | è§„åˆ™åŒ¹é… |
| fortune-analysis | 9005 | è¿åŠ¿åˆ†æ |
| payment | 9006 | æ”¯ä»˜æœåŠ¡ |
| fortune-rule | 9007 | è¿åŠ¿è§„åˆ™ |
| intent | 9008 | æ„å›¾è¯†åˆ« |
| optimizer | 9009 | æç¤ºä¼˜åŒ– |
| desk-fengshui | 9010 | é£æ°´åˆ†æ |

## è„šæœ¬ç›®å½• `scripts/`
```
scripts/
â”œâ”€â”€ migration/                  # æ•°æ®è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ import_2025_1128_rules.py   # è§„åˆ™å¯¼å…¥ç¤ºä¾‹
â”‚   â””â”€â”€ import_confirmed_rules.py   # ç¡®è®¤è§„åˆ™å¯¼å…¥
â”œâ”€â”€ db/                         # æ•°æ®åº“è„šæœ¬
â”‚   â””â”€â”€ sync_db.sh              # æ•°æ®åº“åŒæ­¥
â””â”€â”€ ...
```

## ğŸ”’ æ ¸å¿ƒæ–‡ä»¶ï¼ˆä¿®æ”¹å‰å¿…é¡»å’¨è¯¢ï¼‰

| æ–‡ä»¶ | ä½œç”¨ | é£é™© |
|------|------|------|
| `server/api/grpc_gateway.py` | gRPC-Web ç½‘å…³ | æé«˜ |
| `server/engines/rule_condition.py` | è§„åˆ™æ¡ä»¶åŒ¹é… | é«˜ |
| `server/config/mysql_config.py` | MySQL é…ç½® | é«˜ |
| `src/bazi_calculator.py` | æ ¸å¿ƒå…«å­—è®¡ç®— | æé«˜ |
| `frontend/js/api.js` | å‰ç«¯ gRPC å®¢æˆ·ç«¯ | é«˜ |
| `proto/*.proto` | gRPC åè®®å®šä¹‰ | é«˜ |

## ğŸ  åŠå…¬æ¡Œé£æ°´æ¨¡å—ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼Œç¦æ­¢éšæ„ä¿®æ”¹ï¼‰

### âš ï¸ é‡è¦è¯´æ˜

**åŠå…¬æ¡Œé£æ°´æ¨¡å—ï¼ˆ`services/desk_fengshui/`ï¼‰æ˜¯ç¨³å®šè¿è¡Œçš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚ï¼Œå¦åˆ™ç¦æ­¢ä¿®æ”¹æ­¤æ¨¡å—çš„ä»»ä½•ä»£ç ã€è§„åˆ™æˆ–é…ç½®ã€‚**

### æ¨¡å—é…ç½®

**æŠ€æœ¯æ ˆ**ï¼š
- **YOLOç‰ˆæœ¬**ï¼šYOLOv8ï¼ˆä¸æ˜¯YOLOv5ï¼‰
- **åº“**ï¼š`ultralytics>=8.0.0`
- **æ¨¡å‹æ–‡ä»¶**ï¼š`yolov8n.pt`ï¼ˆYOLOv8 nanoç‰ˆæœ¬ï¼‰
- **ç½®ä¿¡åº¦é˜ˆå€¼**ï¼š0.15
- **å¤‡ç”¨æ–¹æ¡ˆ**ï¼šOpenCVï¼ˆå½“YOLOæœªå®‰è£…æ—¶ï¼‰

**æ ¸å¿ƒæ–‡ä»¶**ï¼š
- `services/desk_fengshui/item_detector.py` - ç‰©å“æ£€æµ‹å™¨ï¼ˆYOLOv8ï¼‰
- `services/desk_fengshui/rule_engine.py` - é£æ°´è§„åˆ™å¼•æ“
- `services/desk_fengshui/position_calculator.py` - æ–¹ä½è®¡ç®—å™¨
- `services/desk_fengshui/analyzer.py` - ä¸»åˆ†æå™¨
- `services/desk_fengshui/bazi_client.py` - å…«å­—å®¢æˆ·ç«¯
- `services/desk_fengshui/requirements.txt` - ä¾èµ–é…ç½®

**è§„åˆ™ç³»ç»Ÿ**ï¼š
- è§„åˆ™å­˜å‚¨åœ¨MySQLæ•°æ®åº“ï¼ˆ`desk_fengshui_rules`è¡¨ï¼‰
- åŒ…å«é’é¾™ä½ã€ç™½è™ä½ã€æœ±é›€ä½ã€ç„æ­¦ä½ç­‰ä¼ ç»Ÿé£æ°´è§„åˆ™
- ç»“åˆå…«å­—å–œç”¨ç¥ã€å¿Œç¥è¿›è¡Œä¸ªæ€§åŒ–åˆ†æ

**ä¿®æ”¹åŸåˆ™**ï¼š
1. âŒ **ç¦æ­¢ä¿®æ”¹**ï¼šé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚
2. âœ… **å…è®¸æ“ä½œ**ï¼šæŸ¥çœ‹ã€æµ‹è¯•ã€è°ƒè¯•
3. âš ï¸ **ä¿®æ”¹å‰å¿…é¡»**ï¼šå…ˆå’¨è¯¢ç”¨æˆ·ï¼Œè¯´æ˜å½±å“èŒƒå›´
4. ğŸ”’ **ä¿æŠ¤èŒƒå›´**ï¼šæ‰€æœ‰ `services/desk_fengshui/` ç›®å½•ä¸‹çš„æ–‡ä»¶

