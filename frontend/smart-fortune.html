<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è¿åŠ¿åˆ†æ - AIæ„å›¾è¯†åˆ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .example-questions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .example-questions h3 {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .example-tag {
            display: inline-block;
            padding: 6px 12px;
            margin: 4px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-tag:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result-card {
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .intent-badge {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .confidence-bar {
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: width 1s ease;
        }

        .bazi-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .bazi-pillars {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .pillar {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .pillar-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .pillar-content {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .response-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c00;
            display: none;
        }

        .section-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-label {
            font-weight: 600;
            color: #666;
        }

        .info-value {
            color: #333;
        }

        .keyword-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .keyword {
            background: #f0f0f0;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .card {
                padding: 20px;
            }

            .bazi-pillars {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”® æ™ºèƒ½è¿åŠ¿åˆ†æ</h1>
            <p>åŸºäºAIçš„é—®é¢˜æ„å›¾è¯†åˆ« Â· å‡†ç¡®ç‡95%+</p>
        </div>

        <!-- è¾“å…¥è¡¨å• -->
        <div class="card">
            <form id="fortuneForm">
                <div class="form-group">
                    <label>ğŸ’¬ æ‚¨çš„é—®é¢˜</label>
                    <textarea 
                        id="question" 
                        placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·ï¼Ÿä»Šå¹´èƒ½å‘è´¢å—ï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šç»“å©šï¼Ÿ"
                        required
                    ></textarea>
                </div>

                <div class="example-questions">
                    <h3>ğŸ’¡ ç¤ºä¾‹é—®é¢˜ï¼ˆç‚¹å‡»å¡«å…¥ï¼‰</h3>
                    <span class="example-tag" onclick="setQuestion('æˆ‘çš„äº‹ä¸šè¿åŠ¿æ€ä¹ˆæ ·ï¼Ÿ')">äº‹ä¸šè¿åŠ¿</span>
                    <span class="example-tag" onclick="setQuestion('æˆ‘ä»Šå¹´èƒ½å‘è´¢å—ï¼Ÿ')">è´¢å¯Œè¿åŠ¿</span>
                    <span class="example-tag" onclick="setQuestion('æˆ‘ä»€ä¹ˆæ—¶å€™ä¼šç»“å©šï¼Ÿ')">å©šå§»æ„Ÿæƒ…</span>
                    <span class="example-tag" onclick="setQuestion('æˆ‘çš„èº«ä½“å¥åº·å—ï¼Ÿ')">å¥åº·è¿åŠ¿</span>
                    <span class="example-tag" onclick="setQuestion('æˆ‘æ˜¯ä»€ä¹ˆæ€§æ ¼ï¼Ÿ')">æ€§æ ¼ç‰¹ç‚¹</span>
                    <span class="example-tag" onclick="setQuestion('æˆ‘ä»Šå¹´èƒ½èµšåˆ°é’±å—ï¼Ÿä¼šä¸ä¼šå‡èŒï¼Ÿ')">å¤åˆé—®é¢˜</span>
                    <span class="example-tag" onclick="setQuestion('æˆ‘çš„é£Ÿç¥æ—ºä¸æ—ºï¼Ÿ')">ä¸“ä¸šæœ¯è¯­</span>
                </div>

                <div class="section-title" style="margin-top: 20px;">ğŸ“… æ‚¨çš„å‡ºç”Ÿä¿¡æ¯</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>å‡ºç”Ÿå¹´ä»½</label>
                        <input type="number" id="year" placeholder="1990" min="1900" max="2100" value="1990" required>
                    </div>
                    <div class="form-group">
                        <label>å‡ºç”Ÿæœˆä»½</label>
                        <input type="number" id="month" placeholder="1-12" min="1" max="12" value="1" required>
                    </div>
                    <div class="form-group">
                        <label>å‡ºç”Ÿæ—¥æœŸ</label>
                        <input type="number" id="day" placeholder="1-31" min="1" max="31" value="1" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>å‡ºç”Ÿæ—¶è¾°</label>
                        <input type="number" id="hour" placeholder="0-23ç‚¹" min="0" max="23" value="12">
                    </div>
                    <div class="form-group">
                        <label>æ€§åˆ«</label>
                        <select id="gender" required>
                            <option value="male">ç”·</option>
                            <option value="female">å¥³</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="includeFortune" checked style="width: auto; margin-right: 8px;">
                        <span>ğŸŒŸ åŒ…å«æµå¹´å¤§è¿åˆ†æï¼ˆè‡ªåŠ¨å¯¹æ¯”æœ€è¿‘ä¸¤å¹´ï¼‰</span>
                    </label>
                    <p style="font-size: 0.85em; color: #666; margin-top: 5px; margin-left: 26px;">
                        å¯ç”¨åå°†æ˜¾ç¤ºæµå¹´ã€å¤§è¿ä¿¡æ¯ã€‚ä¸æŒ‡å®šæ—¶é—´â†’æœ€è¿‘ä¸¤å¹´ï¼›è¯´"è¿‡å»"â†’è¿‡å»ä¸¤å¹´ï¼›è¯´"ä»Šå¹´"â†’åªçœ‹ä»Šå¹´
                    </p>
                </div>

                <button type="submit" class="btn" id="submitBtn">
                    ğŸš€ å¼€å§‹æ™ºèƒ½åˆ†æ
                </button>
            </form>
        </div>

        <!-- åŠ è½½ä¸­ -->
        <div class="card loading" id="loadingCard" style="display: none;">
            <div class="spinner"></div>
            <p style="margin-top: 20px; color: #666;">æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div class="error-message" id="errorMessage"></div>

        <!-- ç»“æœå±•ç¤º -->
        <div class="card result-card" id="resultCard">
            <div class="section-title">ğŸ¯ æ„å›¾è¯†åˆ«ç»“æœ</div>
            
            <div class="info-row">
                <span class="info-label">è¯†åˆ«æ„å›¾ï¼š</span>
                <span id="intentsDisplay"></span>
            </div>

            <div class="info-row">
                <span class="info-label">ç½®ä¿¡åº¦ï¼š</span>
                <span id="confidenceText"></span>
            </div>

            <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceFill" style="width: 0%;">
                    <span id="confidencePercent">0%</span>
                </div>
            </div>

            <div class="info-row">
                <span class="info-label">å…³é”®è¯ï¼š</span>
                <div class="keyword-list" id="keywordsList"></div>
            </div>

            <div class="info-row">
                <span class="info-label">æ˜¯å¦æ¨¡ç³Šï¼š</span>
                <span id="ambiguousStatus"></span>
            </div>

            <div class="section-title" style="margin-top: 30px;">ğŸ“Š å…«å­—ä¿¡æ¯</div>
            
            <div class="bazi-info">
                <div class="info-row">
                    <span class="info-label">æ—¥ä¸»ï¼š</span>
                    <span id="rizhu"></span>
                </div>
                <div class="bazi-pillars" id="baziPillars"></div>
            </div>

            <div class="section-title" style="margin-top: 30px;">ğŸ’¬ æ™ºèƒ½åˆ†æç»“æœ</div>
            
            <div class="response-text" id="responseText"></div>

            <div class="info-row" style="margin-top: 20px; font-size: 0.9em; color: #999;">
                <span>åŒ¹é…è§„åˆ™æ•°ï¼š<strong id="rulesCount">0</strong></span>
                <span>å“åº”æ—¶é—´ï¼š<strong id="responseTime">0ms</strong></span>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8001';

        // è®¾ç½®ç¤ºä¾‹é—®é¢˜
        function setQuestion(text) {
            document.getElementById('question').value = text;
        }

        // è¡¨å•æäº¤
        document.getElementById('fortuneForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const question = document.getElementById('question').value.trim();
            const year = parseInt(document.getElementById('year').value);
            const month = parseInt(document.getElementById('month').value);
            const day = parseInt(document.getElementById('day').value);
            const hour = parseInt(document.getElementById('hour').value) || 12;
            const gender = document.getElementById('gender').value;

            if (!question) {
                showError('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loadingCard').style.display = 'block';
            document.getElementById('resultCard').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('submitBtn').disabled = true;

            const startTime = Date.now();

            try {
                // è·å–æµå¹´å¤§è¿å¼€å…³çŠ¶æ€
                const includeFortune = document.getElementById('includeFortune').checked;
                
                // è°ƒç”¨æ™ºèƒ½åˆ†æAPI
                const url = `${API_BASE_URL}/api/v1/smart-analyze?` +
                    `question=${encodeURIComponent(question)}` +
                    `&year=${year}` +
                    `&month=${month}` +
                    `&day=${day}` +
                    `&hour=${hour}` +
                    `&gender=${gender}` +
                    `&include_fortune_context=${includeFortune}`;

                console.log('ğŸ”— APIè¯·æ±‚URL:', url);

                const response = await fetch(url);
                const data = await response.json();

                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (data.success) {
                    displayResult(data, responseTime);
                } else {
                    showError(data.message || 'åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨');
            } finally {
                document.getElementById('loadingCard').style.display = 'none';
                document.getElementById('submitBtn').disabled = false;
            }
        });

        // æ˜¾ç¤ºç»“æœ
        function displayResult(data, responseTime) {
            const intentResult = data.intent_result;
            const baziInfo = data.bazi_info;

            // æ„å›¾å±•ç¤º
            const intentsHtml = intentResult.intents.map(intent => {
                const intentNames = {
                    'career': 'äº‹ä¸šè¿åŠ¿',
                    'wealth': 'è´¢å¯Œè¿åŠ¿',
                    'marriage': 'å©šå§»æ„Ÿæƒ…',
                    'health': 'å¥åº·è¿åŠ¿',
                    'personality': 'æ€§æ ¼ç‰¹ç‚¹',
                    'wangshui': 'å‘½å±€æ—ºè¡°',
                    'yongji': 'å–œå¿Œç”¨ç¥',
                    'shishen': 'åç¥åˆ†æ',
                    'nayin': 'çº³éŸ³åˆ†æ',
                    'general': 'ç»¼åˆåˆ†æ'
                };
                return `<span class="intent-badge">${intentNames[intent] || intent}</span>`;
            }).join('');
            document.getElementById('intentsDisplay').innerHTML = intentsHtml;

            // ç½®ä¿¡åº¦
            const confidence = intentResult.confidence;
            const confidencePercent = Math.round(confidence * 100);
            document.getElementById('confidenceText').textContent = confidencePercent + '%';
            
            setTimeout(() => {
                document.getElementById('confidenceFill').style.width = confidencePercent + '%';
                document.getElementById('confidencePercent').textContent = confidencePercent + '%';
            }, 100);

            // å…³é”®è¯
            if (intentResult.keywords && intentResult.keywords.length > 0) {
                const keywordsHtml = intentResult.keywords.map(kw => 
                    `<span class="keyword">${kw}</span>`
                ).join('');
                document.getElementById('keywordsList').innerHTML = keywordsHtml;
            } else {
                document.getElementById('keywordsList').innerHTML = '<span class="keyword">æ— </span>';
            }

            // æ˜¯å¦æ¨¡ç³Š
            const isAmbiguous = intentResult.is_ambiguous;
            document.getElementById('ambiguousStatus').innerHTML = isAmbiguous 
                ? '<span style="color: #ff9800;">æ˜¯ï¼ˆå»ºè®®æ›´å…·ä½“åœ°æè¿°ï¼‰</span>' 
                : '<span style="color: #4caf50;">å¦</span>';

            // å…«å­—ä¿¡æ¯
            if (baziInfo && baziInfo['å››æŸ±']) {
                const pillars = baziInfo['å››æŸ±'];
                const rizhu = pillars['æ—¥æŸ±'];
                document.getElementById('rizhu').textContent = rizhu ? 
                    `${rizhu['å¤©å¹²']}${rizhu['åœ°æ”¯']}` : 'æœªçŸ¥';

                // å››æŸ±å±•ç¤º
                const pillarsHtml = ['å¹´æŸ±', 'æœˆæŸ±', 'æ—¥æŸ±', 'æ—¶æŸ±'].map(name => {
                    const pillar = pillars[name];
                    if (pillar) {
                        return `
                            <div class="pillar">
                                <div class="pillar-label">${name}</div>
                                <div class="pillar-content">${pillar['å¤©å¹²']}<br>${pillar['åœ°æ”¯']}</div>
                            </div>
                        `;
                    }
                    return '';
                }).join('');
                document.getElementById('baziPillars').innerHTML = pillarsHtml;
            }

            // åˆ†æç»“æœ
            document.getElementById('responseText').textContent = data.response;

            // ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('rulesCount').textContent = data.matched_rules_count || 0;
            document.getElementById('responseTime').textContent = responseTime + 'ms';

            // æ˜¾ç¤ºç»“æœå¡ç‰‡
            document.getElementById('resultCard').style.display = 'block';

            // æ»šåŠ¨åˆ°ç»“æœ
            setTimeout(() => {
                document.getElementById('resultCard').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 200);
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = 'âŒ ' + message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        console.log('%cğŸ”® æ™ºèƒ½è¿åŠ¿åˆ†æç³»ç»Ÿ', 'color: #667eea; font-size: 20px; font-weight: bold;');
        console.log('%cåŸºäºAIçš„é—®é¢˜æ„å›¾è¯†åˆ«ï¼Œå‡†ç¡®ç‡95%+', 'color: #666; font-size: 12px;');
        console.log('%cAPIåœ°å€ï¼š' + API_BASE_URL, 'color: #999; font-size: 12px;');
    </script>
</body>
</html>

